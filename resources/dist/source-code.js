var uo=Object.create;var Si=Object.defineProperty;var co=Object.getOwnPropertyDescriptor;var ho=Object.getOwnPropertyNames;var fo=Object.getPrototypeOf,po=Object.prototype.hasOwnProperty;var F=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var _o=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ho(t))!po.call(n,s)&&s!==e&&Si(n,s,{get:()=>t[s],enumerable:!(i=co(t,s))||i.enumerable});return n};var mo=(n,t,e)=>(e=n!=null?uo(fo(n)):{},_o(t||!n||!n.__esModule?Si(e,"default",{value:n,enumerable:!0}):e,n));var qe=F((Lf,or)=>{"use strict";function J(n){this.__parent=n,this.__character_count=0,this.__indent_count=-1,this.__alignment_count=0,this.__wrap_point_index=0,this.__wrap_point_character_count=0,this.__wrap_point_indent_count=-1,this.__wrap_point_alignment_count=0,this.__items=[]}J.prototype.clone_empty=function(){var n=new J(this.__parent);return n.set_indent(this.__indent_count,this.__alignment_count),n};J.prototype.item=function(n){return n<0?this.__items[this.__items.length+n]:this.__items[n]};J.prototype.has_match=function(n){for(var t=this.__items.length-1;t>=0;t--)if(this.__items[t].match(n))return!0;return!1};J.prototype.set_indent=function(n,t){this.is_empty()&&(this.__indent_count=n||0,this.__alignment_count=t||0,this.__character_count=this.__parent.get_indent_size(this.__indent_count,this.__alignment_count))};J.prototype._set_wrap_point=function(){this.__parent.wrap_line_length&&(this.__wrap_point_index=this.__items.length,this.__wrap_point_character_count=this.__character_count,this.__wrap_point_indent_count=this.__parent.next_line.__indent_count,this.__wrap_point_alignment_count=this.__parent.next_line.__alignment_count)};J.prototype._should_wrap=function(){return this.__wrap_point_index&&this.__character_count>this.__parent.wrap_line_length&&this.__wrap_point_character_count>this.__parent.next_line.__character_count};J.prototype._allow_wrap=function(){if(this._should_wrap()){this.__parent.add_new_line();var n=this.__parent.current_line;return n.set_indent(this.__wrap_point_indent_count,this.__wrap_point_alignment_count),n.__items=this.__items.slice(this.__wrap_point_index),this.__items=this.__items.slice(0,this.__wrap_point_index),n.__character_count+=this.__character_count-this.__wrap_point_character_count,this.__character_count=this.__wrap_point_character_count,n.__items[0]===" "&&(n.__items.splice(0,1),n.__character_count-=1),!0}return!1};J.prototype.is_empty=function(){return this.__items.length===0};J.prototype.last=function(){return this.is_empty()?null:this.__items[this.__items.length-1]};J.prototype.push=function(n){this.__items.push(n);var t=n.lastIndexOf(`
`);t!==-1?this.__character_count=n.length-t:this.__character_count+=n.length};J.prototype.pop=function(){var n=null;return this.is_empty()||(n=this.__items.pop(),this.__character_count-=n.length),n};J.prototype._remove_indent=function(){this.__indent_count>0&&(this.__indent_count-=1,this.__character_count-=this.__parent.indent_size)};J.prototype._remove_wrap_indent=function(){this.__wrap_point_indent_count>0&&(this.__wrap_point_indent_count-=1)};J.prototype.trim=function(){for(;this.last()===" ";)this.__items.pop(),this.__character_count-=1};J.prototype.toString=function(){var n="";return this.is_empty()?this.__parent.indent_empty_lines&&(n=this.__parent.get_indent_string(this.__indent_count)):(n=this.__parent.get_indent_string(this.__indent_count,this.__alignment_count),n+=this.__items.join("")),n};function le(n,t){this.__cache=[""],this.__indent_size=n.indent_size,this.__indent_string=n.indent_char,n.indent_with_tabs||(this.__indent_string=new Array(n.indent_size+1).join(n.indent_char)),t=t||"",n.indent_level>0&&(t=new Array(n.indent_level+1).join(this.__indent_string)),this.__base_string=t,this.__base_string_length=t.length}le.prototype.get_indent_size=function(n,t){var e=this.__base_string_length;return t=t||0,n<0&&(e=0),e+=n*this.__indent_size,e+=t,e};le.prototype.get_indent_string=function(n,t){var e=this.__base_string;return t=t||0,n<0&&(n=0,e=""),t+=n*this.__indent_size,this.__ensure_cache(t),e+=this.__cache[t],e};le.prototype.__ensure_cache=function(n){for(;n>=this.__cache.length;)this.__add_column()};le.prototype.__add_column=function(){var n=this.__cache.length,t=0,e="";this.__indent_size&&n>=this.__indent_size&&(t=Math.floor(n/this.__indent_size),n-=t*this.__indent_size,e=new Array(t+1).join(this.__indent_string)),n&&(e+=new Array(n+1).join(" ")),this.__cache.push(e)};function q(n,t){this.__indent_cache=new le(n,t),this.raw=!1,this._end_with_newline=n.end_with_newline,this.indent_size=n.indent_size,this.wrap_line_length=n.wrap_line_length,this.indent_empty_lines=n.indent_empty_lines,this.__lines=[],this.previous_line=null,this.current_line=null,this.next_line=new J(this),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1,this.__add_outputline()}q.prototype.__add_outputline=function(){this.previous_line=this.current_line,this.current_line=this.next_line.clone_empty(),this.__lines.push(this.current_line)};q.prototype.get_line_number=function(){return this.__lines.length};q.prototype.get_indent_string=function(n,t){return this.__indent_cache.get_indent_string(n,t)};q.prototype.get_indent_size=function(n,t){return this.__indent_cache.get_indent_size(n,t)};q.prototype.is_empty=function(){return!this.previous_line&&this.current_line.is_empty()};q.prototype.add_new_line=function(n){return this.is_empty()||!n&&this.just_added_newline()?!1:(this.raw||this.__add_outputline(),!0)};q.prototype.get_code=function(n){this.trim(!0);var t=this.current_line.pop();t&&(t[t.length-1]===`
`&&(t=t.replace(/\n+$/g,"")),this.current_line.push(t)),this._end_with_newline&&this.__add_outputline();var e=this.__lines.join(`
`);return n!==`
`&&(e=e.replace(/[\n]/g,n)),e};q.prototype.set_wrap_point=function(){this.current_line._set_wrap_point()};q.prototype.set_indent=function(n,t){return n=n||0,t=t||0,this.next_line.set_indent(n,t),this.__lines.length>1?(this.current_line.set_indent(n,t),!0):(this.current_line.set_indent(),!1)};q.prototype.add_raw_token=function(n){for(var t=0;t<n.newlines;t++)this.__add_outputline();this.current_line.set_indent(-1),this.current_line.push(n.whitespace_before),this.current_line.push(n.text),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=!1};q.prototype.add_token=function(n){this.__add_space_before_token(),this.current_line.push(n),this.space_before_token=!1,this.non_breaking_space=!1,this.previous_token_wrapped=this.current_line._allow_wrap()};q.prototype.__add_space_before_token=function(){this.space_before_token&&!this.just_added_newline()&&(this.non_breaking_space||this.set_wrap_point(),this.current_line.push(" "))};q.prototype.remove_indent=function(n){for(var t=this.__lines.length;n<t;)this.__lines[n]._remove_indent(),n++;this.current_line._remove_wrap_indent()};q.prototype.trim=function(n){for(n=n===void 0?!1:n,this.current_line.trim();n&&this.__lines.length>1&&this.current_line.is_empty();)this.__lines.pop(),this.current_line=this.__lines[this.__lines.length-1],this.current_line.trim();this.previous_line=this.__lines.length>1?this.__lines[this.__lines.length-2]:null};q.prototype.just_added_newline=function(){return this.current_line.is_empty()};q.prototype.just_added_blankline=function(){return this.is_empty()||this.current_line.is_empty()&&this.previous_line.is_empty()};q.prototype.ensure_empty_line_above=function(n,t){for(var e=this.__lines.length-2;e>=0;){var i=this.__lines[e];if(i.is_empty())break;if(i.item(0).indexOf(n)!==0&&i.item(-1)!==t){this.__lines.splice(e+1,0,new J(this)),this.previous_line=this.__lines[this.__lines.length-2];break}e--}};or.exports.Output=q});var ti=F((Df,ar)=>{"use strict";function Mu(n,t,e,i){this.type=n,this.text=t,this.comments_before=null,this.newlines=e||0,this.whitespace_before=i||"",this.parent=null,this.next=null,this.previous=null,this.opened=null,this.closed=null,this.directives=null}ar.exports.Token=Mu});var ii=F(vt=>{"use strict";var Ou="\\x23\\x24\\x40\\x41-\\x5a\\x5f\\x61-\\x7a",lr="\\x24\\x30-\\x39\\x41-\\x5a\\x5f\\x61-\\x7a",ei="\\xaa\\xb5\\xba\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\u02c1\\u02c6-\\u02d1\\u02e0-\\u02e4\\u02ec\\u02ee\\u0370-\\u0374\\u0376\\u0377\\u037a-\\u037d\\u0386\\u0388-\\u038a\\u038c\\u038e-\\u03a1\\u03a3-\\u03f5\\u03f7-\\u0481\\u048a-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05d0-\\u05ea\\u05f0-\\u05f2\\u0620-\\u064a\\u066e\\u066f\\u0671-\\u06d3\\u06d5\\u06e5\\u06e6\\u06ee\\u06ef\\u06fa-\\u06fc\\u06ff\\u0710\\u0712-\\u072f\\u074d-\\u07a5\\u07b1\\u07ca-\\u07ea\\u07f4\\u07f5\\u07fa\\u0800-\\u0815\\u081a\\u0824\\u0828\\u0840-\\u0858\\u08a0\\u08a2-\\u08ac\\u0904-\\u0939\\u093d\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097f\\u0985-\\u098c\\u098f\\u0990\\u0993-\\u09a8\\u09aa-\\u09b0\\u09b2\\u09b6-\\u09b9\\u09bd\\u09ce\\u09dc\\u09dd\\u09df-\\u09e1\\u09f0\\u09f1\\u0a05-\\u0a0a\\u0a0f\\u0a10\\u0a13-\\u0a28\\u0a2a-\\u0a30\\u0a32\\u0a33\\u0a35\\u0a36\\u0a38\\u0a39\\u0a59-\\u0a5c\\u0a5e\\u0a72-\\u0a74\\u0a85-\\u0a8d\\u0a8f-\\u0a91\\u0a93-\\u0aa8\\u0aaa-\\u0ab0\\u0ab2\\u0ab3\\u0ab5-\\u0ab9\\u0abd\\u0ad0\\u0ae0\\u0ae1\\u0b05-\\u0b0c\\u0b0f\\u0b10\\u0b13-\\u0b28\\u0b2a-\\u0b30\\u0b32\\u0b33\\u0b35-\\u0b39\\u0b3d\\u0b5c\\u0b5d\\u0b5f-\\u0b61\\u0b71\\u0b83\\u0b85-\\u0b8a\\u0b8e-\\u0b90\\u0b92-\\u0b95\\u0b99\\u0b9a\\u0b9c\\u0b9e\\u0b9f\\u0ba3\\u0ba4\\u0ba8-\\u0baa\\u0bae-\\u0bb9\\u0bd0\\u0c05-\\u0c0c\\u0c0e-\\u0c10\\u0c12-\\u0c28\\u0c2a-\\u0c33\\u0c35-\\u0c39\\u0c3d\\u0c58\\u0c59\\u0c60\\u0c61\\u0c85-\\u0c8c\\u0c8e-\\u0c90\\u0c92-\\u0ca8\\u0caa-\\u0cb3\\u0cb5-\\u0cb9\\u0cbd\\u0cde\\u0ce0\\u0ce1\\u0cf1\\u0cf2\\u0d05-\\u0d0c\\u0d0e-\\u0d10\\u0d12-\\u0d3a\\u0d3d\\u0d4e\\u0d60\\u0d61\\u0d7a-\\u0d7f\\u0d85-\\u0d96\\u0d9a-\\u0db1\\u0db3-\\u0dbb\\u0dbd\\u0dc0-\\u0dc6\\u0e01-\\u0e30\\u0e32\\u0e33\\u0e40-\\u0e46\\u0e81\\u0e82\\u0e84\\u0e87\\u0e88\\u0e8a\\u0e8d\\u0e94-\\u0e97\\u0e99-\\u0e9f\\u0ea1-\\u0ea3\\u0ea5\\u0ea7\\u0eaa\\u0eab\\u0ead-\\u0eb0\\u0eb2\\u0eb3\\u0ebd\\u0ec0-\\u0ec4\\u0ec6\\u0edc-\\u0edf\\u0f00\\u0f40-\\u0f47\\u0f49-\\u0f6c\\u0f88-\\u0f8c\\u1000-\\u102a\\u103f\\u1050-\\u1055\\u105a-\\u105d\\u1061\\u1065\\u1066\\u106e-\\u1070\\u1075-\\u1081\\u108e\\u10a0-\\u10c5\\u10c7\\u10cd\\u10d0-\\u10fa\\u10fc-\\u1248\\u124a-\\u124d\\u1250-\\u1256\\u1258\\u125a-\\u125d\\u1260-\\u1288\\u128a-\\u128d\\u1290-\\u12b0\\u12b2-\\u12b5\\u12b8-\\u12be\\u12c0\\u12c2-\\u12c5\\u12c8-\\u12d6\\u12d8-\\u1310\\u1312-\\u1315\\u1318-\\u135a\\u1380-\\u138f\\u13a0-\\u13f4\\u1401-\\u166c\\u166f-\\u167f\\u1681-\\u169a\\u16a0-\\u16ea\\u16ee-\\u16f0\\u1700-\\u170c\\u170e-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176c\\u176e-\\u1770\\u1780-\\u17b3\\u17d7\\u17dc\\u1820-\\u1877\\u1880-\\u18a8\\u18aa\\u18b0-\\u18f5\\u1900-\\u191c\\u1950-\\u196d\\u1970-\\u1974\\u1980-\\u19ab\\u19c1-\\u19c7\\u1a00-\\u1a16\\u1a20-\\u1a54\\u1aa7\\u1b05-\\u1b33\\u1b45-\\u1b4b\\u1b83-\\u1ba0\\u1bae\\u1baf\\u1bba-\\u1be5\\u1c00-\\u1c23\\u1c4d-\\u1c4f\\u1c5a-\\u1c7d\\u1ce9-\\u1cec\\u1cee-\\u1cf1\\u1cf5\\u1cf6\\u1d00-\\u1dbf\\u1e00-\\u1f15\\u1f18-\\u1f1d\\u1f20-\\u1f45\\u1f48-\\u1f4d\\u1f50-\\u1f57\\u1f59\\u1f5b\\u1f5d\\u1f5f-\\u1f7d\\u1f80-\\u1fb4\\u1fb6-\\u1fbc\\u1fbe\\u1fc2-\\u1fc4\\u1fc6-\\u1fcc\\u1fd0-\\u1fd3\\u1fd6-\\u1fdb\\u1fe0-\\u1fec\\u1ff2-\\u1ff4\\u1ff6-\\u1ffc\\u2071\\u207f\\u2090-\\u209c\\u2102\\u2107\\u210a-\\u2113\\u2115\\u2119-\\u211d\\u2124\\u2126\\u2128\\u212a-\\u212d\\u212f-\\u2139\\u213c-\\u213f\\u2145-\\u2149\\u214e\\u2160-\\u2188\\u2c00-\\u2c2e\\u2c30-\\u2c5e\\u2c60-\\u2ce4\\u2ceb-\\u2cee\\u2cf2\\u2cf3\\u2d00-\\u2d25\\u2d27\\u2d2d\\u2d30-\\u2d67\\u2d6f\\u2d80-\\u2d96\\u2da0-\\u2da6\\u2da8-\\u2dae\\u2db0-\\u2db6\\u2db8-\\u2dbe\\u2dc0-\\u2dc6\\u2dc8-\\u2dce\\u2dd0-\\u2dd6\\u2dd8-\\u2dde\\u2e2f\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303c\\u3041-\\u3096\\u309d-\\u309f\\u30a1-\\u30fa\\u30fc-\\u30ff\\u3105-\\u312d\\u3131-\\u318e\\u31a0-\\u31ba\\u31f0-\\u31ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\ua000-\\ua48c\\ua4d0-\\ua4fd\\ua500-\\ua60c\\ua610-\\ua61f\\ua62a\\ua62b\\ua640-\\ua66e\\ua67f-\\ua697\\ua6a0-\\ua6ef\\ua717-\\ua71f\\ua722-\\ua788\\ua78b-\\ua78e\\ua790-\\ua793\\ua7a0-\\ua7aa\\ua7f8-\\ua801\\ua803-\\ua805\\ua807-\\ua80a\\ua80c-\\ua822\\ua840-\\ua873\\ua882-\\ua8b3\\ua8f2-\\ua8f7\\ua8fb\\ua90a-\\ua925\\ua930-\\ua946\\ua960-\\ua97c\\ua984-\\ua9b2\\ua9cf\\uaa00-\\uaa28\\uaa40-\\uaa42\\uaa44-\\uaa4b\\uaa60-\\uaa76\\uaa7a\\uaa80-\\uaaaf\\uaab1\\uaab5\\uaab6\\uaab9-\\uaabd\\uaac0\\uaac2\\uaadb-\\uaadd\\uaae0-\\uaaea\\uaaf2-\\uaaf4\\uab01-\\uab06\\uab09-\\uab0e\\uab11-\\uab16\\uab20-\\uab26\\uab28-\\uab2e\\uabc0-\\uabe2\\uac00-\\ud7a3\\ud7b0-\\ud7c6\\ud7cb-\\ud7fb\\uf900-\\ufa6d\\ufa70-\\ufad9\\ufb00-\\ufb06\\ufb13-\\ufb17\\ufb1d\\ufb1f-\\ufb28\\ufb2a-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40\\ufb41\\ufb43\\ufb44\\ufb46-\\ufbb1\\ufbd3-\\ufd3d\\ufd50-\\ufd8f\\ufd92-\\ufdc7\\ufdf0-\\ufdfb\\ufe70-\\ufe74\\ufe76-\\ufefc\\uff21-\\uff3a\\uff41-\\uff5a\\uff66-\\uffbe\\uffc2-\\uffc7\\uffca-\\uffcf\\uffd2-\\uffd7\\uffda-\\uffdc",ur="\\u0300-\\u036f\\u0483-\\u0487\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u0620-\\u0649\\u0672-\\u06d3\\u06e7-\\u06e8\\u06fb-\\u06fc\\u0730-\\u074a\\u0800-\\u0814\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0840-\\u0857\\u08e4-\\u08fe\\u0900-\\u0903\\u093a-\\u093c\\u093e-\\u094f\\u0951-\\u0957\\u0962-\\u0963\\u0966-\\u096f\\u0981-\\u0983\\u09bc\\u09be-\\u09c4\\u09c7\\u09c8\\u09d7\\u09df-\\u09e0\\u0a01-\\u0a03\\u0a3c\\u0a3e-\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a66-\\u0a71\\u0a75\\u0a81-\\u0a83\\u0abc\\u0abe-\\u0ac5\\u0ac7-\\u0ac9\\u0acb-\\u0acd\\u0ae2-\\u0ae3\\u0ae6-\\u0aef\\u0b01-\\u0b03\\u0b3c\\u0b3e-\\u0b44\\u0b47\\u0b48\\u0b4b-\\u0b4d\\u0b56\\u0b57\\u0b5f-\\u0b60\\u0b66-\\u0b6f\\u0b82\\u0bbe-\\u0bc2\\u0bc6-\\u0bc8\\u0bca-\\u0bcd\\u0bd7\\u0be6-\\u0bef\\u0c01-\\u0c03\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62-\\u0c63\\u0c66-\\u0c6f\\u0c82\\u0c83\\u0cbc\\u0cbe-\\u0cc4\\u0cc6-\\u0cc8\\u0cca-\\u0ccd\\u0cd5\\u0cd6\\u0ce2-\\u0ce3\\u0ce6-\\u0cef\\u0d02\\u0d03\\u0d46-\\u0d48\\u0d57\\u0d62-\\u0d63\\u0d66-\\u0d6f\\u0d82\\u0d83\\u0dca\\u0dcf-\\u0dd4\\u0dd6\\u0dd8-\\u0ddf\\u0df2\\u0df3\\u0e34-\\u0e3a\\u0e40-\\u0e45\\u0e50-\\u0e59\\u0eb4-\\u0eb9\\u0ec8-\\u0ecd\\u0ed0-\\u0ed9\\u0f18\\u0f19\\u0f20-\\u0f29\\u0f35\\u0f37\\u0f39\\u0f41-\\u0f47\\u0f71-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u1000-\\u1029\\u1040-\\u1049\\u1067-\\u106d\\u1071-\\u1074\\u1082-\\u108d\\u108f-\\u109d\\u135d-\\u135f\\u170e-\\u1710\\u1720-\\u1730\\u1740-\\u1750\\u1772\\u1773\\u1780-\\u17b2\\u17dd\\u17e0-\\u17e9\\u180b-\\u180d\\u1810-\\u1819\\u1920-\\u192b\\u1930-\\u193b\\u1951-\\u196d\\u19b0-\\u19c0\\u19c8-\\u19c9\\u19d0-\\u19d9\\u1a00-\\u1a15\\u1a20-\\u1a53\\u1a60-\\u1a7c\\u1a7f-\\u1a89\\u1a90-\\u1a99\\u1b46-\\u1b4b\\u1b50-\\u1b59\\u1b6b-\\u1b73\\u1bb0-\\u1bb9\\u1be6-\\u1bf3\\u1c00-\\u1c22\\u1c40-\\u1c49\\u1c5b-\\u1c7d\\u1cd0-\\u1cd2\\u1d00-\\u1dbe\\u1e01-\\u1f15\\u200c\\u200d\\u203f\\u2040\\u2054\\u20d0-\\u20dc\\u20e1\\u20e5-\\u20f0\\u2d81-\\u2d96\\u2de0-\\u2dff\\u3021-\\u3028\\u3099\\u309a\\ua640-\\ua66d\\ua674-\\ua67d\\ua69f\\ua6f0-\\ua6f1\\ua7f8-\\ua800\\ua806\\ua80b\\ua823-\\ua827\\ua880-\\ua881\\ua8b4-\\ua8c4\\ua8d0-\\ua8d9\\ua8f3-\\ua8f7\\ua900-\\ua909\\ua926-\\ua92d\\ua930-\\ua945\\ua980-\\ua983\\ua9b3-\\ua9c0\\uaa00-\\uaa27\\uaa40-\\uaa41\\uaa4c-\\uaa4d\\uaa50-\\uaa59\\uaa7b\\uaae0-\\uaae9\\uaaf2-\\uaaf3\\uabc0-\\uabe1\\uabec\\uabed\\uabf0-\\uabf9\\ufb20-\\ufb28\\ufe00-\\ufe0f\\ufe20-\\ufe26\\ufe33\\ufe34\\ufe4d-\\ufe4f\\uff10-\\uff19\\uff3f",ni="\\\\u[0-9a-fA-F]{4}|\\\\u\\{[0-9a-fA-F]+\\}",cr="(?:"+ni+"|["+Ou+ei+"])",Au="(?:"+ni+"|["+lr+ei+ur+"])*";vt.identifier=new RegExp(cr+Au,"g");vt.identifierStart=new RegExp(cr);vt.identifierMatch=new RegExp("(?:"+ni+"|["+lr+ei+ur+"])+");vt.newline=/[\n\r\u2028\u2029]/;vt.lineBreak=new RegExp(`\r
|`+vt.newline.source);vt.allLineBreaks=new RegExp(vt.lineBreak.source,"g")});var Xe=F((Ff,He)=>{"use strict";function Et(n,t){this.raw_options=hr(n,t),this.disabled=this._get_boolean("disabled"),this.eol=this._get_characters("eol","auto"),this.end_with_newline=this._get_boolean("end_with_newline"),this.indent_size=this._get_number("indent_size",4),this.indent_char=this._get_characters("indent_char"," "),this.indent_level=this._get_number("indent_level"),this.preserve_newlines=this._get_boolean("preserve_newlines",!0),this.max_preserve_newlines=this._get_number("max_preserve_newlines",32786),this.preserve_newlines||(this.max_preserve_newlines=0),this.indent_with_tabs=this._get_boolean("indent_with_tabs",this.indent_char==="	"),this.indent_with_tabs&&(this.indent_char="	",this.indent_size===1&&(this.indent_size=4)),this.wrap_line_length=this._get_number("wrap_line_length",this._get_number("max_char")),this.indent_empty_lines=this._get_boolean("indent_empty_lines"),this.templating=this._get_selection_list("templating",["auto","none","angular","django","erb","handlebars","php","smarty"],["auto"])}Et.prototype._get_array=function(n,t){var e=this.raw_options[n],i=t||[];return typeof e=="object"?e!==null&&typeof e.concat=="function"&&(i=e.concat()):typeof e=="string"&&(i=e.split(/[^a-zA-Z0-9_\/\-]+/)),i};Et.prototype._get_boolean=function(n,t){var e=this.raw_options[n],i=e===void 0?!!t:!!e;return i};Et.prototype._get_characters=function(n,t){var e=this.raw_options[n],i=t||"";return typeof e=="string"&&(i=e.replace(/\\r/,"\r").replace(/\\n/,`
`).replace(/\\t/,"	")),i};Et.prototype._get_number=function(n,t){var e=this.raw_options[n];t=parseInt(t,10),isNaN(t)&&(t=0);var i=parseInt(e,10);return isNaN(i)&&(i=t),i};Et.prototype._get_selection=function(n,t,e){var i=this._get_selection_list(n,t,e);if(i.length!==1)throw new Error("Invalid Option Value: The option '"+n+`' can only be one of the following values:
`+t+`
You passed in: '`+this.raw_options[n]+"'");return i[0]};Et.prototype._get_selection_list=function(n,t,e){if(!t||t.length===0)throw new Error("Selection list cannot be empty.");if(e=e||[t[0]],!this._is_valid_selection(e,t))throw new Error("Invalid Default Value!");var i=this._get_array(n,e);if(!this._is_valid_selection(i,t))throw new Error("Invalid Option Value: The option '"+n+`' can contain only the following values:
`+t+`
You passed in: '`+this.raw_options[n]+"'");return i};Et.prototype._is_valid_selection=function(n,t){return n.length&&t.length&&!n.some(function(e){return t.indexOf(e)===-1})};function hr(n,t){var e={};n=fr(n);var i;for(i in n)i!==t&&(e[i]=n[i]);if(t&&n[t])for(i in n[t])e[i]=n[t][i];return e}function fr(n){var t={},e;for(e in n){var i=e.replace(/-/g,"_");t[i]=n[e]}return t}He.exports.Options=Et;He.exports.normalizeOpts=fr;He.exports.mergeOpts=hr});var si=F((Wf,_r)=>{"use strict";var pr=Xe().Options,Cu=["before-newline","after-newline","preserve-newline"];function dr(n){pr.call(this,n,"js");var t=this.raw_options.brace_style||null;t==="expand-strict"?this.raw_options.brace_style="expand":t==="collapse-preserve-inline"?this.raw_options.brace_style="collapse,preserve-inline":this.raw_options.braces_on_own_line!==void 0&&(this.raw_options.brace_style=this.raw_options.braces_on_own_line?"expand":"collapse");var e=this._get_selection_list("brace_style",["collapse","expand","end-expand","none","preserve-inline"]);this.brace_preserve_inline=!1,this.brace_style="collapse";for(var i=0;i<e.length;i++)e[i]==="preserve-inline"?this.brace_preserve_inline=!0:this.brace_style=e[i];this.unindent_chained_methods=this._get_boolean("unindent_chained_methods"),this.break_chained_methods=this._get_boolean("break_chained_methods"),this.space_in_paren=this._get_boolean("space_in_paren"),this.space_in_empty_paren=this._get_boolean("space_in_empty_paren"),this.jslint_happy=this._get_boolean("jslint_happy"),this.space_after_anon_function=this._get_boolean("space_after_anon_function"),this.space_after_named_function=this._get_boolean("space_after_named_function"),this.keep_array_indentation=this._get_boolean("keep_array_indentation"),this.space_before_conditional=this._get_boolean("space_before_conditional",!0),this.unescape_strings=this._get_boolean("unescape_strings"),this.e4x=this._get_boolean("e4x"),this.comma_first=this._get_boolean("comma_first"),this.operator_position=this._get_selection("operator_position",Cu),this.test_output_raw=this._get_boolean("test_output_raw"),this.jslint_happy&&(this.space_after_anon_function=!0)}dr.prototype=new pr;_r.exports.Options=dr});var Ge=F(($f,gr)=>{"use strict";var mr=RegExp.prototype.hasOwnProperty("sticky");function Y(n){this.__input=n||"",this.__input_length=this.__input.length,this.__position=0}Y.prototype.restart=function(){this.__position=0};Y.prototype.back=function(){this.__position>0&&(this.__position-=1)};Y.prototype.hasNext=function(){return this.__position<this.__input_length};Y.prototype.next=function(){var n=null;return this.hasNext()&&(n=this.__input.charAt(this.__position),this.__position+=1),n};Y.prototype.peek=function(n){var t=null;return n=n||0,n+=this.__position,n>=0&&n<this.__input_length&&(t=this.__input.charAt(n)),t};Y.prototype.__match=function(n,t){n.lastIndex=t;var e=n.exec(this.__input);return e&&!(mr&&n.sticky)&&e.index!==t&&(e=null),e};Y.prototype.test=function(n,t){return t=t||0,t+=this.__position,t>=0&&t<this.__input_length?!!this.__match(n,t):!1};Y.prototype.testChar=function(n,t){var e=this.peek(t);return n.lastIndex=0,e!==null&&n.test(e)};Y.prototype.match=function(n){var t=this.__match(n,this.__position);return t?this.__position+=t[0].length:t=null,t};Y.prototype.read=function(n,t,e){var i="",s;return n&&(s=this.match(n),s&&(i+=s[0])),t&&(s||!n)&&(i+=this.readUntil(t,e)),i};Y.prototype.readUntil=function(n,t){var e="",i=this.__position;n.lastIndex=this.__position;var s=n.exec(this.__input);return s?(i=s.index,t&&(i+=s[0].length)):i=this.__input_length,e=this.__input.substring(this.__position,i),this.__position=i,e};Y.prototype.readUntilAfter=function(n){return this.readUntil(n,!0)};Y.prototype.get_regexp=function(n,t){var e=null,i="g";return t&&mr&&(i="y"),typeof n=="string"&&n!==""?e=new RegExp(n,i):n&&(e=new RegExp(n.source,i)),e};Y.prototype.get_literal_regexp=function(n){return RegExp(n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))};Y.prototype.peekUntilAfter=function(n){var t=this.__position,e=this.readUntilAfter(n);return this.__position=t,e};Y.prototype.lookBack=function(n){var t=this.__position-1;return t>=n.length&&this.__input.substring(t-n.length,t).toLowerCase()===n};gr.exports.InputScanner=Y});var wr=F((jf,yr)=>{"use strict";function Dt(n){this.__tokens=[],this.__tokens_length=this.__tokens.length,this.__position=0,this.__parent_token=n}Dt.prototype.restart=function(){this.__position=0};Dt.prototype.isEmpty=function(){return this.__tokens_length===0};Dt.prototype.hasNext=function(){return this.__position<this.__tokens_length};Dt.prototype.next=function(){var n=null;return this.hasNext()&&(n=this.__tokens[this.__position],this.__position+=1),n};Dt.prototype.peek=function(n){var t=null;return n=n||0,n+=this.__position,n>=0&&n<this.__tokens_length&&(t=this.__tokens[n]),t};Dt.prototype.add=function(n){this.__parent_token&&(n.parent=this.__parent_token),this.__tokens.push(n),this.__tokens_length+=1};yr.exports.TokenStream=Dt});var ue=F((Kf,br)=>{"use strict";function pt(n,t){this._input=n,this._starting_pattern=null,this._match_pattern=null,this._until_pattern=null,this._until_after=!1,t&&(this._starting_pattern=this._input.get_regexp(t._starting_pattern,!0),this._match_pattern=this._input.get_regexp(t._match_pattern,!0),this._until_pattern=this._input.get_regexp(t._until_pattern),this._until_after=t._until_after)}pt.prototype.read=function(){var n=this._input.read(this._starting_pattern);return(!this._starting_pattern||n)&&(n+=this._input.read(this._match_pattern,this._until_pattern,this._until_after)),n};pt.prototype.read_match=function(){return this._input.match(this._match_pattern)};pt.prototype.until_after=function(n){var t=this._create();return t._until_after=!0,t._until_pattern=this._input.get_regexp(n),t._update(),t};pt.prototype.until=function(n){var t=this._create();return t._until_after=!1,t._until_pattern=this._input.get_regexp(n),t._update(),t};pt.prototype.starting_with=function(n){var t=this._create();return t._starting_pattern=this._input.get_regexp(n,!0),t._update(),t};pt.prototype.matching=function(n){var t=this._create();return t._match_pattern=this._input.get_regexp(n,!0),t._update(),t};pt.prototype._create=function(){return new pt(this._input,this)};pt.prototype._update=function(){};br.exports.Pattern=pt});var kr=F((Uf,xr)=>{"use strict";var vr=ue().Pattern;function Tt(n,t){vr.call(this,n,t),t?this._line_regexp=this._input.get_regexp(t._line_regexp):this.__set_whitespace_patterns("",""),this.newline_count=0,this.whitespace_before_token=""}Tt.prototype=new vr;Tt.prototype.__set_whitespace_patterns=function(n,t){n+="\\t ",t+="\\n\\r",this._match_pattern=this._input.get_regexp("["+n+t+"]+",!0),this._newline_regexp=this._input.get_regexp("\\r\\n|["+t+"]")};Tt.prototype.read=function(){this.newline_count=0,this.whitespace_before_token="";var n=this._input.read(this._match_pattern);if(n===" ")this.whitespace_before_token=" ";else if(n){var t=this.__split(this._newline_regexp,n);this.newline_count=t.length-1,this.whitespace_before_token=t[this.newline_count]}return n};Tt.prototype.matching=function(n,t){var e=this._create();return e.__set_whitespace_patterns(n,t),e._update(),e};Tt.prototype._create=function(){return new Tt(this._input,this)};Tt.prototype.__split=function(n,t){n.lastIndex=0;for(var e=0,i=[],s=n.exec(t);s;)i.push(t.substring(e,s.index)),e=s.index+s[0].length,s=n.exec(t);return e<t.length?i.push(t.substring(e,t.length)):i.push(""),i};xr.exports.WhitespacePattern=Tt});var he=F((Vf,oi)=>{"use strict";var Ru=Ge().InputScanner,Sr=ti().Token,ri=wr().TokenStream,Nu=kr().WhitespacePattern,ce={START:"TK_START",RAW:"TK_RAW",EOF:"TK_EOF"},dt=function(n,t){this._input=new Ru(n),this._options=t||{},this.__tokens=null,this._patterns={},this._patterns.whitespace=new Nu(this._input)};dt.prototype.tokenize=function(){this._input.restart(),this.__tokens=new ri,this._reset();for(var n,t=new Sr(ce.START,""),e=null,i=[],s=new ri;t.type!==ce.EOF;){for(n=this._get_next_token(t,e);this._is_comment(n);)s.add(n),n=this._get_next_token(t,e);s.isEmpty()||(n.comments_before=s,s=new ri),n.parent=e,this._is_opening(n)?(i.push(e),e=n):e&&this._is_closing(n,e)&&(n.opened=e,e.closed=n,e=i.pop(),n.parent=e),n.previous=t,t.next=n,this.__tokens.add(n),t=n}return this.__tokens};dt.prototype._is_first_token=function(){return this.__tokens.isEmpty()};dt.prototype._reset=function(){};dt.prototype._get_next_token=function(n,t){this._readWhitespace();var e=this._input.read(/.+/g);return e?this._create_token(ce.RAW,e):this._create_token(ce.EOF,"")};dt.prototype._is_comment=function(n){return!1};dt.prototype._is_opening=function(n){return!1};dt.prototype._is_closing=function(n,t){return!1};dt.prototype._create_token=function(n,t){var e=new Sr(n,t,this._patterns.whitespace.newline_count,this._patterns.whitespace.whitespace_before_token);return e};dt.prototype._readWhitespace=function(){return this._patterns.whitespace.read()};oi.exports.Tokenizer=dt;oi.exports.TOKEN=ce});var Qe=F((Jf,Er)=>{"use strict";function ai(n,t){n=typeof n=="string"?n:n.source,t=typeof t=="string"?t:t.source,this.__directives_block_pattern=new RegExp(n+/ beautify( \w+[:]\w+)+ /.source+t,"g"),this.__directive_pattern=/ (\w+)[:](\w+)/g,this.__directives_end_ignore_pattern=new RegExp(n+/\sbeautify\signore:end\s/.source+t,"g")}ai.prototype.get_directives=function(n){if(!n.match(this.__directives_block_pattern))return null;var t={};this.__directive_pattern.lastIndex=0;for(var e=this.__directive_pattern.exec(n);e;)t[e[1]]=e[2],e=this.__directive_pattern.exec(n);return t};ai.prototype.readIgnored=function(n){return n.readUntilAfter(this.__directives_end_ignore_pattern)};Er.exports.Directives=ai});var ci=F((qf,Tr)=>{"use strict";var li=ue().Pattern,ui={django:!1,erb:!1,handlebars:!1,php:!1,smarty:!1,angular:!1};function ft(n,t){li.call(this,n,t),this.__template_pattern=null,this._disabled=Object.assign({},ui),this._excluded=Object.assign({},ui),t&&(this.__template_pattern=this._input.get_regexp(t.__template_pattern),this._excluded=Object.assign(this._excluded,t._excluded),this._disabled=Object.assign(this._disabled,t._disabled));var e=new li(n);this.__patterns={handlebars_comment:e.starting_with(/{{!--/).until_after(/--}}/),handlebars_unescaped:e.starting_with(/{{{/).until_after(/}}}/),handlebars:e.starting_with(/{{/).until_after(/}}/),php:e.starting_with(/<\?(?:[= ]|php)/).until_after(/\?>/),erb:e.starting_with(/<%[^%]/).until_after(/[^%]%>/),django:e.starting_with(/{%/).until_after(/%}/),django_value:e.starting_with(/{{/).until_after(/}}/),django_comment:e.starting_with(/{#/).until_after(/#}/),smarty:e.starting_with(/{(?=[^}{\s\n])/).until_after(/[^\s\n]}/),smarty_comment:e.starting_with(/{\*/).until_after(/\*}/),smarty_literal:e.starting_with(/{literal}/).until_after(/{\/literal}/)}}ft.prototype=new li;ft.prototype._create=function(){return new ft(this._input,this)};ft.prototype._update=function(){this.__set_templated_pattern()};ft.prototype.disable=function(n){var t=this._create();return t._disabled[n]=!0,t._update(),t};ft.prototype.read_options=function(n){var t=this._create();for(var e in ui)t._disabled[e]=n.templating.indexOf(e)===-1;return t._update(),t};ft.prototype.exclude=function(n){var t=this._create();return t._excluded[n]=!0,t._update(),t};ft.prototype.read=function(){var n="";this._match_pattern?n=this._input.read(this._starting_pattern):n=this._input.read(this._starting_pattern,this.__template_pattern);for(var t=this._read_template();t;)this._match_pattern?t+=this._input.read(this._match_pattern):t+=this._input.readUntil(this.__template_pattern),n+=t,t=this._read_template();return this._until_after&&(n+=this._input.readUntilAfter(this._until_pattern)),n};ft.prototype.__set_templated_pattern=function(){var n=[];this._disabled.php||n.push(this.__patterns.php._starting_pattern.source),this._disabled.handlebars||n.push(this.__patterns.handlebars._starting_pattern.source),this._disabled.angular||n.push(this.__patterns.handlebars._starting_pattern.source),this._disabled.erb||n.push(this.__patterns.erb._starting_pattern.source),this._disabled.django||(n.push(this.__patterns.django._starting_pattern.source),n.push(this.__patterns.django_value._starting_pattern.source),n.push(this.__patterns.django_comment._starting_pattern.source)),this._disabled.smarty||n.push(this.__patterns.smarty._starting_pattern.source),this._until_pattern&&n.push(this._until_pattern.source),this.__template_pattern=this._input.get_regexp("(?:"+n.join("|")+")")};ft.prototype._read_template=function(){var n="",t=this._input.peek();if(t==="<"){var e=this._input.peek(1);!this._disabled.php&&!this._excluded.php&&e==="?"&&(n=n||this.__patterns.php.read()),!this._disabled.erb&&!this._excluded.erb&&e==="%"&&(n=n||this.__patterns.erb.read())}else t==="{"&&(!this._disabled.handlebars&&!this._excluded.handlebars&&(n=n||this.__patterns.handlebars_comment.read(),n=n||this.__patterns.handlebars_unescaped.read(),n=n||this.__patterns.handlebars.read()),this._disabled.django||(!this._excluded.django&&!this._excluded.handlebars&&(n=n||this.__patterns.django_value.read()),this._excluded.django||(n=n||this.__patterns.django_comment.read(),n=n||this.__patterns.django.read())),this._disabled.smarty||this._disabled.django&&this._disabled.handlebars&&(n=n||this.__patterns.smarty_comment.read(),n=n||this.__patterns.smarty_literal.read(),n=n||this.__patterns.smarty.read()));return n};Tr.exports.TemplatablePattern=ft});var pe=F((Hf,fe)=>{"use strict";var Iu=Ge().InputScanner,Or=he().Tokenizer,hi=he().TOKEN,Pu=Qe().Directives,ut=ii(),zu=ue().Pattern,Lu=ci().TemplatablePattern;function fi(n,t){return t.indexOf(n)!==-1}var k={START_EXPR:"TK_START_EXPR",END_EXPR:"TK_END_EXPR",START_BLOCK:"TK_START_BLOCK",END_BLOCK:"TK_END_BLOCK",WORD:"TK_WORD",RESERVED:"TK_RESERVED",SEMICOLON:"TK_SEMICOLON",STRING:"TK_STRING",EQUALS:"TK_EQUALS",OPERATOR:"TK_OPERATOR",COMMA:"TK_COMMA",BLOCK_COMMENT:"TK_BLOCK_COMMENT",COMMENT:"TK_COMMENT",DOT:"TK_DOT",UNKNOWN:"TK_UNKNOWN",START:hi.START,RAW:hi.RAW,EOF:hi.EOF},Mr=new Pu(/\/\*/,/\*\//),Du=/0[xX][0123456789abcdefABCDEF_]*n?|0[oO][01234567_]*n?|0[bB][01_]*n?|\d[\d_]*n|(?:\.\d[\d_]*|\d[\d_]*\.?[\d_]*)(?:[eE][+-]?[\d_]+)?/,Bu=/[0-9]/,Fu=/[^\d\.]/,Wu=">>> === !== &&= ??= ||= << && >= ** != == <= >> || ?? |> < / - + > : & % ? ^ | *".split(" "),Bt=">>>= ... >>= <<= === >>> !== **= &&= ??= ||= => ^= :: /= << <= == && -= >= >> != -- += ** || ?? ++ %= &= *= |= |> = ! ? > < : / ^ - + * & % ~ |";Bt=Bt.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&");Bt="\\?\\.(?!\\d) "+Bt;Bt=Bt.replace(/ /g,"|");var $u=new RegExp(Bt),Ar="continue,try,throw,return,var,let,const,if,switch,case,default,for,while,break,function,import,export".split(","),ju=Ar.concat(["do","in","of","else","get","set","new","catch","finally","typeof","yield","async","await","from","as","class","extends"]),Ku=new RegExp("^(?:"+ju.join("|")+")$"),Ye,H=function(n,t){Or.call(this,n,t),this._patterns.whitespace=this._patterns.whitespace.matching(/\u00A0\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff/.source,/\u2028\u2029/.source);var e=new zu(this._input),i=new Lu(this._input).read_options(this._options);this.__patterns={template:i,identifier:i.starting_with(ut.identifier).matching(ut.identifierMatch),number:e.matching(Du),punct:e.matching($u),comment:e.starting_with(/\/\//).until(/[\n\r\u2028\u2029]/),block_comment:e.starting_with(/\/\*/).until_after(/\*\//),html_comment_start:e.matching(/<!--/),html_comment_end:e.matching(/-->/),include:e.starting_with(/#include/).until_after(ut.lineBreak),shebang:e.starting_with(/#!/).until_after(ut.lineBreak),xml:e.matching(/[\s\S]*?<(\/?)([-a-zA-Z:0-9_.]+|{[^}]+?}|!\[CDATA\[[^\]]*?\]\]|)(\s*{[^}]+?}|\s+[-a-zA-Z:0-9_.]+|\s+[-a-zA-Z:0-9_.]+\s*=\s*('[^']*'|"[^"]*"|{([^{}]|{[^}]+?})+?}))*\s*(\/?)\s*>/),single_quote:i.until(/['\\\n\r\u2028\u2029]/),double_quote:i.until(/["\\\n\r\u2028\u2029]/),template_text:i.until(/[`\\$]/),template_expression:i.until(/[`}\\]/)}};H.prototype=new Or;H.prototype._is_comment=function(n){return n.type===k.COMMENT||n.type===k.BLOCK_COMMENT||n.type===k.UNKNOWN};H.prototype._is_opening=function(n){return n.type===k.START_BLOCK||n.type===k.START_EXPR};H.prototype._is_closing=function(n,t){return(n.type===k.END_BLOCK||n.type===k.END_EXPR)&&t&&(n.text==="]"&&t.text==="["||n.text===")"&&t.text==="("||n.text==="}"&&t.text==="{")};H.prototype._reset=function(){Ye=!1};H.prototype._get_next_token=function(n,t){var e=null;this._readWhitespace();var i=this._input.peek();return i===null?this._create_token(k.EOF,""):(e=e||this._read_non_javascript(i),e=e||this._read_string(i),e=e||this._read_pair(i,this._input.peek(1)),e=e||this._read_word(n),e=e||this._read_singles(i),e=e||this._read_comment(i),e=e||this._read_regexp(i,n),e=e||this._read_xml(i,n),e=e||this._read_punctuation(),e=e||this._create_token(k.UNKNOWN,this._input.next()),e)};H.prototype._read_word=function(n){var t;if(t=this.__patterns.identifier.read(),t!=="")return t=t.replace(ut.allLineBreaks,`
`),!(n.type===k.DOT||n.type===k.RESERVED&&(n.text==="set"||n.text==="get"))&&Ku.test(t)?(t==="in"||t==="of")&&(n.type===k.WORD||n.type===k.STRING)?this._create_token(k.OPERATOR,t):this._create_token(k.RESERVED,t):this._create_token(k.WORD,t);if(t=this.__patterns.number.read(),t!=="")return this._create_token(k.WORD,t)};H.prototype._read_singles=function(n){var t=null;return n==="("||n==="["?t=this._create_token(k.START_EXPR,n):n===")"||n==="]"?t=this._create_token(k.END_EXPR,n):n==="{"?t=this._create_token(k.START_BLOCK,n):n==="}"?t=this._create_token(k.END_BLOCK,n):n===";"?t=this._create_token(k.SEMICOLON,n):n==="."&&Fu.test(this._input.peek(1))?t=this._create_token(k.DOT,n):n===","&&(t=this._create_token(k.COMMA,n)),t&&this._input.next(),t};H.prototype._read_pair=function(n,t){var e=null;return n==="#"&&t==="{"&&(e=this._create_token(k.START_BLOCK,n+t)),e&&(this._input.next(),this._input.next()),e};H.prototype._read_punctuation=function(){var n=this.__patterns.punct.read();if(n!=="")return n==="="?this._create_token(k.EQUALS,n):n==="?."?this._create_token(k.DOT,n):this._create_token(k.OPERATOR,n)};H.prototype._read_non_javascript=function(n){var t="";if(n==="#"){if(this._is_first_token()&&(t=this.__patterns.shebang.read(),t))return this._create_token(k.UNKNOWN,t.trim()+`
`);if(t=this.__patterns.include.read(),t)return this._create_token(k.UNKNOWN,t.trim()+`
`);n=this._input.next();var e="#";if(this._input.hasNext()&&this._input.testChar(Bu)){do n=this._input.next(),e+=n;while(this._input.hasNext()&&n!=="#"&&n!=="=");return n==="#"||(this._input.peek()==="["&&this._input.peek(1)==="]"?(e+="[]",this._input.next(),this._input.next()):this._input.peek()==="{"&&this._input.peek(1)==="}"&&(e+="{}",this._input.next(),this._input.next())),this._create_token(k.WORD,e)}this._input.back()}else if(n==="<"&&this._is_first_token()){if(t=this.__patterns.html_comment_start.read(),t){for(;this._input.hasNext()&&!this._input.testChar(ut.newline);)t+=this._input.next();return Ye=!0,this._create_token(k.COMMENT,t)}}else if(Ye&&n==="-"&&(t=this.__patterns.html_comment_end.read(),t))return Ye=!1,this._create_token(k.COMMENT,t);return null};H.prototype._read_comment=function(n){var t=null;if(n==="/"){var e="";if(this._input.peek(1)==="*"){e=this.__patterns.block_comment.read();var i=Mr.get_directives(e);i&&i.ignore==="start"&&(e+=Mr.readIgnored(this._input)),e=e.replace(ut.allLineBreaks,`
`),t=this._create_token(k.BLOCK_COMMENT,e),t.directives=i}else this._input.peek(1)==="/"&&(e=this.__patterns.comment.read(),t=this._create_token(k.COMMENT,e))}return t};H.prototype._read_string=function(n){if(n==="`"||n==="'"||n==='"'){var t=this._input.next();return this.has_char_escapes=!1,n==="`"?t+=this._read_string_recursive("`",!0,"${"):t+=this._read_string_recursive(n),this.has_char_escapes&&this._options.unescape_strings&&(t=Uu(t)),this._input.peek()===n&&(t+=this._input.next()),t=t.replace(ut.allLineBreaks,`
`),this._create_token(k.STRING,t)}return null};H.prototype._allow_regexp_or_xml=function(n){return n.type===k.RESERVED&&fi(n.text,["return","case","throw","else","do","typeof","yield"])||n.type===k.END_EXPR&&n.text===")"&&n.opened.previous.type===k.RESERVED&&fi(n.opened.previous.text,["if","while","for"])||fi(n.type,[k.COMMENT,k.START_EXPR,k.START_BLOCK,k.START,k.END_BLOCK,k.OPERATOR,k.EQUALS,k.EOF,k.SEMICOLON,k.COMMA])};H.prototype._read_regexp=function(n,t){if(n==="/"&&this._allow_regexp_or_xml(t)){for(var e=this._input.next(),i=!1,s=!1;this._input.hasNext()&&(i||s||this._input.peek()!==n)&&!this._input.testChar(ut.newline);)e+=this._input.peek(),i?i=!1:(i=this._input.peek()==="\\",this._input.peek()==="["?s=!0:this._input.peek()==="]"&&(s=!1)),this._input.next();return this._input.peek()===n&&(e+=this._input.next(),e+=this._input.read(ut.identifier)),this._create_token(k.STRING,e)}return null};H.prototype._read_xml=function(n,t){if(this._options.e4x&&n==="<"&&this._allow_regexp_or_xml(t)){var e="",i=this.__patterns.xml.read_match();if(i){for(var s=i[2].replace(/^{\s+/,"{").replace(/\s+}$/,"}"),r=s.indexOf("{")===0,o=0;i;){var a=!!i[1],l=i[2],u=!!i[i.length-1]||l.slice(0,8)==="![CDATA[";if(!u&&(l===s||r&&l.replace(/^{\s+/,"{").replace(/\s+}$/,"}"))&&(a?--o:++o),e+=i[0],o<=0)break;i=this.__patterns.xml.read_match()}return i||(e+=this._input.match(/[\s\S]*/g)[0]),e=e.replace(ut.allLineBreaks,`
`),this._create_token(k.STRING,e)}}return null};function Uu(n){for(var t="",e=0,i=new Iu(n),s=null;i.hasNext();)if(s=i.match(/([\s]|[^\\]|\\\\)+/g),s&&(t+=s[0]),i.peek()==="\\"){if(i.next(),i.peek()==="x")s=i.match(/x([0-9A-Fa-f]{2})/g);else if(i.peek()==="u")s=i.match(/u([0-9A-Fa-f]{4})/g),s||(s=i.match(/u\{([0-9A-Fa-f]+)\}/g));else{t+="\\",i.hasNext()&&(t+=i.next());continue}if(!s||(e=parseInt(s[1],16),e>126&&e<=255&&s[0].indexOf("x")===0))return n;e>=0&&e<32||e>1114111?t+="\\"+s[0]:e===34||e===39||e===92?t+="\\"+String.fromCharCode(e):t+=String.fromCharCode(e)}return t}H.prototype._read_string_recursive=function(n,t,e){var i,s;n==="'"?s=this.__patterns.single_quote:n==='"'?s=this.__patterns.double_quote:n==="`"?s=this.__patterns.template_text:n==="}"&&(s=this.__patterns.template_expression);for(var r=s.read(),o="";this._input.hasNext();){if(o=this._input.next(),o===n||!t&&ut.newline.test(o)){this._input.back();break}else o==="\\"&&this._input.hasNext()?(i=this._input.peek(),i==="x"||i==="u"?this.has_char_escapes=!0:i==="\r"&&this._input.peek(1)===`
`&&this._input.next(),o+=this._input.next()):e&&(e==="${"&&o==="$"&&this._input.peek()==="{"&&(o+=this._input.next()),e===o&&(n==="`"?o+=this._read_string_recursive("}",t,"`"):o+=this._read_string_recursive("`",t,"${"),this._input.hasNext()&&(o+=this._input.next())));o+=s.read(),r+=o}return r};fe.exports.Tokenizer=H;fe.exports.TOKEN=k;fe.exports.positionable_operators=Wu.slice();fe.exports.line_starters=Ar.slice()});var Ir=F((Xf,Nr)=>{"use strict";var Vu=qe().Output,Ju=ti().Token,Ze=ii(),qu=si().Options,Hu=pe().Tokenizer,ge=pe().line_starters,de=pe().positionable_operators,g=pe().TOKEN;function M(n,t){return t.indexOf(n)!==-1}function Xu(n){return n.replace(/^\s+/g,"")}function Gu(n){for(var t={},e=0;e<n.length;e++)t[n[e].replace(/-/g,"_")]=n[e];return t}function ct(n,t){return n&&n.type===g.RESERVED&&n.text===t}function D(n,t){return n&&n.type===g.RESERVED&&M(n.text,t)}var tn=["case","return","do","if","throw","else","await","break","continue","async"],Qu=["before-newline","after-newline","preserve-newline"],_e=Gu(Qu),Cr=[_e.before_newline,_e.preserve_newline],S={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"};function Rr(n,t){t.multiline_frame||t.mode===S.ForInitializer||t.mode===S.Conditional||n.remove_indent(t.start_line_index)}function Yu(n){n=n.replace(Ze.allLineBreaks,`
`);for(var t=[],e=n.indexOf(`
`);e!==-1;)t.push(n.substring(0,e)),n=n.substring(e+1),e=n.indexOf(`
`);return n.length&&t.push(n),t}function Mt(n){return n===S.ArrayLiteral}function me(n){return M(n,[S.Expression,S.ForInitializer,S.Conditional])}function Zu(n,t){for(var e=0;e<n.length;e++){var i=n[e].trim();if(i.charAt(0)!==t)return!1}return!0}function tc(n,t){for(var e=0,i=n.length,s;e<i;e++)if(s=n[e],s&&s.indexOf(t)!==0)return!1;return!0}function C(n,t){t=t||{},this._source_text=n||"",this._output=null,this._tokens=null,this._last_last_text=null,this._flags=null,this._previous_flags=null,this._flag_store=null,this._options=new qu(t)}C.prototype.create_flags=function(n,t){var e=0;n&&(e=n.indentation_level,!this._output.just_added_newline()&&n.line_indent_level>e&&(e=n.line_indent_level));var i={mode:t,parent:n,last_token:n?n.last_token:new Ju(g.START_BLOCK,""),last_word:n?n.last_word:"",declaration_statement:!1,declaration_assignment:!1,multiline_frame:!1,inline_frame:!1,if_block:!1,else_block:!1,class_start_block:!1,do_block:!1,do_while:!1,import_block:!1,in_case_statement:!1,in_case:!1,case_body:!1,case_block:!1,indentation_level:e,alignment:0,line_indent_level:n?n.line_indent_level:e,start_line_index:this._output.get_line_number(),ternary_depth:0};return i};C.prototype._reset=function(n){var t=n.match(/^[\t ]*/)[0];this._last_last_text="",this._output=new Vu(this._options,t),this._output.raw=this._options.test_output_raw,this._flag_store=[],this.set_mode(S.BlockStatement);var e=new Hu(n,this._options);return this._tokens=e.tokenize(),n};C.prototype.beautify=function(){if(this._options.disabled)return this._source_text;var n,t=this._reset(this._source_text),e=this._options.eol;this._options.eol==="auto"&&(e=`
`,t&&Ze.lineBreak.test(t||"")&&(e=t.match(Ze.lineBreak)[0]));for(var i=this._tokens.next();i;)this.handle_token(i),this._last_last_text=this._flags.last_token.text,this._flags.last_token=i,i=this._tokens.next();return n=this._output.get_code(e),n};C.prototype.handle_token=function(n,t){n.type===g.START_EXPR?this.handle_start_expr(n):n.type===g.END_EXPR?this.handle_end_expr(n):n.type===g.START_BLOCK?this.handle_start_block(n):n.type===g.END_BLOCK?this.handle_end_block(n):n.type===g.WORD?this.handle_word(n):n.type===g.RESERVED?this.handle_word(n):n.type===g.SEMICOLON?this.handle_semicolon(n):n.type===g.STRING?this.handle_string(n):n.type===g.EQUALS?this.handle_equals(n):n.type===g.OPERATOR?this.handle_operator(n):n.type===g.COMMA?this.handle_comma(n):n.type===g.BLOCK_COMMENT?this.handle_block_comment(n,t):n.type===g.COMMENT?this.handle_comment(n,t):n.type===g.DOT?this.handle_dot(n):n.type===g.EOF?this.handle_eof(n):n.type===g.UNKNOWN?this.handle_unknown(n,t):this.handle_unknown(n,t)};C.prototype.handle_whitespace_and_comments=function(n,t){var e=n.newlines,i=this._options.keep_array_indentation&&Mt(this._flags.mode);if(n.comments_before)for(var s=n.comments_before.next();s;)this.handle_whitespace_and_comments(s,t),this.handle_token(s,t),s=n.comments_before.next();if(i)for(var r=0;r<e;r+=1)this.print_newline(r>0,t);else if(this._options.max_preserve_newlines&&e>this._options.max_preserve_newlines&&(e=this._options.max_preserve_newlines),this._options.preserve_newlines&&e>1){this.print_newline(!1,t);for(var o=1;o<e;o+=1)this.print_newline(!0,t)}};var pi=["async","break","continue","return","throw","yield"];C.prototype.allow_wrap_or_preserved_newline=function(n,t){if(t=t===void 0?!1:t,!this._output.just_added_newline()){var e=this._options.preserve_newlines&&n.newlines||t,i=M(this._flags.last_token.text,de)||M(n.text,de);if(i){var s=M(this._flags.last_token.text,de)&&M(this._options.operator_position,Cr)||M(n.text,de);e=e&&s}if(e)this.print_newline(!1,!0);else if(this._options.wrap_line_length){if(D(this._flags.last_token,pi))return;this._output.set_wrap_point()}}};C.prototype.print_newline=function(n,t){if(!t&&this._flags.last_token.text!==";"&&this._flags.last_token.text!==","&&this._flags.last_token.text!=="="&&(this._flags.last_token.type!==g.OPERATOR||this._flags.last_token.text==="--"||this._flags.last_token.text==="++"))for(var e=this._tokens.peek();this._flags.mode===S.Statement&&!(this._flags.if_block&&ct(e,"else"))&&!this._flags.do_block;)this.restore_mode();this._output.add_new_line(n)&&(this._flags.multiline_frame=!0)};C.prototype.print_token_line_indentation=function(n){this._output.just_added_newline()&&(this._options.keep_array_indentation&&n.newlines&&(n.text==="["||Mt(this._flags.mode))?(this._output.current_line.set_indent(-1),this._output.current_line.push(n.whitespace_before),this._output.space_before_token=!1):this._output.set_indent(this._flags.indentation_level,this._flags.alignment)&&(this._flags.line_indent_level=this._flags.indentation_level))};C.prototype.print_token=function(n){if(this._output.raw){this._output.add_raw_token(n);return}if(this._options.comma_first&&n.previous&&n.previous.type===g.COMMA&&this._output.just_added_newline()&&this._output.previous_line.last()===","){var t=this._output.previous_line.pop();this._output.previous_line.is_empty()&&(this._output.previous_line.push(t),this._output.trim(!0),this._output.current_line.pop(),this._output.trim()),this.print_token_line_indentation(n),this._output.add_token(","),this._output.space_before_token=!0}this.print_token_line_indentation(n),this._output.non_breaking_space=!0,this._output.add_token(n.text),this._output.previous_token_wrapped&&(this._flags.multiline_frame=!0)};C.prototype.indent=function(){this._flags.indentation_level+=1,this._output.set_indent(this._flags.indentation_level,this._flags.alignment)};C.prototype.deindent=function(){this._flags.indentation_level>0&&(!this._flags.parent||this._flags.indentation_level>this._flags.parent.indentation_level)&&(this._flags.indentation_level-=1,this._output.set_indent(this._flags.indentation_level,this._flags.alignment))};C.prototype.set_mode=function(n){this._flags?(this._flag_store.push(this._flags),this._previous_flags=this._flags):this._previous_flags=this.create_flags(null,n),this._flags=this.create_flags(this._previous_flags,n),this._output.set_indent(this._flags.indentation_level,this._flags.alignment)};C.prototype.restore_mode=function(){this._flag_store.length>0&&(this._previous_flags=this._flags,this._flags=this._flag_store.pop(),this._previous_flags.mode===S.Statement&&Rr(this._output,this._previous_flags),this._output.set_indent(this._flags.indentation_level,this._flags.alignment))};C.prototype.start_of_object_property=function(){return this._flags.parent.mode===S.ObjectLiteral&&this._flags.mode===S.Statement&&(this._flags.last_token.text===":"&&this._flags.ternary_depth===0||D(this._flags.last_token,["get","set"]))};C.prototype.start_of_statement=function(n){var t=!1;return t=t||D(this._flags.last_token,["var","let","const"])&&n.type===g.WORD,t=t||ct(this._flags.last_token,"do"),t=t||!(this._flags.parent.mode===S.ObjectLiteral&&this._flags.mode===S.Statement)&&D(this._flags.last_token,pi)&&!n.newlines,t=t||ct(this._flags.last_token,"else")&&!(ct(n,"if")&&!n.comments_before),t=t||this._flags.last_token.type===g.END_EXPR&&(this._previous_flags.mode===S.ForInitializer||this._previous_flags.mode===S.Conditional),t=t||this._flags.last_token.type===g.WORD&&this._flags.mode===S.BlockStatement&&!this._flags.in_case&&!(n.text==="--"||n.text==="++")&&this._last_last_text!=="function"&&n.type!==g.WORD&&n.type!==g.RESERVED,t=t||this._flags.mode===S.ObjectLiteral&&(this._flags.last_token.text===":"&&this._flags.ternary_depth===0||D(this._flags.last_token,["get","set"])),t?(this.set_mode(S.Statement),this.indent(),this.handle_whitespace_and_comments(n,!0),this.start_of_object_property()||this.allow_wrap_or_preserved_newline(n,D(n,["do","for","if","while"])),!0):!1};C.prototype.handle_start_expr=function(n){this.start_of_statement(n)||this.handle_whitespace_and_comments(n);var t=S.Expression;if(n.text==="["){if(this._flags.last_token.type===g.WORD||this._flags.last_token.text===")"){D(this._flags.last_token,ge)&&(this._output.space_before_token=!0),this.print_token(n),this.set_mode(t),this.indent(),this._options.space_in_paren&&(this._output.space_before_token=!0);return}t=S.ArrayLiteral,Mt(this._flags.mode)&&(this._flags.last_token.text==="["||this._flags.last_token.text===","&&(this._last_last_text==="]"||this._last_last_text==="}"))&&(this._options.keep_array_indentation||this.print_newline()),M(this._flags.last_token.type,[g.START_EXPR,g.END_EXPR,g.WORD,g.OPERATOR,g.DOT])||(this._output.space_before_token=!0)}else{if(this._flags.last_token.type===g.RESERVED)this._flags.last_token.text==="for"?(this._output.space_before_token=this._options.space_before_conditional,t=S.ForInitializer):M(this._flags.last_token.text,["if","while","switch"])?(this._output.space_before_token=this._options.space_before_conditional,t=S.Conditional):M(this._flags.last_word,["await","async"])?this._output.space_before_token=!0:this._flags.last_token.text==="import"&&n.whitespace_before===""?this._output.space_before_token=!1:(M(this._flags.last_token.text,ge)||this._flags.last_token.text==="catch")&&(this._output.space_before_token=!0);else if(this._flags.last_token.type===g.EQUALS||this._flags.last_token.type===g.OPERATOR)this.start_of_object_property()||this.allow_wrap_or_preserved_newline(n);else if(this._flags.last_token.type===g.WORD){this._output.space_before_token=!1;var e=this._tokens.peek(-3);if(this._options.space_after_named_function&&e){var i=this._tokens.peek(-4);D(e,["async","function"])||e.text==="*"&&D(i,["async","function"])?this._output.space_before_token=!0:this._flags.mode===S.ObjectLiteral?(e.text==="{"||e.text===","||e.text==="*"&&(i.text==="{"||i.text===","))&&(this._output.space_before_token=!0):this._flags.parent&&this._flags.parent.class_start_block&&(this._output.space_before_token=!0)}}else this.allow_wrap_or_preserved_newline(n);(this._flags.last_token.type===g.RESERVED&&(this._flags.last_word==="function"||this._flags.last_word==="typeof")||this._flags.last_token.text==="*"&&(M(this._last_last_text,["function","yield"])||this._flags.mode===S.ObjectLiteral&&M(this._last_last_text,["{",","])))&&(this._output.space_before_token=this._options.space_after_anon_function)}this._flags.last_token.text===";"||this._flags.last_token.type===g.START_BLOCK?this.print_newline():(this._flags.last_token.type===g.END_EXPR||this._flags.last_token.type===g.START_EXPR||this._flags.last_token.type===g.END_BLOCK||this._flags.last_token.text==="."||this._flags.last_token.type===g.COMMA)&&this.allow_wrap_or_preserved_newline(n,n.newlines),this.print_token(n),this.set_mode(t),this._options.space_in_paren&&(this._output.space_before_token=!0),this.indent()};C.prototype.handle_end_expr=function(n){for(;this._flags.mode===S.Statement;)this.restore_mode();this.handle_whitespace_and_comments(n),this._flags.multiline_frame&&this.allow_wrap_or_preserved_newline(n,n.text==="]"&&Mt(this._flags.mode)&&!this._options.keep_array_indentation),this._options.space_in_paren&&(this._flags.last_token.type===g.START_EXPR&&!this._options.space_in_empty_paren?(this._output.trim(),this._output.space_before_token=!1):this._output.space_before_token=!0),this.deindent(),this.print_token(n),this.restore_mode(),Rr(this._output,this._previous_flags),this._flags.do_while&&this._previous_flags.mode===S.Conditional&&(this._previous_flags.mode=S.Expression,this._flags.do_block=!1,this._flags.do_while=!1)};C.prototype.handle_start_block=function(n){this.handle_whitespace_and_comments(n);var t=this._tokens.peek(),e=this._tokens.peek(1);this._flags.last_word==="switch"&&this._flags.last_token.type===g.END_EXPR?(this.set_mode(S.BlockStatement),this._flags.in_case_statement=!0):this._flags.case_body?this.set_mode(S.BlockStatement):e&&(M(e.text,[":",","])&&M(t.type,[g.STRING,g.WORD,g.RESERVED])||M(t.text,["get","set","..."])&&M(e.type,[g.WORD,g.RESERVED]))?M(this._last_last_text,["class","interface"])&&!M(e.text,[":",","])?this.set_mode(S.BlockStatement):this.set_mode(S.ObjectLiteral):this._flags.last_token.type===g.OPERATOR&&this._flags.last_token.text==="=>"?this.set_mode(S.BlockStatement):M(this._flags.last_token.type,[g.EQUALS,g.START_EXPR,g.COMMA,g.OPERATOR])||D(this._flags.last_token,["return","throw","import","default"])?this.set_mode(S.ObjectLiteral):this.set_mode(S.BlockStatement),this._flags.last_token&&D(this._flags.last_token.previous,["class","extends"])&&(this._flags.class_start_block=!0);var i=!t.comments_before&&t.text==="}",s=i&&this._flags.last_word==="function"&&this._flags.last_token.type===g.END_EXPR;if(this._options.brace_preserve_inline){var r=0,o=null;this._flags.inline_frame=!0;do if(r+=1,o=this._tokens.peek(r-1),o.newlines){this._flags.inline_frame=!1;break}while(o.type!==g.EOF&&!(o.type===g.END_BLOCK&&o.opened===n))}(this._options.brace_style==="expand"||this._options.brace_style==="none"&&n.newlines)&&!this._flags.inline_frame?this._flags.last_token.type!==g.OPERATOR&&(s||this._flags.last_token.type===g.EQUALS||D(this._flags.last_token,tn)&&this._flags.last_token.text!=="else")?this._output.space_before_token=!0:this.print_newline(!1,!0):(Mt(this._previous_flags.mode)&&(this._flags.last_token.type===g.START_EXPR||this._flags.last_token.type===g.COMMA)&&((this._flags.last_token.type===g.COMMA||this._options.space_in_paren)&&(this._output.space_before_token=!0),(this._flags.last_token.type===g.COMMA||this._flags.last_token.type===g.START_EXPR&&this._flags.inline_frame)&&(this.allow_wrap_or_preserved_newline(n),this._previous_flags.multiline_frame=this._previous_flags.multiline_frame||this._flags.multiline_frame,this._flags.multiline_frame=!1)),this._flags.last_token.type!==g.OPERATOR&&this._flags.last_token.type!==g.START_EXPR&&(M(this._flags.last_token.type,[g.START_BLOCK,g.SEMICOLON])&&!this._flags.inline_frame?this.print_newline():this._output.space_before_token=!0)),this.print_token(n),this.indent(),!i&&!(this._options.brace_preserve_inline&&this._flags.inline_frame)&&this.print_newline()};C.prototype.handle_end_block=function(n){for(this.handle_whitespace_and_comments(n);this._flags.mode===S.Statement;)this.restore_mode();var t=this._flags.last_token.type===g.START_BLOCK;this._flags.inline_frame&&!t?this._output.space_before_token=!0:this._options.brace_style==="expand"?t||this.print_newline():t||(Mt(this._flags.mode)&&this._options.keep_array_indentation?(this._options.keep_array_indentation=!1,this.print_newline(),this._options.keep_array_indentation=!0):this.print_newline()),this.restore_mode(),this.print_token(n)};C.prototype.handle_word=function(n){if(n.type===g.RESERVED){if(M(n.text,["set","get"])&&this._flags.mode!==S.ObjectLiteral)n.type=g.WORD;else if(n.text==="import"&&M(this._tokens.peek().text,["(","."]))n.type=g.WORD;else if(M(n.text,["as","from"])&&!this._flags.import_block)n.type=g.WORD;else if(this._flags.mode===S.ObjectLiteral){var t=this._tokens.peek();t.text===":"&&(n.type=g.WORD)}}if(this.start_of_statement(n)?D(this._flags.last_token,["var","let","const"])&&n.type===g.WORD&&(this._flags.declaration_statement=!0):n.newlines&&!me(this._flags.mode)&&(this._flags.last_token.type!==g.OPERATOR||this._flags.last_token.text==="--"||this._flags.last_token.text==="++")&&this._flags.last_token.type!==g.EQUALS&&(this._options.preserve_newlines||!D(this._flags.last_token,["var","let","const","set","get"]))?(this.handle_whitespace_and_comments(n),this.print_newline()):this.handle_whitespace_and_comments(n),this._flags.do_block&&!this._flags.do_while)if(ct(n,"while")){this._output.space_before_token=!0,this.print_token(n),this._output.space_before_token=!0,this._flags.do_while=!0;return}else this.print_newline(),this._flags.do_block=!1;if(this._flags.if_block)if(!this._flags.else_block&&ct(n,"else"))this._flags.else_block=!0;else{for(;this._flags.mode===S.Statement;)this.restore_mode();this._flags.if_block=!1,this._flags.else_block=!1}if(this._flags.in_case_statement&&D(n,["case","default"])){this.print_newline(),!this._flags.case_block&&(this._flags.case_body||this._options.jslint_happy)&&this.deindent(),this._flags.case_body=!1,this.print_token(n),this._flags.in_case=!0;return}if((this._flags.last_token.type===g.COMMA||this._flags.last_token.type===g.START_EXPR||this._flags.last_token.type===g.EQUALS||this._flags.last_token.type===g.OPERATOR)&&!this.start_of_object_property()&&!(M(this._flags.last_token.text,["+","-"])&&this._last_last_text===":"&&this._flags.parent.mode===S.ObjectLiteral)&&this.allow_wrap_or_preserved_newline(n),ct(n,"function")){(M(this._flags.last_token.text,["}",";"])||this._output.just_added_newline()&&!(M(this._flags.last_token.text,["(","[","{",":","=",","])||this._flags.last_token.type===g.OPERATOR))&&!this._output.just_added_blankline()&&!n.comments_before&&(this.print_newline(),this.print_newline(!0)),this._flags.last_token.type===g.RESERVED||this._flags.last_token.type===g.WORD?D(this._flags.last_token,["get","set","new","export"])||D(this._flags.last_token,pi)?this._output.space_before_token=!0:ct(this._flags.last_token,"default")&&this._last_last_text==="export"?this._output.space_before_token=!0:this._flags.last_token.text==="declare"?this._output.space_before_token=!0:this.print_newline():this._flags.last_token.type===g.OPERATOR||this._flags.last_token.text==="="?this._output.space_before_token=!0:!this._flags.multiline_frame&&(me(this._flags.mode)||Mt(this._flags.mode))||this.print_newline(),this.print_token(n),this._flags.last_word=n.text;return}var e="NONE";if(this._flags.last_token.type===g.END_BLOCK?this._previous_flags.inline_frame?e="SPACE":D(n,["else","catch","finally","from"])?this._options.brace_style==="expand"||this._options.brace_style==="end-expand"||this._options.brace_style==="none"&&n.newlines?e="NEWLINE":(e="SPACE",this._output.space_before_token=!0):e="NEWLINE":this._flags.last_token.type===g.SEMICOLON&&this._flags.mode===S.BlockStatement?e="NEWLINE":this._flags.last_token.type===g.SEMICOLON&&me(this._flags.mode)?e="SPACE":this._flags.last_token.type===g.STRING?e="NEWLINE":this._flags.last_token.type===g.RESERVED||this._flags.last_token.type===g.WORD||this._flags.last_token.text==="*"&&(M(this._last_last_text,["function","yield"])||this._flags.mode===S.ObjectLiteral&&M(this._last_last_text,["{",","]))?e="SPACE":this._flags.last_token.type===g.START_BLOCK?this._flags.inline_frame?e="SPACE":e="NEWLINE":this._flags.last_token.type===g.END_EXPR&&(this._output.space_before_token=!0,e="NEWLINE"),D(n,ge)&&this._flags.last_token.text!==")"&&(this._flags.inline_frame||this._flags.last_token.text==="else"||this._flags.last_token.text==="export"?e="SPACE":e="NEWLINE"),D(n,["else","catch","finally"]))if((!(this._flags.last_token.type===g.END_BLOCK&&this._previous_flags.mode===S.BlockStatement)||this._options.brace_style==="expand"||this._options.brace_style==="end-expand"||this._options.brace_style==="none"&&n.newlines)&&!this._flags.inline_frame)this.print_newline();else{this._output.trim(!0);var i=this._output.current_line;i.last()!=="}"&&this.print_newline(),this._output.space_before_token=!0}else e==="NEWLINE"?D(this._flags.last_token,tn)?this._output.space_before_token=!0:this._flags.last_token.text==="declare"&&D(n,["var","let","const"])?this._output.space_before_token=!0:this._flags.last_token.type!==g.END_EXPR?(this._flags.last_token.type!==g.START_EXPR||!D(n,["var","let","const"]))&&this._flags.last_token.text!==":"&&(ct(n,"if")&&ct(n.previous,"else")?this._output.space_before_token=!0:this.print_newline()):D(n,ge)&&this._flags.last_token.text!==")"&&this.print_newline():this._flags.multiline_frame&&Mt(this._flags.mode)&&this._flags.last_token.text===","&&this._last_last_text==="}"?this.print_newline():e==="SPACE"&&(this._output.space_before_token=!0);n.previous&&(n.previous.type===g.WORD||n.previous.type===g.RESERVED)&&(this._output.space_before_token=!0),this.print_token(n),this._flags.last_word=n.text,n.type===g.RESERVED&&(n.text==="do"?this._flags.do_block=!0:n.text==="if"?this._flags.if_block=!0:n.text==="import"?this._flags.import_block=!0:this._flags.import_block&&ct(n,"from")&&(this._flags.import_block=!1))};C.prototype.handle_semicolon=function(n){this.start_of_statement(n)?this._output.space_before_token=!1:this.handle_whitespace_and_comments(n);for(var t=this._tokens.peek();this._flags.mode===S.Statement&&!(this._flags.if_block&&ct(t,"else"))&&!this._flags.do_block;)this.restore_mode();this._flags.import_block&&(this._flags.import_block=!1),this.print_token(n)};C.prototype.handle_string=function(n){n.text.startsWith("`")&&n.newlines===0&&n.whitespace_before===""&&(n.previous.text===")"||this._flags.last_token.type===g.WORD)||(this.start_of_statement(n)?this._output.space_before_token=!0:(this.handle_whitespace_and_comments(n),this._flags.last_token.type===g.RESERVED||this._flags.last_token.type===g.WORD||this._flags.inline_frame?this._output.space_before_token=!0:this._flags.last_token.type===g.COMMA||this._flags.last_token.type===g.START_EXPR||this._flags.last_token.type===g.EQUALS||this._flags.last_token.type===g.OPERATOR?this.start_of_object_property()||this.allow_wrap_or_preserved_newline(n):n.text.startsWith("`")&&this._flags.last_token.type===g.END_EXPR&&(n.previous.text==="]"||n.previous.text===")")&&n.newlines===0?this._output.space_before_token=!0:this.print_newline())),this.print_token(n)};C.prototype.handle_equals=function(n){this.start_of_statement(n)||this.handle_whitespace_and_comments(n),this._flags.declaration_statement&&(this._flags.declaration_assignment=!0),this._output.space_before_token=!0,this.print_token(n),this._output.space_before_token=!0};C.prototype.handle_comma=function(n){this.handle_whitespace_and_comments(n,!0),this.print_token(n),this._output.space_before_token=!0,this._flags.declaration_statement?(me(this._flags.parent.mode)&&(this._flags.declaration_assignment=!1),this._flags.declaration_assignment?(this._flags.declaration_assignment=!1,this.print_newline(!1,!0)):this._options.comma_first&&this.allow_wrap_or_preserved_newline(n)):this._flags.mode===S.ObjectLiteral||this._flags.mode===S.Statement&&this._flags.parent.mode===S.ObjectLiteral?(this._flags.mode===S.Statement&&this.restore_mode(),this._flags.inline_frame||this.print_newline()):this._options.comma_first&&this.allow_wrap_or_preserved_newline(n)};C.prototype.handle_operator=function(n){var t=n.text==="*"&&(D(this._flags.last_token,["function","yield"])||M(this._flags.last_token.type,[g.START_BLOCK,g.COMMA,g.END_BLOCK,g.SEMICOLON])),e=M(n.text,["-","+"])&&(M(this._flags.last_token.type,[g.START_BLOCK,g.START_EXPR,g.EQUALS,g.OPERATOR])||M(this._flags.last_token.text,ge)||this._flags.last_token.text===",");if(!this.start_of_statement(n)){var i=!t;this.handle_whitespace_and_comments(n,i)}if(n.text==="*"&&this._flags.last_token.type===g.DOT){this.print_token(n);return}if(n.text==="::"){this.print_token(n);return}if(M(n.text,["-","+"])&&this.start_of_object_property()){this.print_token(n);return}if(this._flags.last_token.type===g.OPERATOR&&M(this._options.operator_position,Cr)&&this.allow_wrap_or_preserved_newline(n),n.text===":"&&this._flags.in_case){this.print_token(n),this._flags.in_case=!1,this._flags.case_body=!0,this._tokens.peek().type!==g.START_BLOCK?(this.indent(),this.print_newline(),this._flags.case_block=!1):(this._flags.case_block=!0,this._output.space_before_token=!0);return}var s=!0,r=!0,o=!1;if(n.text===":"?this._flags.ternary_depth===0?s=!1:(this._flags.ternary_depth-=1,o=!0):n.text==="?"&&(this._flags.ternary_depth+=1),!e&&!t&&this._options.preserve_newlines&&M(n.text,de)){var a=n.text===":",l=a&&o,u=a&&!o;switch(this._options.operator_position){case _e.before_newline:this._output.space_before_token=!u,this.print_token(n),(!a||l)&&this.allow_wrap_or_preserved_newline(n),this._output.space_before_token=!0;return;case _e.after_newline:this._output.space_before_token=!0,!a||l?this._tokens.peek().newlines?this.print_newline(!1,!0):this.allow_wrap_or_preserved_newline(n):this._output.space_before_token=!1,this.print_token(n),this._output.space_before_token=!0;return;case _e.preserve_newline:u||this.allow_wrap_or_preserved_newline(n),s=!(this._output.just_added_newline()||u),this._output.space_before_token=s,this.print_token(n),this._output.space_before_token=!0;return}}if(t){this.allow_wrap_or_preserved_newline(n),s=!1;var c=this._tokens.peek();r=c&&M(c.type,[g.WORD,g.RESERVED])}else if(n.text==="...")this.allow_wrap_or_preserved_newline(n),s=this._flags.last_token.type===g.START_BLOCK,r=!1;else if(M(n.text,["--","++","!","~"])||e){if((this._flags.last_token.type===g.COMMA||this._flags.last_token.type===g.START_EXPR)&&this.allow_wrap_or_preserved_newline(n),s=!1,r=!1,n.newlines&&(n.text==="--"||n.text==="++"||n.text==="~")){var h=D(this._flags.last_token,tn)&&n.newlines;h&&(this._previous_flags.if_block||this._previous_flags.else_block)&&this.restore_mode(),this.print_newline(h,!0)}this._flags.last_token.text===";"&&me(this._flags.mode)&&(s=!0),this._flags.last_token.type===g.RESERVED?s=!0:this._flags.last_token.type===g.END_EXPR?s=!(this._flags.last_token.text==="]"&&(n.text==="--"||n.text==="++")):this._flags.last_token.type===g.OPERATOR&&(s=M(n.text,["--","-","++","+"])&&M(this._flags.last_token.text,["--","-","++","+"]),M(n.text,["+","-"])&&M(this._flags.last_token.text,["--","++"])&&(r=!0)),(this._flags.mode===S.BlockStatement&&!this._flags.inline_frame||this._flags.mode===S.Statement)&&(this._flags.last_token.text==="{"||this._flags.last_token.text===";")&&this.print_newline()}this._output.space_before_token=this._output.space_before_token||s,this.print_token(n),this._output.space_before_token=r};C.prototype.handle_block_comment=function(n,t){if(this._output.raw){this._output.add_raw_token(n),n.directives&&n.directives.preserve==="end"&&(this._output.raw=this._options.test_output_raw);return}if(n.directives){this.print_newline(!1,t),this.print_token(n),n.directives.preserve==="start"&&(this._output.raw=!0),this.print_newline(!1,!0);return}if(!Ze.newline.test(n.text)&&!n.newlines){this._output.space_before_token=!0,this.print_token(n),this._output.space_before_token=!0;return}else this.print_block_commment(n,t)};C.prototype.print_block_commment=function(n,t){var e=Yu(n.text),i,s=!1,r=!1,o=n.whitespace_before,a=o.length;if(this.print_newline(!1,t),this.print_token_line_indentation(n),this._output.add_token(e[0]),this.print_newline(!1,t),e.length>1){for(e=e.slice(1),s=Zu(e,"*"),r=tc(e,o),s&&(this._flags.alignment=1),i=0;i<e.length;i++)s?(this.print_token_line_indentation(n),this._output.add_token(Xu(e[i]))):r&&e[i]?(this.print_token_line_indentation(n),this._output.add_token(e[i].substring(a))):(this._output.current_line.set_indent(-1),this._output.add_token(e[i])),this.print_newline(!1,t);this._flags.alignment=0}};C.prototype.handle_comment=function(n,t){n.newlines?this.print_newline(!1,t):this._output.trim(!0),this._output.space_before_token=!0,this.print_token(n),this.print_newline(!1,t)};C.prototype.handle_dot=function(n){this.start_of_statement(n)||this.handle_whitespace_and_comments(n,!0),this._flags.last_token.text.match("^[0-9]+$")&&(this._output.space_before_token=!0),D(this._flags.last_token,tn)?this._output.space_before_token=!1:this.allow_wrap_or_preserved_newline(n,this._flags.last_token.text===")"&&this._options.break_chained_methods),this._options.unindent_chained_methods&&this._output.just_added_newline()&&this.deindent(),this.print_token(n)};C.prototype.handle_unknown=function(n,t){this.print_token(n),n.text[n.text.length-1]===`
`&&this.print_newline(!1,t)};C.prototype.handle_eof=function(n){for(;this._flags.mode===S.Statement;)this.restore_mode();this.handle_whitespace_and_comments(n)};Nr.exports.Beautifier=C});var Pr=F((Gf,di)=>{"use strict";var ec=Ir().Beautifier,nc=si().Options;function ic(n,t){var e=new ec(n,t);return e.beautify()}di.exports=ic;di.exports.defaultOptions=function(){return new nc}});var _i=F((Qf,Dr)=>{"use strict";var zr=Xe().Options;function Lr(n){zr.call(this,n,"css"),this.selector_separator_newline=this._get_boolean("selector_separator_newline",!0),this.newline_between_rules=this._get_boolean("newline_between_rules",!0);var t=this._get_boolean("space_around_selector_separator");this.space_around_combinator=this._get_boolean("space_around_combinator")||t;var e=this._get_selection_list("brace_style",["collapse","expand","end-expand","none","preserve-inline"]);this.brace_style="collapse";for(var i=0;i<e.length;i++)e[i]!=="expand"?this.brace_style="collapse":this.brace_style=e[i]}Lr.prototype=new zr;Dr.exports.Options=Lr});var $r=F((Yf,Wr)=>{"use strict";var sc=_i().Options,rc=qe().Output,oc=Ge().InputScanner,ac=Qe().Directives,Br=new ac(/\/\*/,/\*\//),Fr=/\r\n|[\r\n]/,lc=/\r\n|[\r\n]/g,en=/\s/,uc=/(?:\s|\n)+/g,cc=/\/\*(?:[\s\S]*?)((?:\*\/)|$)/g,hc=/\/\/(?:[^\n\r\u2028\u2029]*)/g;function xt(n,t){this._source_text=n||"",this._options=new sc(t),this._ch=null,this._input=null,this.NESTED_AT_RULE={page:!0,"font-face":!0,keyframes:!0,media:!0,supports:!0,document:!0},this.CONDITIONAL_GROUP_RULE={media:!0,supports:!0,document:!0},this.NON_SEMICOLON_NEWLINE_PROPERTY=["grid-template-areas","grid-template"]}xt.prototype.eatString=function(n){var t="";for(this._ch=this._input.next();this._ch;){if(t+=this._ch,this._ch==="\\")t+=this._input.next();else if(n.indexOf(this._ch)!==-1||this._ch===`
`)break;this._ch=this._input.next()}return t};xt.prototype.eatWhitespace=function(n){for(var t=en.test(this._input.peek()),e=0;en.test(this._input.peek());)this._ch=this._input.next(),n&&this._ch===`
`&&(e===0||e<this._options.max_preserve_newlines)&&(e++,this._output.add_new_line(!0));return t};xt.prototype.foundNestedPseudoClass=function(){for(var n=0,t=1,e=this._input.peek(t);e;){if(e==="{")return!0;if(e==="(")n+=1;else if(e===")"){if(n===0)return!1;n-=1}else if(e===";"||e==="}")return!1;t++,e=this._input.peek(t)}return!1};xt.prototype.print_string=function(n){this._output.set_indent(this._indentLevel),this._output.non_breaking_space=!0,this._output.add_token(n)};xt.prototype.preserveSingleSpace=function(n){n&&(this._output.space_before_token=!0)};xt.prototype.indent=function(){this._indentLevel++};xt.prototype.outdent=function(){this._indentLevel>0&&this._indentLevel--};xt.prototype.beautify=function(){if(this._options.disabled)return this._source_text;var n=this._source_text,t=this._options.eol;t==="auto"&&(t=`
`,n&&Fr.test(n||"")&&(t=n.match(Fr)[0])),n=n.replace(lc,`
`);var e=n.match(/^[\t ]*/)[0];this._output=new rc(this._options,e),this._input=new oc(n),this._indentLevel=0,this._nestedLevel=0,this._ch=null;for(var i=0,s=!1,r=!1,o=!1,a=!1,l=!1,u=this._ch,c=!1,h,f,p;h=this._input.read(uc),f=h!=="",p=u,this._ch=this._input.next(),this._ch==="\\"&&this._input.hasNext()&&(this._ch+=this._input.next()),u=this._ch,this._ch;)if(this._ch==="/"&&this._input.peek()==="*"){this._output.add_new_line(),this._input.back();var d=this._input.read(cc),_=Br.get_directives(d);_&&_.ignore==="start"&&(d+=Br.readIgnored(this._input)),this.print_string(d),this.eatWhitespace(!0),this._output.add_new_line()}else if(this._ch==="/"&&this._input.peek()==="/")this._output.space_before_token=!0,this._input.back(),this.print_string(this._input.read(hc)),this.eatWhitespace(!0);else if(this._ch==="$"){this.preserveSingleSpace(f),this.print_string(this._ch);var m=this._input.peekUntilAfter(/[: ,;{}()[\]\/='"]/g);m.match(/[ :]$/)&&(m=this.eatString(": ").replace(/\s+$/,""),this.print_string(m),this._output.space_before_token=!0),i===0&&m.indexOf(":")!==-1&&(r=!0,this.indent())}else if(this._ch==="@")if(this.preserveSingleSpace(f),this._input.peek()==="{")this.print_string(this._ch+this.eatString("}"));else{this.print_string(this._ch);var y=this._input.peekUntilAfter(/[: ,;{}()[\]\/='"]/g);y.match(/[ :]$/)&&(y=this.eatString(": ").replace(/\s+$/,""),this.print_string(y),this._output.space_before_token=!0),i===0&&y.indexOf(":")!==-1?(r=!0,this.indent()):y in this.NESTED_AT_RULE?(this._nestedLevel+=1,y in this.CONDITIONAL_GROUP_RULE&&(o=!0)):i===0&&!r&&(a=!0)}else if(this._ch==="#"&&this._input.peek()==="{")this.preserveSingleSpace(f),this.print_string(this._ch+this.eatString("}"));else if(this._ch==="{")r&&(r=!1,this.outdent()),a=!1,o?(o=!1,s=this._indentLevel>=this._nestedLevel):s=this._indentLevel>=this._nestedLevel-1,this._options.newline_between_rules&&s&&this._output.previous_line&&this._output.previous_line.item(-1)!=="{"&&this._output.ensure_empty_line_above("/",","),this._output.space_before_token=!0,this._options.brace_style==="expand"?(this._output.add_new_line(),this.print_string(this._ch),this.indent(),this._output.set_indent(this._indentLevel)):(p==="("?this._output.space_before_token=!1:p!==","&&this.indent(),this.print_string(this._ch)),this.eatWhitespace(!0),this._output.add_new_line();else if(this._ch==="}")this.outdent(),this._output.add_new_line(),p==="{"&&this._output.trim(!0),r&&(this.outdent(),r=!1),this.print_string(this._ch),s=!1,this._nestedLevel&&this._nestedLevel--,this.eatWhitespace(!0),this._output.add_new_line(),this._options.newline_between_rules&&!this._output.just_added_blankline()&&this._input.peek()!=="}"&&this._output.add_new_line(!0),this._input.peek()===")"&&(this._output.trim(!0),this._options.brace_style==="expand"&&this._output.add_new_line(!0));else if(this._ch===":"){for(var x=0;x<this.NON_SEMICOLON_NEWLINE_PROPERTY.length;x++)if(this._input.lookBack(this.NON_SEMICOLON_NEWLINE_PROPERTY[x])){c=!0;break}(s||o)&&!(this._input.lookBack("&")||this.foundNestedPseudoClass())&&!this._input.lookBack("(")&&!a&&i===0?(this.print_string(":"),r||(r=!0,this._output.space_before_token=!0,this.eatWhitespace(!0),this.indent())):(this._input.lookBack(" ")&&(this._output.space_before_token=!0),this._input.peek()===":"?(this._ch=this._input.next(),this.print_string("::")):this.print_string(":"))}else if(this._ch==='"'||this._ch==="'"){var E=p==='"'||p==="'";this.preserveSingleSpace(E||f),this.print_string(this._ch+this.eatString(this._ch)),this.eatWhitespace(!0)}else if(this._ch===";")c=!1,i===0?(r&&(this.outdent(),r=!1),a=!1,this.print_string(this._ch),this.eatWhitespace(!0),this._input.peek()!=="/"&&this._output.add_new_line()):(this.print_string(this._ch),this.eatWhitespace(!0),this._output.space_before_token=!0);else if(this._ch==="(")if(this._input.lookBack("url"))this.print_string(this._ch),this.eatWhitespace(),i++,this.indent(),this._ch=this._input.next(),this._ch===")"||this._ch==='"'||this._ch==="'"?this._input.back():this._ch&&(this.print_string(this._ch+this.eatString(")")),i&&(i--,this.outdent()));else{var O=!1;this._input.lookBack("with")&&(O=!0),this.preserveSingleSpace(f||O),this.print_string(this._ch),r&&p==="$"&&this._options.selector_separator_newline?(this._output.add_new_line(),l=!0):(this.eatWhitespace(),i++,this.indent())}else if(this._ch===")")i&&(i--,this.outdent()),l&&this._input.peek()===";"&&this._options.selector_separator_newline&&(l=!1,this.outdent(),this._output.add_new_line()),this.print_string(this._ch);else if(this._ch===",")this.print_string(this._ch),this.eatWhitespace(!0),this._options.selector_separator_newline&&(!r||l)&&i===0&&!a?this._output.add_new_line():this._output.space_before_token=!0;else if((this._ch===">"||this._ch==="+"||this._ch==="~")&&!r&&i===0)this._options.space_around_combinator?(this._output.space_before_token=!0,this.print_string(this._ch),this._output.space_before_token=!0):(this.print_string(this._ch),this.eatWhitespace(),this._ch&&en.test(this._ch)&&(this._ch=""));else if(this._ch==="]")this.print_string(this._ch);else if(this._ch==="[")this.preserveSingleSpace(f),this.print_string(this._ch);else if(this._ch==="=")this.eatWhitespace(),this.print_string("="),en.test(this._ch)&&(this._ch="");else if(this._ch==="!"&&!this._input.lookBack("\\"))this._output.space_before_token=!0,this.print_string(this._ch);else{var T=p==='"'||p==="'";this.preserveSingleSpace(T||f),this.print_string(this._ch),!this._output.just_added_newline()&&this._input.peek()===`
`&&c&&this._output.add_new_line()}var L=this._output.get_code(t);return L};Wr.exports.Beautifier=xt});var jr=F((Zf,mi)=>{"use strict";var fc=$r().Beautifier,pc=_i().Options;function dc(n,t){var e=new fc(n,t);return e.beautify()}mi.exports=dc;mi.exports.defaultOptions=function(){return new pc}});var gi=F((tp,Vr)=>{"use strict";var Kr=Xe().Options;function Ur(n){Kr.call(this,n,"html"),this.templating.length===1&&this.templating[0]==="auto"&&(this.templating=["django","erb","handlebars","php"]),this.indent_inner_html=this._get_boolean("indent_inner_html"),this.indent_body_inner_html=this._get_boolean("indent_body_inner_html",!0),this.indent_head_inner_html=this._get_boolean("indent_head_inner_html",!0),this.indent_handlebars=this._get_boolean("indent_handlebars",!0),this.wrap_attributes=this._get_selection("wrap_attributes",["auto","force","force-aligned","force-expand-multiline","aligned-multiple","preserve","preserve-aligned"]),this.wrap_attributes_min_attrs=this._get_number("wrap_attributes_min_attrs",2),this.wrap_attributes_indent_size=this._get_number("wrap_attributes_indent_size",this.indent_size),this.extra_liners=this._get_array("extra_liners",["head","body","/html"]),this.inline=this._get_array("inline",["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","s","samp","select","small","span","strong","sub","sup","svg","template","textarea","time","u","var","video","wbr","text","acronym","big","strike","tt"]),this.inline_custom_elements=this._get_boolean("inline_custom_elements",!0),this.void_elements=this._get_array("void_elements",["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr","!doctype","?xml","basefont","isindex"]),this.unformatted=this._get_array("unformatted",[]),this.content_unformatted=this._get_array("content_unformatted",["pre","textarea"]),this.unformatted_content_delimiter=this._get_characters("unformatted_content_delimiter"),this.indent_scripts=this._get_selection("indent_scripts",["normal","keep","separate"])}Ur.prototype=new Kr;Vr.exports.Options=Ur});var bi=F((ep,wi)=>{"use strict";var qr=he().Tokenizer,yi=he().TOKEN,_c=Qe().Directives,mc=ci().TemplatablePattern,gc=ue().Pattern,R={TAG_OPEN:"TK_TAG_OPEN",TAG_CLOSE:"TK_TAG_CLOSE",CONTROL_FLOW_OPEN:"TK_CONTROL_FLOW_OPEN",CONTROL_FLOW_CLOSE:"TK_CONTROL_FLOW_CLOSE",ATTRIBUTE:"TK_ATTRIBUTE",EQUALS:"TK_EQUALS",VALUE:"TK_VALUE",COMMENT:"TK_COMMENT",TEXT:"TK_TEXT",UNKNOWN:"TK_UNKNOWN",START:yi.START,RAW:yi.RAW,EOF:yi.EOF},Jr=new _c(/<\!--/,/-->/),X=function(n,t){qr.call(this,n,t),this._current_tag_name="";var e=new mc(this._input).read_options(this._options),i=new gc(this._input);if(this.__patterns={word:e.until(/[\n\r\t <]/),word_control_flow_close_excluded:e.until(/[\n\r\t <}]/),single_quote:e.until_after(/'/),double_quote:e.until_after(/"/),attribute:e.until(/[\n\r\t =>]|\/>/),element_name:e.until(/[\n\r\t >\/]/),angular_control_flow_start:i.matching(/\@[a-zA-Z]+[^({]*[({]/),handlebars_comment:i.starting_with(/{{!--/).until_after(/--}}/),handlebars:i.starting_with(/{{/).until_after(/}}/),handlebars_open:i.until(/[\n\r\t }]/),handlebars_raw_close:i.until(/}}/),comment:i.starting_with(/<!--/).until_after(/-->/),cdata:i.starting_with(/<!\[CDATA\[/).until_after(/]]>/),conditional_comment:i.starting_with(/<!\[/).until_after(/]>/),processing:i.starting_with(/<\?/).until_after(/\?>/)},this._options.indent_handlebars&&(this.__patterns.word=this.__patterns.word.exclude("handlebars"),this.__patterns.word_control_flow_close_excluded=this.__patterns.word_control_flow_close_excluded.exclude("handlebars")),this._unformatted_content_delimiter=null,this._options.unformatted_content_delimiter){var s=this._input.get_literal_regexp(this._options.unformatted_content_delimiter);this.__patterns.unformatted_content_delimiter=i.matching(s).until_after(s)}};X.prototype=new qr;X.prototype._is_comment=function(n){return!1};X.prototype._is_opening=function(n){return n.type===R.TAG_OPEN||n.type===R.CONTROL_FLOW_OPEN};X.prototype._is_closing=function(n,t){return n.type===R.TAG_CLOSE&&t&&((n.text===">"||n.text==="/>")&&t.text[0]==="<"||n.text==="}}"&&t.text[0]==="{"&&t.text[1]==="{")||n.type===R.CONTROL_FLOW_CLOSE&&n.text==="}"&&t.text.endsWith("{")};X.prototype._reset=function(){this._current_tag_name=""};X.prototype._get_next_token=function(n,t){var e=null;this._readWhitespace();var i=this._input.peek();return i===null?this._create_token(R.EOF,""):(e=e||this._read_open_handlebars(i,t),e=e||this._read_attribute(i,n,t),e=e||this._read_close(i,t),e=e||this._read_script_and_style(i,n),e=e||this._read_control_flows(i,t),e=e||this._read_raw_content(i,n,t),e=e||this._read_content_word(i,t),e=e||this._read_comment_or_cdata(i),e=e||this._read_processing(i),e=e||this._read_open(i,t),e=e||this._create_token(R.UNKNOWN,this._input.next()),e)};X.prototype._read_comment_or_cdata=function(n){var t=null,e=null,i=null;if(n==="<"){var s=this._input.peek(1);s==="!"&&(e=this.__patterns.comment.read(),e?(i=Jr.get_directives(e),i&&i.ignore==="start"&&(e+=Jr.readIgnored(this._input))):e=this.__patterns.cdata.read()),e&&(t=this._create_token(R.COMMENT,e),t.directives=i)}return t};X.prototype._read_processing=function(n){var t=null,e=null,i=null;if(n==="<"){var s=this._input.peek(1);(s==="!"||s==="?")&&(e=this.__patterns.conditional_comment.read(),e=e||this.__patterns.processing.read()),e&&(t=this._create_token(R.COMMENT,e),t.directives=i)}return t};X.prototype._read_open=function(n,t){var e=null,i=null;return(!t||t.type===R.CONTROL_FLOW_OPEN)&&n==="<"&&(e=this._input.next(),this._input.peek()==="/"&&(e+=this._input.next()),e+=this.__patterns.element_name.read(),i=this._create_token(R.TAG_OPEN,e)),i};X.prototype._read_open_handlebars=function(n,t){var e=null,i=null;return(!t||t.type===R.CONTROL_FLOW_OPEN)&&(this._options.templating.includes("angular")||this._options.indent_handlebars)&&n==="{"&&this._input.peek(1)==="{"&&(this._options.indent_handlebars&&this._input.peek(2)==="!"?(e=this.__patterns.handlebars_comment.read(),e=e||this.__patterns.handlebars.read(),i=this._create_token(R.COMMENT,e)):(e=this.__patterns.handlebars_open.read(),i=this._create_token(R.TAG_OPEN,e))),i};X.prototype._read_control_flows=function(n,t){var e="",i=null;if(!this._options.templating.includes("angular"))return i;if(n==="@"){if(e=this.__patterns.angular_control_flow_start.read(),e==="")return i;for(var s=e.endsWith("(")?1:0,r=0;!(e.endsWith("{")&&s===r);){var o=this._input.next();if(o===null)break;o==="("?s++:o===")"&&r++,e+=o}i=this._create_token(R.CONTROL_FLOW_OPEN,e)}else n==="}"&&t&&t.type===R.CONTROL_FLOW_OPEN&&(e=this._input.next(),i=this._create_token(R.CONTROL_FLOW_CLOSE,e));return i};X.prototype._read_close=function(n,t){var e=null,i=null;return t&&t.type===R.TAG_OPEN&&(t.text[0]==="<"&&(n===">"||n==="/"&&this._input.peek(1)===">")?(e=this._input.next(),n==="/"&&(e+=this._input.next()),i=this._create_token(R.TAG_CLOSE,e)):t.text[0]==="{"&&n==="}"&&this._input.peek(1)==="}"&&(this._input.next(),this._input.next(),i=this._create_token(R.TAG_CLOSE,"}}"))),i};X.prototype._read_attribute=function(n,t,e){var i=null,s="";if(e&&e.text[0]==="<")if(n==="=")i=this._create_token(R.EQUALS,this._input.next());else if(n==='"'||n==="'"){var r=this._input.next();n==='"'?r+=this.__patterns.double_quote.read():r+=this.__patterns.single_quote.read(),i=this._create_token(R.VALUE,r)}else s=this.__patterns.attribute.read(),s&&(t.type===R.EQUALS?i=this._create_token(R.VALUE,s):i=this._create_token(R.ATTRIBUTE,s));return i};X.prototype._is_content_unformatted=function(n){return this._options.void_elements.indexOf(n)===-1&&(this._options.content_unformatted.indexOf(n)!==-1||this._options.unformatted.indexOf(n)!==-1)};X.prototype._read_raw_content=function(n,t,e){var i="";if(e&&e.text[0]==="{")i=this.__patterns.handlebars_raw_close.read();else if(t.type===R.TAG_CLOSE&&t.opened.text[0]==="<"&&t.text[0]!=="/"){var s=t.opened.text.substr(1).toLowerCase();this._is_content_unformatted(s)&&(i=this._input.readUntil(new RegExp("</"+s+"[\\n\\r\\t ]*?>","ig")))}return i?this._create_token(R.TEXT,i):null};X.prototype._read_script_and_style=function(n,t){if(t.type===R.TAG_CLOSE&&t.opened.text[0]==="<"&&t.text[0]!=="/"){var e=t.opened.text.substr(1).toLowerCase();if(e==="script"||e==="style"){var i=this._read_comment_or_cdata(n);if(i)return i.type=R.TEXT,i;var s=this._input.readUntil(new RegExp("</"+e+"[\\n\\r\\t ]*?>","ig"));if(s)return this._create_token(R.TEXT,s)}}return null};X.prototype._read_content_word=function(n,t){var e="";return this._options.unformatted_content_delimiter&&n===this._options.unformatted_content_delimiter[0]&&(e=this.__patterns.unformatted_content_delimiter.read()),e||(e=t&&t.type===R.CONTROL_FLOW_OPEN?this.__patterns.word_control_flow_close_excluded.read():this.__patterns.word.read()),e?this._create_token(R.TEXT,e):null};wi.exports.Tokenizer=X;wi.exports.TOKEN=R});var Qr=F((np,Gr)=>{"use strict";var yc=gi().Options,wc=qe().Output,bc=bi().Tokenizer,N=bi().TOKEN,Hr=/\r\n|[\r\n]/,vc=/\r\n|[\r\n]/g,at=function(n,t){this.indent_level=0,this.alignment_size=0,this.max_preserve_newlines=n.max_preserve_newlines,this.preserve_newlines=n.preserve_newlines,this._output=new wc(n,t)};at.prototype.current_line_has_match=function(n){return this._output.current_line.has_match(n)};at.prototype.set_space_before_token=function(n,t){this._output.space_before_token=n,this._output.non_breaking_space=t};at.prototype.set_wrap_point=function(){this._output.set_indent(this.indent_level,this.alignment_size),this._output.set_wrap_point()};at.prototype.add_raw_token=function(n){this._output.add_raw_token(n)};at.prototype.print_preserved_newlines=function(n){var t=0;n.type!==N.TEXT&&n.previous.type!==N.TEXT&&(t=n.newlines?1:0),this.preserve_newlines&&(t=n.newlines<this.max_preserve_newlines+1?n.newlines:this.max_preserve_newlines+1);for(var e=0;e<t;e++)this.print_newline(e>0);return t!==0};at.prototype.traverse_whitespace=function(n){return n.whitespace_before||n.newlines?(this.print_preserved_newlines(n)||(this._output.space_before_token=!0),!0):!1};at.prototype.previous_token_wrapped=function(){return this._output.previous_token_wrapped};at.prototype.print_newline=function(n){this._output.add_new_line(n)};at.prototype.print_token=function(n){n.text&&(this._output.set_indent(this.indent_level,this.alignment_size),this._output.add_token(n.text))};at.prototype.indent=function(){this.indent_level++};at.prototype.deindent=function(){this.indent_level>0&&(this.indent_level--,this._output.set_indent(this.indent_level,this.alignment_size))};at.prototype.get_full_indent=function(n){return n=this.indent_level+(n||0),n<1?"":this._output.get_indent_string(n)};var xc=function(n){for(var t=null,e=n.next;e.type!==N.EOF&&n.closed!==e;){if(e.type===N.ATTRIBUTE&&e.text==="type"){e.next&&e.next.type===N.EQUALS&&e.next.next&&e.next.next.type===N.VALUE&&(t=e.next.next.text);break}e=e.next}return t},kc=function(n,t){var e=null,i=null;return t.closed?(n==="script"?e="text/javascript":n==="style"&&(e="text/css"),e=xc(t)||e,e.search("text/css")>-1?i="css":e.search(/module|((text|application|dojo)\/(x-)?(javascript|ecmascript|jscript|livescript|(ld\+)?json|method|aspect))/)>-1?i="javascript":e.search(/(text|application|dojo)\/(x-)?(html)/)>-1?i="html":e.search(/test\/null/)>-1&&(i="null"),i):null};function ye(n,t){return t.indexOf(n)!==-1}function Sc(n,t,e){this.parent=n||null,this.tag=t?t.tag_name:"",this.indent_level=e||0,this.parser_token=t||null}function Ft(n){this._printer=n,this._current_frame=null}Ft.prototype.get_parser_token=function(){return this._current_frame?this._current_frame.parser_token:null};Ft.prototype.record_tag=function(n){var t=new Sc(this._current_frame,n,this._printer.indent_level);this._current_frame=t};Ft.prototype._try_pop_frame=function(n){var t=null;return n&&(t=n.parser_token,this._printer.indent_level=n.indent_level,this._current_frame=n.parent),t};Ft.prototype._get_frame=function(n,t){for(var e=this._current_frame;e&&n.indexOf(e.tag)===-1;){if(t&&t.indexOf(e.tag)!==-1){e=null;break}e=e.parent}return e};Ft.prototype.try_pop=function(n,t){var e=this._get_frame([n],t);return this._try_pop_frame(e)};Ft.prototype.indent_to_tag=function(n){var t=this._get_frame(n);t&&(this._printer.indent_level=t.indent_level)};function nt(n,t,e,i){this._source_text=n||"",t=t||{},this._js_beautify=e,this._css_beautify=i,this._tag_stack=null;var s=new yc(t,"html");this._options=s,this._is_wrap_attributes_force=this._options.wrap_attributes.substr(0,5)==="force",this._is_wrap_attributes_force_expand_multiline=this._options.wrap_attributes==="force-expand-multiline",this._is_wrap_attributes_force_aligned=this._options.wrap_attributes==="force-aligned",this._is_wrap_attributes_aligned_multiple=this._options.wrap_attributes==="aligned-multiple",this._is_wrap_attributes_preserve=this._options.wrap_attributes.substr(0,8)==="preserve",this._is_wrap_attributes_preserve_aligned=this._options.wrap_attributes==="preserve-aligned"}nt.prototype.beautify=function(){if(this._options.disabled)return this._source_text;var n=this._source_text,t=this._options.eol;this._options.eol==="auto"&&(t=`
`,n&&Hr.test(n)&&(t=n.match(Hr)[0])),n=n.replace(vc,`
`);var e=n.match(/^[\t ]*/)[0],i={text:"",type:""},s=new Xr(this._options),r=new at(this._options,e),o=new bc(n,this._options).tokenize();this._tag_stack=new Ft(r);for(var a=null,l=o.next();l.type!==N.EOF;)l.type===N.TAG_OPEN||l.type===N.COMMENT?(a=this._handle_tag_open(r,l,s,i,o),s=a):l.type===N.ATTRIBUTE||l.type===N.EQUALS||l.type===N.VALUE||l.type===N.TEXT&&!s.tag_complete?a=this._handle_inside_tag(r,l,s,i):l.type===N.TAG_CLOSE?a=this._handle_tag_close(r,l,s):l.type===N.TEXT?a=this._handle_text(r,l,s):l.type===N.CONTROL_FLOW_OPEN?a=this._handle_control_flow_open(r,l):l.type===N.CONTROL_FLOW_CLOSE?a=this._handle_control_flow_close(r,l):r.add_raw_token(l),i=a,l=o.next();var u=r._output.get_code(t);return u};nt.prototype._handle_control_flow_open=function(n,t){var e={text:t.text,type:t.type};return n.set_space_before_token(t.newlines||t.whitespace_before!=="",!0),t.newlines?n.print_preserved_newlines(t):n.set_space_before_token(t.newlines||t.whitespace_before!=="",!0),n.print_token(t),n.indent(),e};nt.prototype._handle_control_flow_close=function(n,t){var e={text:t.text,type:t.type};return n.deindent(),t.newlines?n.print_preserved_newlines(t):n.set_space_before_token(t.newlines||t.whitespace_before!=="",!0),n.print_token(t),e};nt.prototype._handle_tag_close=function(n,t,e){var i={text:t.text,type:t.type};return n.alignment_size=0,e.tag_complete=!0,n.set_space_before_token(t.newlines||t.whitespace_before!=="",!0),e.is_unformatted?n.add_raw_token(t):(e.tag_start_char==="<"&&(n.set_space_before_token(t.text[0]==="/",!0),this._is_wrap_attributes_force_expand_multiline&&e.has_wrapped_attrs&&n.print_newline(!1)),n.print_token(t)),e.indent_content&&!(e.is_unformatted||e.is_content_unformatted)&&(n.indent(),e.indent_content=!1),!e.is_inline_element&&!(e.is_unformatted||e.is_content_unformatted)&&n.set_wrap_point(),i};nt.prototype._handle_inside_tag=function(n,t,e,i){var s=e.has_wrapped_attrs,r={text:t.text,type:t.type};return n.set_space_before_token(t.newlines||t.whitespace_before!=="",!0),e.is_unformatted?n.add_raw_token(t):e.tag_start_char==="{"&&t.type===N.TEXT?n.print_preserved_newlines(t)?(t.newlines=0,n.add_raw_token(t)):n.print_token(t):(t.type===N.ATTRIBUTE?n.set_space_before_token(!0):(t.type===N.EQUALS||t.type===N.VALUE&&t.previous.type===N.EQUALS)&&n.set_space_before_token(!1),t.type===N.ATTRIBUTE&&e.tag_start_char==="<"&&((this._is_wrap_attributes_preserve||this._is_wrap_attributes_preserve_aligned)&&(n.traverse_whitespace(t),s=s||t.newlines!==0),this._is_wrap_attributes_force&&e.attr_count>=this._options.wrap_attributes_min_attrs&&(i.type!==N.TAG_OPEN||this._is_wrap_attributes_force_expand_multiline)&&(n.print_newline(!1),s=!0)),n.print_token(t),s=s||n.previous_token_wrapped(),e.has_wrapped_attrs=s),r};nt.prototype._handle_text=function(n,t,e){var i={text:t.text,type:"TK_CONTENT"};return e.custom_beautifier_name?this._print_custom_beatifier_text(n,t,e):e.is_unformatted||e.is_content_unformatted?n.add_raw_token(t):(n.traverse_whitespace(t),n.print_token(t)),i};nt.prototype._print_custom_beatifier_text=function(n,t,e){var i=this;if(t.text!==""){var s=t.text,r,o=1,a="",l="";e.custom_beautifier_name==="javascript"&&typeof this._js_beautify=="function"?r=this._js_beautify:e.custom_beautifier_name==="css"&&typeof this._css_beautify=="function"?r=this._css_beautify:e.custom_beautifier_name==="html"&&(r=function(d,_){var m=new nt(d,_,i._js_beautify,i._css_beautify);return m.beautify()}),this._options.indent_scripts==="keep"?o=0:this._options.indent_scripts==="separate"&&(o=-n.indent_level);var u=n.get_full_indent(o);if(s=s.replace(/\n[ \t]*$/,""),e.custom_beautifier_name!=="html"&&s[0]==="<"&&s.match(/^(<!--|<!\[CDATA\[)/)){var c=/^(<!--[^\n]*|<!\[CDATA\[)(\n?)([ \t\n]*)([\s\S]*)(-->|]]>)$/.exec(s);if(!c){n.add_raw_token(t);return}a=u+c[1]+`
`,s=c[4],c[5]&&(l=u+c[5]),s=s.replace(/\n[ \t]*$/,""),(c[2]||c[3].indexOf(`
`)!==-1)&&(c=c[3].match(/[ \t]+$/),c&&(t.whitespace_before=c[0]))}if(s)if(r){var h=function(){this.eol=`
`};h.prototype=this._options.raw_options;var f=new h;s=r(u+s,f)}else{var p=t.whitespace_before;p&&(s=s.replace(new RegExp(`
(`+p+")?","g"),`
`)),s=u+s.replace(/\n/g,`
`+u)}a&&(s?s=a+s+`
`+l:s=a+l),n.print_newline(!1),s&&(t.text=s,t.whitespace_before="",t.newlines=0,n.add_raw_token(t),n.print_newline(!0))}};nt.prototype._handle_tag_open=function(n,t,e,i,s){var r=this._get_tag_open_token(t);if((e.is_unformatted||e.is_content_unformatted)&&!e.is_empty_element&&t.type===N.TAG_OPEN&&!r.is_start_tag?(n.add_raw_token(t),r.start_tag_token=this._tag_stack.try_pop(r.tag_name)):(n.traverse_whitespace(t),this._set_tag_position(n,t,r,e,i),r.is_inline_element||n.set_wrap_point(),n.print_token(t)),r.is_start_tag&&this._is_wrap_attributes_force){var o=0,a;do a=s.peek(o),a.type===N.ATTRIBUTE&&(r.attr_count+=1),o+=1;while(a.type!==N.EOF&&a.type!==N.TAG_CLOSE)}return(this._is_wrap_attributes_force_aligned||this._is_wrap_attributes_aligned_multiple||this._is_wrap_attributes_preserve_aligned)&&(r.alignment_size=t.text.length+1),!r.tag_complete&&!r.is_unformatted&&(n.alignment_size=r.alignment_size),r};var Xr=function(n,t,e){if(this.parent=t||null,this.text="",this.type="TK_TAG_OPEN",this.tag_name="",this.is_inline_element=!1,this.is_unformatted=!1,this.is_content_unformatted=!1,this.is_empty_element=!1,this.is_start_tag=!1,this.is_end_tag=!1,this.indent_content=!1,this.multiline_content=!1,this.custom_beautifier_name=null,this.start_tag_token=null,this.attr_count=0,this.has_wrapped_attrs=!1,this.alignment_size=0,this.tag_complete=!1,this.tag_start_char="",this.tag_check="",!e)this.tag_complete=!0;else{var i;this.tag_start_char=e.text[0],this.text=e.text,this.tag_start_char==="<"?(i=e.text.match(/^<([^\s>]*)/),this.tag_check=i?i[1]:""):(i=e.text.match(/^{{~?(?:[\^]|#\*?)?([^\s}]+)/),this.tag_check=i?i[1]:"",(e.text.startsWith("{{#>")||e.text.startsWith("{{~#>"))&&this.tag_check[0]===">"&&(this.tag_check===">"&&e.next!==null?this.tag_check=e.next.text.split(" ")[0]:this.tag_check=e.text.split(">")[1])),this.tag_check=this.tag_check.toLowerCase(),e.type===N.COMMENT&&(this.tag_complete=!0),this.is_start_tag=this.tag_check.charAt(0)!=="/",this.tag_name=this.is_start_tag?this.tag_check:this.tag_check.substr(1),this.is_end_tag=!this.is_start_tag||e.closed&&e.closed.text==="/>";var s=2;this.tag_start_char==="{"&&this.text.length>=3&&this.text.charAt(2)==="~"&&(s=3),this.is_end_tag=this.is_end_tag||this.tag_start_char==="{"&&(!n.indent_handlebars||this.text.length<3||/[^#\^]/.test(this.text.charAt(s)))}};nt.prototype._get_tag_open_token=function(n){var t=new Xr(this._options,this._tag_stack.get_parser_token(),n);return t.alignment_size=this._options.wrap_attributes_indent_size,t.is_end_tag=t.is_end_tag||ye(t.tag_check,this._options.void_elements),t.is_empty_element=t.tag_complete||t.is_start_tag&&t.is_end_tag,t.is_unformatted=!t.tag_complete&&ye(t.tag_check,this._options.unformatted),t.is_content_unformatted=!t.is_empty_element&&ye(t.tag_check,this._options.content_unformatted),t.is_inline_element=ye(t.tag_name,this._options.inline)||this._options.inline_custom_elements&&t.tag_name.includes("-")||t.tag_start_char==="{",t};nt.prototype._set_tag_position=function(n,t,e,i,s){if(e.is_empty_element||(e.is_end_tag?e.start_tag_token=this._tag_stack.try_pop(e.tag_name):(this._do_optional_end_element(e)&&(e.is_inline_element||n.print_newline(!1)),this._tag_stack.record_tag(e),(e.tag_name==="script"||e.tag_name==="style")&&!(e.is_unformatted||e.is_content_unformatted)&&(e.custom_beautifier_name=kc(e.tag_check,t)))),ye(e.tag_check,this._options.extra_liners)&&(n.print_newline(!1),n._output.just_added_blankline()||n.print_newline(!0)),e.is_empty_element){if(e.tag_start_char==="{"&&e.tag_check==="else"){this._tag_stack.indent_to_tag(["if","unless","each"]),e.indent_content=!0;var r=n.current_line_has_match(/{{#if/);r||n.print_newline(!1)}e.tag_name==="!--"&&s.type===N.TAG_CLOSE&&i.is_end_tag&&e.text.indexOf(`
`)===-1||(e.is_inline_element||e.is_unformatted||n.print_newline(!1),this._calcluate_parent_multiline(n,e))}else if(e.is_end_tag){var o=!1;o=e.start_tag_token&&e.start_tag_token.multiline_content,o=o||!e.is_inline_element&&!(i.is_inline_element||i.is_unformatted)&&!(s.type===N.TAG_CLOSE&&e.start_tag_token===i)&&s.type!=="TK_CONTENT",(e.is_content_unformatted||e.is_unformatted)&&(o=!1),o&&n.print_newline(!1)}else e.indent_content=!e.custom_beautifier_name,e.tag_start_char==="<"&&(e.tag_name==="html"?e.indent_content=this._options.indent_inner_html:e.tag_name==="head"?e.indent_content=this._options.indent_head_inner_html:e.tag_name==="body"&&(e.indent_content=this._options.indent_body_inner_html)),!(e.is_inline_element||e.is_unformatted)&&(s.type!=="TK_CONTENT"||e.is_content_unformatted)&&n.print_newline(!1),this._calcluate_parent_multiline(n,e)};nt.prototype._calcluate_parent_multiline=function(n,t){t.parent&&n._output.just_added_newline()&&!((t.is_inline_element||t.is_unformatted)&&t.parent.is_inline_element)&&(t.parent.multiline_content=!0)};var Ec=["address","article","aside","blockquote","details","div","dl","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hr","main","menu","nav","ol","p","pre","section","table","ul"],Tc=["a","audio","del","ins","map","noscript","video"];nt.prototype._do_optional_end_element=function(n){var t=null;if(!(n.is_empty_element||!n.is_start_tag||!n.parent)){if(n.tag_name==="body")t=t||this._tag_stack.try_pop("head");else if(n.tag_name==="li")t=t||this._tag_stack.try_pop("li",["ol","ul","menu"]);else if(n.tag_name==="dd"||n.tag_name==="dt")t=t||this._tag_stack.try_pop("dt",["dl"]),t=t||this._tag_stack.try_pop("dd",["dl"]);else if(n.parent.tag_name==="p"&&Ec.indexOf(n.tag_name)!==-1){var e=n.parent.parent;(!e||Tc.indexOf(e.tag_name)===-1)&&(t=t||this._tag_stack.try_pop("p"))}else n.tag_name==="rp"||n.tag_name==="rt"?(t=t||this._tag_stack.try_pop("rt",["ruby","rtc"]),t=t||this._tag_stack.try_pop("rp",["ruby","rtc"])):n.tag_name==="optgroup"?t=t||this._tag_stack.try_pop("optgroup",["select"]):n.tag_name==="option"?t=t||this._tag_stack.try_pop("option",["select","datalist","optgroup"]):n.tag_name==="colgroup"?t=t||this._tag_stack.try_pop("caption",["table"]):n.tag_name==="thead"?(t=t||this._tag_stack.try_pop("caption",["table"]),t=t||this._tag_stack.try_pop("colgroup",["table"])):n.tag_name==="tbody"||n.tag_name==="tfoot"?(t=t||this._tag_stack.try_pop("caption",["table"]),t=t||this._tag_stack.try_pop("colgroup",["table"]),t=t||this._tag_stack.try_pop("thead",["table"]),t=t||this._tag_stack.try_pop("tbody",["table"])):n.tag_name==="tr"?(t=t||this._tag_stack.try_pop("caption",["table"]),t=t||this._tag_stack.try_pop("colgroup",["table"]),t=t||this._tag_stack.try_pop("tr",["table","thead","tbody","tfoot"])):(n.tag_name==="th"||n.tag_name==="td")&&(t=t||this._tag_stack.try_pop("td",["table","thead","tbody","tfoot","tr"]),t=t||this._tag_stack.try_pop("th",["table","thead","tbody","tfoot","tr"]));return n.parent=this._tag_stack.get_parser_token(),t}};Gr.exports.Beautifier=nt});var Yr=F((ip,vi)=>{"use strict";var Mc=Qr().Beautifier,Oc=gi().Options;function Ac(n,t,e,i){var s=new Mc(n,t,e,i);return s.beautify()}vi.exports=Ac;vi.exports.defaultOptions=function(){return new Oc}});var io=F((sp,nn)=>{"use strict";var Zr=Pr(),to=jr(),eo=Yr();function no(n,t,e,i){return e=e||Zr,i=i||to,eo(n,t,e,i)}no.defaultOptions=eo.defaultOptions;nn.exports.js=Zr;nn.exports.css=to;nn.exports.html=no});var oo=F((rp,ro)=>{"use strict";function so(n,t,e){var i=function(s,r){return n.js_beautify(s,r)};return i.js=n.js_beautify,i.css=t.css_beautify,i.html=e.html_beautify,i.js_beautify=n.js_beautify,i.css_beautify=t.css_beautify,i.html_beautify=e.html_beautify,i}typeof define=="function"&&define.amd?define(["./lib/beautify","./lib/beautify-css","./lib/beautify-html"],function(n,t,e){return so(n,t,e)}):(function(n){var t=io();t.js_beautify=t.js,t.css_beautify=t.css,t.html_beautify=t.html,n.exports=so(t,t,t)})(ro)});function Z(n){this.content=n}Z.prototype={constructor:Z,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return t==-1?void 0:this.content[t+1]},update:function(n,t,e){var i=e&&e!=n?this.remove(e):this,s=i.find(n),r=i.content.slice();return s==-1?r.push(e||n,t):(r[s+1]=t,e&&(r[s]=e)),new Z(r)},remove:function(n){var t=this.find(n);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new Z(e)},addToStart:function(n,t){return new Z([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var e=this.remove(n).content.slice();return e.push(n,t),new Z(e)},addBefore:function(n,t,e){var i=this.remove(t),s=i.content.slice(),r=i.find(n);return s.splice(r==-1?s.length:r,0,t,e),new Z(s)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return n=Z.from(n),n.size?new Z(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=Z.from(n),n.size?new Z(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=Z.from(n);for(var e=0;e<n.content.length;e+=2)t=t.remove(n.content[e]);return t},toObject:function(){var n={};return this.forEach(function(t,e){n[t]=e}),n},get size(){return this.content.length>>1}};Z.from=function(n){if(n instanceof Z)return n;var t=[];if(n)for(var e in n)t.push(e,n[e]);return new Z(t)};var on=Z;function Pi(n,t,e){for(let i=0;;i++){if(i==n.childCount||i==t.childCount)return n.childCount==t.childCount?null:e;let s=n.child(i),r=t.child(i);if(s==r){e+=s.nodeSize;continue}if(!s.sameMarkup(r))return e;if(s.isText&&s.text!=r.text){for(let o=0;s.text[o]==r.text[o];o++)e++;return e}if(s.content.size||r.content.size){let o=Pi(s.content,r.content,e+1);if(o!=null)return o}e+=s.nodeSize}}function zi(n,t,e,i){for(let s=n.childCount,r=t.childCount;;){if(s==0||r==0)return s==r?null:{a:e,b:i};let o=n.child(--s),a=t.child(--r),l=o.nodeSize;if(o==a){e-=l,i-=l;continue}if(!o.sameMarkup(a))return{a:e,b:i};if(o.isText&&o.text!=a.text){let u=0,c=Math.min(o.text.length,a.text.length);for(;u<c&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,e--,i--;return{a:e,b:i}}if(o.content.size||a.content.size){let u=zi(o.content,a.content,e-1,i-1);if(u)return u}e-=l,i-=l}}var w=class n{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let i=0;i<t.length;i++)this.size+=t[i].nodeSize}nodesBetween(t,e,i,s=0,r){for(let o=0,a=0;a<e;o++){let l=this.content[o],u=a+l.nodeSize;if(u>t&&i(l,s+a,r||null,o)!==!1&&l.content.size){let c=a+1;l.nodesBetween(Math.max(0,t-c),Math.min(l.content.size,e-c),i,s+c)}a=u}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,i,s){let r="",o=!0;return this.nodesBetween(t,e,(a,l)=>{let u=a.isText?a.text.slice(Math.max(t,l)-l,e-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&i&&(o?o=!1:r+=i),r+=u},0),r}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,i=t.firstChild,s=this.content.slice(),r=0;for(e.isText&&e.sameMarkup(i)&&(s[s.length-1]=e.withText(e.text+i.text),r=1);r<t.content.length;r++)s.push(t.content[r]);return new n(s,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let i=[],s=0;if(e>t)for(let r=0,o=0;o<e;r++){let a=this.content[r],l=o+a.nodeSize;l>t&&((o<t||l>e)&&(a.isText?a=a.cut(Math.max(0,t-o),Math.min(a.text.length,e-o)):a=a.cut(Math.max(0,t-o-1),Math.min(a.content.size,e-o-1))),i.push(a),s+=a.nodeSize),o=l}return new n(i,s)}cutByIndex(t,e){return t==e?n.empty:t==0&&e==this.content.length?this:new n(this.content.slice(t,e))}replaceChild(t,e){let i=this.content[t];if(i==e)return this;let s=this.content.slice(),r=this.size+e.nodeSize-i.nodeSize;return s[t]=e,new n(s,r)}addToStart(t){return new n([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new n(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,i=0;e<this.content.length;e++){let s=this.content[e];t(s,i,e),i+=s.nodeSize}}findDiffStart(t,e=0){return Pi(this,t,e)}findDiffEnd(t,e=this.size,i=t.size){return zi(this,t,e,i)}findIndex(t){if(t==0)return be(0,t);if(t==this.size)return be(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let e=0,i=0;;e++){let s=this.child(e),r=i+s.nodeSize;if(r>=t)return r==t?be(e+1,r):be(e,i);i=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return n.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new n(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return n.empty;let e,i=0;for(let s=0;s<t.length;s++){let r=t[s];i+=r.nodeSize,s&&r.isText&&t[s-1].sameMarkup(r)?(e||(e=t.slice(0,s)),e[e.length-1]=r.withText(e[e.length-1].text+r.text)):e&&e.push(r)}return new n(e||t,i)}static from(t){if(!t)return n.empty;if(t instanceof n)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new n([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};w.empty=new w([],0);var an={index:0,offset:0};function be(n,t){return an.index=n,an.offset=t,an}function xe(n,t){if(n===t)return!0;if(!(n&&typeof n=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(let i=0;i<n.length;i++)if(!xe(n[i],t[i]))return!1}else{for(let i in n)if(!(i in t)||!xe(n[i],t[i]))return!1;for(let i in t)if(!(i in n))return!1}return!0}var z=class n{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,i=!1;for(let s=0;s<t.length;s++){let r=t[s];if(this.eq(r))return t;if(this.type.excludes(r.type))e||(e=t.slice(0,s));else{if(r.type.excludes(this.type))return t;!i&&r.type.rank>this.type.rank&&(e||(e=t.slice(0,s)),e.push(this),i=!0),e&&e.push(r)}}return e||(e=t.slice()),i||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&xe(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let i=t.marks[e.type];if(!i)throw new RangeError(`There is no mark type ${e.type} in this schema`);let s=i.create(e.attrs);return i.checkAttrs(s.attrs),s}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].eq(e[i]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return n.none;if(t instanceof n)return[t];let e=t.slice();return e.sort((i,s)=>i.type.rank-s.type.rank),e}};z.none=[];var Rt=class extends Error{},b=class n{constructor(t,e,i){this.content=t,this.openStart=e,this.openEnd=i}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let i=Di(this.content,t+this.openStart,e);return i&&new n(i,this.openStart,this.openEnd)}removeBetween(t,e){return new n(Li(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return n.empty;let i=e.openStart||0,s=e.openEnd||0;if(typeof i!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new n(w.fromJSON(t,e.content),i,s)}static maxOpen(t,e=!0){let i=0,s=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)i++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)s++;return new n(t,i,s)}};b.empty=new b(w.empty,0,0);function Li(n,t,e){let{index:i,offset:s}=n.findIndex(t),r=n.maybeChild(i),{index:o,offset:a}=n.findIndex(e);if(s==t||r.isText){if(a!=e&&!n.child(o).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(i!=o)throw new RangeError("Removing non-flat range");return n.replaceChild(i,r.copy(Li(r.content,t-s-1,e-s-1)))}function Di(n,t,e,i){let{index:s,offset:r}=n.findIndex(t),o=n.maybeChild(s);if(r==t||o.isText)return i&&!i.canReplace(s,s,e)?null:n.cut(0,t).append(e).append(n.cut(t));let a=Di(o.content,t-r-1,e,o);return a&&n.replaceChild(s,o.copy(a))}function go(n,t,e){if(e.openStart>n.depth)throw new Rt("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new Rt("Inconsistent open depths");return Bi(n,t,e,0)}function Bi(n,t,e,i){let s=n.index(i),r=n.node(i);if(s==t.index(i)&&i<n.depth-e.openStart){let o=Bi(n,t,e,i+1);return r.copy(r.content.replaceChild(s,o))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&n.depth==i&&t.depth==i){let o=n.parent,a=o.content;return Ct(o,a.cut(0,n.parentOffset).append(e.content).append(a.cut(t.parentOffset)))}else{let{start:o,end:a}=yo(e,n);return Ct(r,Wi(n,o,a,t,i))}else return Ct(r,ke(n,t,i))}function Fi(n,t){if(!t.type.compatibleContent(n.type))throw new Rt("Cannot join "+t.type.name+" onto "+n.type.name)}function un(n,t,e){let i=n.node(e);return Fi(i,t.node(e)),i}function At(n,t){let e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function Xt(n,t,e,i){let s=(t||n).node(e),r=0,o=t?t.index(e):s.childCount;n&&(r=n.index(e),n.depth>e?r++:n.textOffset&&(At(n.nodeAfter,i),r++));for(let a=r;a<o;a++)At(s.child(a),i);t&&t.depth==e&&t.textOffset&&At(t.nodeBefore,i)}function Ct(n,t){return n.type.checkContent(t),n.copy(t)}function Wi(n,t,e,i,s){let r=n.depth>s&&un(n,t,s+1),o=i.depth>s&&un(e,i,s+1),a=[];return Xt(null,n,s,a),r&&o&&t.index(s)==e.index(s)?(Fi(r,o),At(Ct(r,Wi(n,t,e,i,s+1)),a)):(r&&At(Ct(r,ke(n,t,s+1)),a),Xt(t,e,s,a),o&&At(Ct(o,ke(e,i,s+1)),a)),Xt(i,null,s,a),new w(a)}function ke(n,t,e){let i=[];if(Xt(null,n,e,i),n.depth>e){let s=un(n,t,e+1);At(Ct(s,ke(n,t,e+1)),i)}return Xt(t,null,e,i),new w(i)}function yo(n,t){let e=t.depth-n.openStart,s=t.node(e).copy(n.content);for(let r=e-1;r>=0;r--)s=t.node(r).copy(w.from(s));return{start:s.resolveNoCache(n.openStart+e),end:s.resolveNoCache(s.content.size-n.openEnd-e)}}var Se=class n{constructor(t,e,i){this.pos=t,this.path=e,this.parentOffset=i,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let i=this.pos-this.path[this.path.length-1],s=t.child(e);return i?t.child(e).cut(i):s}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let i=this.path[e*3],s=e==0?0:this.path[e*3-1]+1;for(let r=0;r<t;r++)s+=i.child(r).nodeSize;return s}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return z.none;if(this.textOffset)return t.child(e).marks;let i=t.maybeChild(e-1),s=t.maybeChild(e);if(!i){let a=i;i=s,s=a}let r=i.marks;for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!s||!r[o].isInSet(s.marks))&&(r=r[o--].removeFromSet(r));return r}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let i=e.marks,s=t.parent.maybeChild(t.index());for(var r=0;r<i.length;r++)i[r].type.spec.inclusive===!1&&(!s||!i[r].isInSet(s.marks))&&(i=i[r--].removeFromSet(i));return i}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let i=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);i>=0;i--)if(t.pos<=this.end(i)&&(!e||e(this.node(i))))return new Nt(this,t,i);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let i=[],s=0,r=e;for(let o=t;;){let{index:a,offset:l}=o.content.findIndex(r),u=r-l;if(i.push(o,a,s+l),!u||(o=o.child(a),o.isText))break;r=u-1,s+=l+1}return new n(e,i,r)}static resolveCached(t,e){let i=Ei.get(t);if(i)for(let r=0;r<i.elts.length;r++){let o=i.elts[r];if(o.pos==e)return o}else Ei.set(t,i=new cn);let s=i.elts[i.i]=n.resolve(t,e);return i.i=(i.i+1)%wo,s}},cn=class{constructor(){this.elts=[],this.i=0}},wo=12,Ei=new WeakMap,Nt=class{constructor(t,e,i){this.$from=t,this.$to=e,this.depth=i}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},bo=Object.create(null),st=class n{constructor(t,e,i,s=z.none){this.type=t,this.attrs=e,this.marks=s,this.content=i||w.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,i,s=0){this.content.nodesBetween(t,e,i,s,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,i,s){return this.content.textBetween(t,e,i,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,i){return this.type==t&&xe(this.attrs,e||t.defaultAttrs||bo)&&z.sameSet(this.marks,i||z.none)}copy(t=null){return t==this.content?this:new n(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new n(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,i=!1){if(t==e)return b.empty;let s=this.resolve(t),r=this.resolve(e),o=i?0:s.sharedDepth(e),a=s.start(o),u=s.node(o).content.cut(s.pos-a,r.pos-a);return new b(u,s.depth-o,r.depth-o)}replace(t,e,i){return go(this.resolve(t),this.resolve(e),i)}nodeAt(t){for(let e=this;;){let{index:i,offset:s}=e.content.findIndex(t);if(e=e.maybeChild(i),!e)return null;if(s==t||e.isText)return e;t-=s+1}}childAfter(t){let{index:e,offset:i}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:i}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:i}=this.content.findIndex(t);if(i<t)return{node:this.content.child(e),index:e,offset:i};let s=this.content.child(e-1);return{node:s,index:e-1,offset:i-s.nodeSize}}resolve(t){return Se.resolveCached(this,t)}resolveNoCache(t){return Se.resolve(this,t)}rangeHasMark(t,e,i){let s=!1;return e>t&&this.nodesBetween(t,e,r=>(i.isInSet(r.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),$i(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,i=w.empty,s=0,r=i.childCount){let o=this.contentMatchAt(t).matchFragment(i,s,r),a=o&&o.matchFragment(this.content,e);if(!a||!a.validEnd)return!1;for(let l=s;l<r;l++)if(!this.type.allowsMarks(i.child(l).marks))return!1;return!0}canReplaceWith(t,e,i,s){if(s&&!this.type.allowsMarks(s))return!1;let r=this.contentMatchAt(t).matchType(i),o=r&&r.matchFragment(this.content,e);return o?o.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=z.none;for(let e=0;e<this.marks.length;e++){let i=this.marks[e];i.type.checkAttrs(i.attrs),t=i.addToSet(t)}if(!z.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let i;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");i=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,i)}let s=w.fromJSON(t,e.content),r=t.nodeType(e.type).create(e.attrs,s,i);return r.type.checkAttrs(r.attrs),r}};st.prototype.text=void 0;var hn=class n extends st{constructor(t,e,i,s){if(super(t,e,null,s),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):$i(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new n(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new n(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}};function $i(n,t){for(let e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}var It=class n{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let i=new fn(t,e);if(i.next==null)return n.empty;let s=ji(i);i.next&&i.err("Unexpected trailing text");let r=Mo(To(s));return Oo(r,i),r}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,i=t.childCount){let s=this;for(let r=e;s&&r<i;r++)s=s.matchType(t.child(r).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let i=0;i<t.next.length;i++)if(this.next[e].type==t.next[i].type)return!0;return!1}fillBefore(t,e=!1,i=0){let s=[this];function r(o,a){let l=o.matchFragment(t,i);if(l&&(!e||l.validEnd))return w.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:c,next:h}=o.next[u];if(!(c.isText||c.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let f=r(h,a.concat(c));if(f)return f}}return null}return r(this,[])}findWrapping(t){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==t)return this.wrapCache[i+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),i=[{match:this,type:null,via:null}];for(;i.length;){let s=i.shift(),r=s.match;if(r.matchType(t)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<r.next.length;o++){let{type:a,next:l}=r.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in e)&&(!s.type||l.validEnd)&&(i.push({match:a.contentMatch,type:a,via:s}),e[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(i){t.push(i);for(let s=0;s<i.next.length;s++)t.indexOf(i.next[s].next)==-1&&e(i.next[s].next)}return e(this),t.map((i,s)=>{let r=s+(i.validEnd?"*":" ")+" ";for(let o=0;o<i.next.length;o++)r+=(o?", ":"")+i.next[o].type.name+"->"+t.indexOf(i.next[o].next);return r}).join(`
`)}};It.empty=new It(!0);var fn=class{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}};function ji(n){let t=[];do t.push(vo(n));while(n.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function vo(n){let t=[];do t.push(xo(n));while(n.next&&n.next!=")"&&n.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function xo(n){let t=Eo(n);for(;;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else if(n.eat("{"))t=ko(n,t);else break;return t}function Ti(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let t=Number(n.next);return n.pos++,t}function ko(n,t){let e=Ti(n),i=e;return n.eat(",")&&(n.next!="}"?i=Ti(n):i=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:i,expr:t}}function So(n,t){let e=n.nodeTypes,i=e[t];if(i)return[i];let s=[];for(let r in e){let o=e[r];o.isInGroup(t)&&s.push(o)}return s.length==0&&n.err("No node type or group '"+t+"' found"),s}function Eo(n){if(n.eat("(")){let t=ji(n);return n.eat(")")||n.err("Missing closing paren"),t}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let t=So(n,n.next).map(e=>(n.inline==null?n.inline=e.isInline:n.inline!=e.isInline&&n.err("Mixing inline and block content"),{type:"name",value:e}));return n.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function To(n){let t=[[]];return s(r(n,0),e()),t;function e(){return t.push([])-1}function i(o,a,l){let u={term:l,to:a};return t[o].push(u),u}function s(o,a){o.forEach(l=>l.to=a)}function r(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(r(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=r(o.exprs[l],a);if(l==o.exprs.length-1)return u;s(u,a=e())}else if(o.type=="star"){let l=e();return i(a,l),s(r(o.expr,l),l),[i(l)]}else if(o.type=="plus"){let l=e();return s(r(o.expr,a),l),s(r(o.expr,l),l),[i(l)]}else{if(o.type=="opt")return[i(a)].concat(r(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let c=e();s(r(o.expr,l),c),l=c}if(o.max==-1)s(r(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let c=e();i(l,c),s(r(o.expr,l),c),l=c}return[i(l)]}else{if(o.type=="name")return[i(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Ki(n,t){return t-n}function Mi(n,t){let e=[];return i(t),e.sort(Ki);function i(s){let r=n[s];if(r.length==1&&!r[0].term)return i(r[0].to);e.push(s);for(let o=0;o<r.length;o++){let{term:a,to:l}=r[o];!a&&e.indexOf(l)==-1&&i(l)}}}function Mo(n){let t=Object.create(null);return e(Mi(n,0));function e(i){let s=[];i.forEach(o=>{n[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let c=0;c<s.length;c++)s[c][0]==a&&(u=s[c][1]);Mi(n,l).forEach(c=>{u||s.push([a,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let r=t[i.join(",")]=new It(i.indexOf(n.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(Ki);r.next.push({type:s[o][0],next:t[a.join(",")]||e(a)})}return r}}function Oo(n,t){for(let e=0,i=[n];e<i.length;e++){let s=i[e],r=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:u}=s.next[a];o.push(l.name),r&&!(l.isText||l.hasRequiredAttrs())&&(r=!1),i.indexOf(u)==-1&&i.push(u)}r&&t.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Ui(n){let t=Object.create(null);for(let e in n){let i=n[e];if(!i.hasDefault)return null;t[e]=i.default}return t}function Vi(n,t){let e=Object.create(null);for(let i in n){let s=t&&t[i];if(s===void 0){let r=n[i];if(r.hasDefault)s=r.default;else throw new RangeError("No value supplied for attribute "+i)}e[i]=s}return e}function Ji(n,t,e,i){for(let s in t)if(!(s in n))throw new RangeError(`Unsupported attribute ${s} for ${e} of type ${s}`);for(let s in n){let r=n[s];r.validate&&r.validate(t[s])}}function qi(n,t){let e=Object.create(null);if(t)for(let i in t)e[i]=new pn(n,i,t[i]);return e}var Ee=class n{constructor(t,e,i){this.name=t,this.schema=e,this.spec=i,this.markSet=null,this.groups=i.group?i.group.split(" "):[],this.attrs=qi(t,i.attrs),this.defaultAttrs=Ui(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(i.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==It.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:Vi(this.attrs,t)}create(t=null,e,i){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new st(this,this.computeAttrs(t),w.from(e),z.setFrom(i))}createChecked(t=null,e,i){return e=w.from(e),this.checkContent(e),new st(this,this.computeAttrs(t),e,z.setFrom(i))}createAndFill(t=null,e,i){if(t=this.computeAttrs(t),e=w.from(e),e.size){let o=this.contentMatch.fillBefore(e);if(!o)return null;e=o.append(e)}let s=this.contentMatch.matchFragment(e),r=s&&s.fillBefore(w.empty,!0);return r?new st(this,t,e.append(r),z.setFrom(i)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let i=0;i<t.childCount;i++)if(!this.allowsMarks(t.child(i).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){Ji(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let i=0;i<t.length;i++)this.allowsMarkType(t[i].type)?e&&e.push(t[i]):e||(e=t.slice(0,i));return e?e.length?e:z.none:t}static compile(t,e){let i=Object.create(null);t.forEach((r,o)=>i[r]=new n(r,e,o));let s=e.spec.topNode||"doc";if(!i[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!i.text)throw new RangeError("Every schema needs a 'text' type");for(let r in i.text.attrs)throw new RangeError("The text node type should not have attributes");return i}};function Ao(n,t,e){let i=e.split("|");return s=>{let r=s===null?"null":typeof s;if(i.indexOf(r)<0)throw new RangeError(`Expected value of type ${i} for attribute ${t} on type ${n}, got ${r}`)}}var pn=class{constructor(t,e,i){this.hasDefault=Object.prototype.hasOwnProperty.call(i,"default"),this.default=i.default,this.validate=typeof i.validate=="string"?Ao(t,e,i.validate):i.validate}get isRequired(){return!this.hasDefault}},Qt=class n{constructor(t,e,i,s){this.name=t,this.rank=e,this.schema=i,this.spec=s,this.attrs=qi(t,s.attrs),this.excluded=null;let r=Ui(this.attrs);this.instance=r?new z(this,r):null}create(t=null){return!t&&this.instance?this.instance:new z(this,Vi(this.attrs,t))}static compile(t,e){let i=Object.create(null),s=0;return t.forEach((r,o)=>i[r]=new n(r,s++,e,o)),i}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){Ji(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}},jt=class{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let s in t)e[s]=t[s];e.nodes=on.from(t.nodes),e.marks=on.from(t.marks||{}),this.nodes=Ee.compile(this.spec.nodes,this),this.marks=Qt.compile(this.spec.marks,this);let i=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let r=this.nodes[s],o=r.spec.content||"",a=r.spec.marks;if(r.contentMatch=i[o]||(i[o]=It.parse(o,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!r.isInline||!r.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=r}r.markSet=a=="_"?null:a?Oi(this,a.split(" ")):a==""||!r.inlineContent?[]:null}for(let s in this.marks){let r=this.marks[s],o=r.spec.excludes;r.excluded=o==null?[r]:o==""?[]:Oi(this,o.split(" "))}this.nodeFromJSON=s=>st.fromJSON(this,s),this.markFromJSON=s=>z.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,i,s){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof Ee){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,i,s)}text(t,e){let i=this.nodes.text;return new hn(i,i.defaultAttrs,t,z.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}};function Oi(n,t){let e=[];for(let i=0;i<t.length;i++){let s=t[i],r=n.marks[s],o=r;if(r)e.push(r);else for(let a in n.marks){let l=n.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&e.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+t[i]+"'")}return e}function Co(n){return n.tag!=null}function Ro(n){return n.style!=null}var Pt=class n{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let i=this.matchedStyles=[];e.forEach(s=>{if(Co(s))this.tags.push(s);else if(Ro(s)){let r=/[^=]*/.exec(s.style)[0];i.indexOf(r)<0&&i.push(r),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let r=t.nodes[s.node];return r.contentMatch.matchType(r)})}parse(t,e={}){let i=new Te(this,e,!1);return i.addAll(t,z.none,e.from,e.to),i.finish()}parseSlice(t,e={}){let i=new Te(this,e,!0);return i.addAll(t,z.none,e.from,e.to),b.maxOpen(i.finish())}matchTag(t,e,i){for(let s=i?this.tags.indexOf(i)+1:0;s<this.tags.length;s++){let r=this.tags[s];if(Po(t,r.tag)&&(r.namespace===void 0||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){let o=r.getAttrs(t);if(o===!1)continue;r.attrs=o||void 0}return r}}}matchStyle(t,e,i,s){for(let r=s?this.styles.indexOf(s)+1:0;r<this.styles.length;r++){let o=this.styles[r],a=o.style;if(!(a.indexOf(t)!=0||o.context&&!i.matchesContext(o.context)||a.length>t.length&&(a.charCodeAt(t.length)!=61||a.slice(t.length+1)!=e))){if(o.getAttrs){let l=o.getAttrs(e);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(t){let e=[];function i(s){let r=s.priority==null?50:s.priority,o=0;for(;o<e.length;o++){let a=e[o];if((a.priority==null?50:a.priority)<r)break}e.splice(o,0,s)}for(let s in t.marks){let r=t.marks[s].spec.parseDOM;r&&r.forEach(o=>{i(o=Ci(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in t.nodes){let r=t.nodes[s].spec.parseDOM;r&&r.forEach(o=>{i(o=Ci(o)),o.node||o.ignore||o.mark||(o.node=s)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new n(t,n.schemaRules(t)))}},Hi={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},No={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Xi={ol:!0,ul:!0},Yt=1,dn=2,Gt=4;function Ai(n,t,e){return t!=null?(t?Yt:0)|(t==="full"?dn:0):n&&n.whitespace=="pre"?Yt|dn:e&~Gt}var $t=class{constructor(t,e,i,s,r,o){this.type=t,this.attrs=e,this.marks=i,this.solid=s,this.options=o,this.content=[],this.activeMarks=z.none,this.match=r||(o&Gt?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(w.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let i=this.type.contentMatch,s;return(s=i.findWrapping(t.type))?(this.match=i,s):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Yt)){let i=this.content[this.content.length-1],s;if(i&&i.isText&&(s=/[ \t\r\n\u000c]+$/.exec(i.text))){let r=i;i.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-s[0].length))}}let e=w.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(w.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Hi.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}},Te=class{constructor(t,e,i){this.parser=t,this.options=e,this.isOpen=i,this.open=0,this.localPreserveWS=!1;let s=e.topNode,r,o=Ai(null,e.preserveWhitespace,0)|(i?Gt:0);s?r=new $t(s.type,s.attrs,z.none,!0,e.topMatch||s.type.contentMatch,o):i?r=new $t(null,null,z.none,!0,null,o):r=new $t(t.schema.topNodeType,null,z.none,!0,null,o),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){t.nodeType==3?this.addTextNode(t,e):t.nodeType==1&&this.addElement(t,e)}addTextNode(t,e){let i=t.nodeValue,s=this.top,r=s.options&dn?"full":this.localPreserveWS||(s.options&Yt)>0,{schema:o}=this.parser;if(r==="full"||s.inlineContext(t)||/[^ \t\r\n\u000c]/.test(i)){if(r)if(r==="full")i=i.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(i)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=i.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),e,!0),a[l]&&this.insertNode(o.text(a[l]),e,!/\S/.test(a[l]));i=""}else i=i.replace(/\r?\n|\r/g," ");else if(i=i.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(i)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=t.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(i=i.slice(1))}i&&this.insertNode(o.text(i),e,!/\S/.test(i)),this.findInText(t)}else this.findInside(t)}addElement(t,e,i){let s=this.localPreserveWS,r=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let o=t.nodeName.toLowerCase(),a;Xi.hasOwnProperty(o)&&this.parser.normalizeLists&&Io(t);let l=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(a=this.parser.matchTag(t,this,i));t:if(l?l.ignore:No.hasOwnProperty(o))this.findInside(t),this.ignoreFallback(t,e);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(t=l.skip);let u,c=this.needsBlock;if(Hi.hasOwnProperty(o))r.content.length&&r.content[0].isInline&&this.open&&(this.open--,r=this.top),u=!0,r.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break t}let h=l&&l.skip?e:this.readStyles(t,e);h&&this.addAll(t,h),u&&this.sync(r),this.needsBlock=c}else{let u=this.readStyles(t,e);u&&this.addElementByRule(t,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(t,e){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),e)}ignoreFallback(t,e){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let i=t.style;if(i&&i.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let r=this.parser.matchedStyles[s],o=i.getPropertyValue(r);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(r,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?e=e.filter(u=>!l.clearMark(u)):e=e.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return e}addElementByRule(t,e,i,s){let r,o;if(e.node)if(o=this.parser.schema.nodes[e.node],o.isLeaf)this.insertNode(o.create(e.attrs),i,t.nodeName=="BR")||this.leafFallback(t,i);else{let l=this.enter(o,e.attrs||null,i,e.preserveWhitespace);l&&(r=!0,i=l)}else{let l=this.parser.schema.marks[e.mark];i=i.concat(l.create(e.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(t);else if(s)this.addElement(t,i,s);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(l=>this.insertNode(l,i,!1));else{let l=t;typeof e.contentElement=="string"?l=t.querySelector(e.contentElement):typeof e.contentElement=="function"?l=e.contentElement(t):e.contentElement&&(l=e.contentElement),this.findAround(t,l,!0),this.addAll(l,i),this.findAround(t,l,!1)}r&&this.sync(a)&&this.open--}addAll(t,e,i,s){let r=i||0;for(let o=i?t.childNodes[i]:t.firstChild,a=s==null?null:t.childNodes[s];o!=a;o=o.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(o,e);this.findAtPoint(t,r)}findPlace(t,e,i){let s,r;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],u=l.findWrapping(t);if(u&&(!s||s.length>u.length+a)&&(s=u,r=l,!u.length))break;if(l.solid){if(i)break;a+=2}}if(!s)return null;this.sync(r);for(let o=0;o<s.length;o++)e=this.enterInner(s[o],null,e,!1);return e}insertNode(t,e,i){if(t.isInline&&this.needsBlock&&!this.top.type){let r=this.textblockFromContext();r&&(e=this.enterInner(r,null,e))}let s=this.findPlace(t,e,i);if(s){this.closeExtra();let r=this.top;r.match&&(r.match=r.match.matchType(t.type));let o=z.none;for(let a of s.concat(t.marks))(r.type?r.type.allowsMarkType(a.type):Ri(a.type,t.type))&&(o=a.addToSet(o));return r.content.push(t.mark(o)),!0}return!1}enter(t,e,i,s){let r=this.findPlace(t.create(e),i,!1);return r&&(r=this.enterInner(t,e,i,!0,s)),r}enterInner(t,e,i,s=!1,r){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(t);let a=Ai(t,r,o.options);o.options&Gt&&o.content.length==0&&(a|=Gt);let l=z.none;return i=i.filter(u=>(o.type?o.type.allowsMarkType(u.type):Ri(u.type,t))?(l=u.addToSet(l),!1):!0),this.nodes.push(new $t(t,e,l,s,null,a)),this.open++,i}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=Yt)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let i=this.nodes[e].content;for(let s=i.length-1;s>=0;s--)t+=i[s].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==t&&this.find[i].offset==e&&(this.find[i].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,i){if(t!=e&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&t.nodeType==1&&t.contains(this.find[s].node)&&e.compareDocumentPosition(this.find[s].node)&(i?2:4)&&(this.find[s].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),i=this.options.context,s=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),r=-(i?i.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let u=e[a];if(u==""){if(a==e.length-1||a==0)continue;for(;l>=r;l--)if(o(a-1,l))return!0;return!1}else{let c=l>0||l==0&&s?this.nodes[l].type:i&&l>=r?i.node(l-r).type:null;if(!c||c.name!=u&&!c.isInGroup(u))return!1;l--}}return!0};return o(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let i=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(i&&i.isTextblock&&i.defaultAttrs)return i}for(let e in this.parser.schema.nodes){let i=this.parser.schema.nodes[e];if(i.isTextblock&&i.defaultAttrs)return i}}};function Io(n){for(let t=n.firstChild,e=null;t;t=t.nextSibling){let i=t.nodeType==1?t.nodeName.toLowerCase():null;i&&Xi.hasOwnProperty(i)&&e?(e.appendChild(t),t=e):i=="li"?e=t:i&&(e=null)}}function Po(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function Ci(n){let t={};for(let e in n)t[e]=n[e];return t}function Ri(n,t){let e=t.schema.nodes;for(let i in e){let s=e[i];if(!s.allowsMarkType(n))continue;let r=[],o=a=>{r.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:c}=a.edge(l);if(u==t||r.indexOf(c)<0&&o(c))return!0}};if(o(s.contentMatch))return!0}}var Me=class n{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},i){i||(i=ln(e).createDocumentFragment());let s=i,r=[];return t.forEach(o=>{if(r.length||o.marks.length){let a=0,l=0;for(;a<r.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(r[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<r.length;)s=r.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],c=this.serializeMark(u,o.isInline,e);c&&(r.push([u,s]),s.appendChild(c.dom),s=c.contentDOM||c.dom)}}s.appendChild(this.serializeNodeInner(o,e))}),i}serializeNodeInner(t,e){let{dom:i,contentDOM:s}=ve(ln(e),this.nodes[t.type.name](t),null,t.attrs);if(s){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,s)}return i}serializeNode(t,e={}){let i=this.serializeNodeInner(t,e);for(let s=t.marks.length-1;s>=0;s--){let r=this.serializeMark(t.marks[s],t.isInline,e);r&&((r.contentDOM||r.dom).appendChild(i),i=r.dom)}return i}serializeMark(t,e,i={}){let s=this.marks[t.type.name];return s&&ve(ln(i),s(t,e),null,t.attrs)}static renderSpec(t,e,i=null,s){return ve(t,e,i,s)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new n(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=Ni(t.nodes);return e.text||(e.text=i=>i.text),e}static marksFromSchema(t){return Ni(t.marks)}};function Ni(n){let t={};for(let e in n){let i=n[e].spec.toDOM;i&&(t[e]=i)}return t}function ln(n){return n.document||window.document}var Ii=new WeakMap;function zo(n){let t=Ii.get(n);return t===void 0&&Ii.set(n,t=Lo(n)),t}function Lo(n){let t=null;function e(i){if(i&&typeof i=="object")if(Array.isArray(i))if(typeof i[0]=="string")t||(t=[]),t.push(i);else for(let s=0;s<i.length;s++)e(i[s]);else for(let s in i)e(i[s])}return e(n),t}function ve(n,t,e,i){if(typeof t=="string")return{dom:n.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let s=t[0],r;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(i&&(r=zo(i))&&r.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(e=s.slice(0,o),s=s.slice(o+1));let a,l=e?n.createElementNS(e,s):n.createElement(s),u=t[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(let h in u)if(u[h]!=null){let f=h.indexOf(" ");f>0?l.setAttributeNS(h.slice(0,f),h.slice(f+1),u[h]):h=="style"&&l.style?l.style.cssText=u[h]:l.setAttribute(h,u[h])}}for(let h=c;h<t.length;h++){let f=t[h];if(f===0){if(h<t.length-1||h>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:p,contentDOM:d}=ve(n,f,e,i);if(l.appendChild(p),d){if(a)throw new RangeError("Multiple content holes");a=d}}}return{dom:l,contentDOM:a}}var Yi=65535,Zi=Math.pow(2,16);function Do(n,t){return n+t*Zi}function Gi(n){return n&Yi}function Bo(n){return(n-(n&Yi))/Zi}var ts=1,es=2,Oe=4,ns=8,ee=class{constructor(t,e,i){this.pos=t,this.delInfo=e,this.recover=i}get deleted(){return(this.delInfo&ns)>0}get deletedBefore(){return(this.delInfo&(ts|Oe))>0}get deletedAfter(){return(this.delInfo&(es|Oe))>0}get deletedAcross(){return(this.delInfo&Oe)>0}},mt=class n{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&n.empty)return n.empty}recover(t){let e=0,i=Gi(t);if(!this.inverted)for(let s=0;s<i;s++)e+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[i*3]+e+Bo(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,i){let s=0,r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>t)break;let u=this.ranges[a+r],c=this.ranges[a+o],h=l+u;if(t<=h){let f=u?t==l?-1:t==h?1:e:e,p=l+s+(f<0?0:c);if(i)return p;let d=t==(e<0?l:h)?null:Do(a/3,t-l),_=t==l?es:t==h?ts:Oe;return(e<0?t!=l:t!=h)&&(_|=ns),new ee(p,_,d)}s+=c-u}return i?t+s:new ee(t+s,0,null)}touches(t,e){let i=0,s=Gi(e),r=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>t)break;let u=this.ranges[a+r],c=l+u;if(t<=c&&a==s*3)return!0;i+=this.ranges[a+o]-u}return!1}forEach(t){let e=this.inverted?2:1,i=this.inverted?1:2;for(let s=0,r=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?r:0),l=o+(this.inverted?0:r),u=this.ranges[s+e],c=this.ranges[s+i];t(a,a+u,l,l+c),r+=c-u}}invert(){return new n(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?n.empty:new n(t<0?[0,-t,0]:[0,0,t])}};mt.empty=new mt([]);var yn=class n{constructor(t,e,i=0,s=t?t.length:0){this.mirror=e,this.from=i,this.to=s,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new n(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),e!=null&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,i=this._maps.length;e<t._maps.length;e++){let s=t.getMirror(e);this.appendMap(t._maps[e],s!=null&&s<e?i+s:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,i=this._maps.length+t._maps.length;e>=0;e--){let s=t.getMirror(e);this.appendMap(t._maps[e].invert(),s!=null&&s>e?i-s-1:void 0)}}invert(){let t=new n;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let i=this.from;i<this.to;i++)t=this._maps[i].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,i){let s=0;for(let r=this.from;r<this.to;r++){let o=this._maps[r],a=o.mapResult(t,e);if(a.recover!=null){let l=this.getMirror(r);if(l!=null&&l>r&&l<this.to){r=l,t=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,t=a.pos}return i?t:new ee(t,s,null)}},_n=Object.create(null),V=class{getMap(){return mt.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let i=_n[e.stepType];if(!i)throw new RangeError(`No step type ${e.stepType} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in _n)throw new RangeError("Duplicate use of step JSON ID "+t);return _n[t]=e,e.prototype.jsonID=t,e}},G=class n{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new n(t,null)}static fail(t){return new n(null,t)}static fromReplace(t,e,i,s){try{return n.ok(t.replace(e,i,s))}catch(r){if(r instanceof Rt)return n.fail(r.message);throw r}}};function vn(n,t,e){let i=[];for(let s=0;s<n.childCount;s++){let r=n.child(s);r.content.size&&(r=r.copy(vn(r.content,t,r))),r.isInline&&(r=t(r,e,s)),i.push(r)}return w.fromArray(i)}var ne=class n extends V{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=t.resolve(this.from),s=i.node(i.sharedDepth(this.to)),r=new b(vn(e.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),e.openStart,e.openEnd);return G.fromReplace(t,this.from,this.to,r)}invert(){return new gt(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new n(e.pos,i.pos,this.mark)}merge(t){return t instanceof n&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new n(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new n(e.from,e.to,t.markFromJSON(e.mark))}};V.jsonID("addMark",ne);var gt=class n extends V{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=new b(vn(e.content,s=>s.mark(this.mark.removeFromSet(s.marks)),t),e.openStart,e.openEnd);return G.fromReplace(t,this.from,this.to,i)}invert(){return new ne(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new n(e.pos,i.pos,this.mark)}merge(t){return t instanceof n&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new n(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new n(e.from,e.to,t.markFromJSON(e.mark))}};V.jsonID("removeMark",gt);var ie=class n extends V{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return G.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return G.fromReplace(t,this.pos,this.pos+1,new b(w.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let i=this.mark.addToSet(e.marks);if(i.length==e.marks.length){for(let s=0;s<e.marks.length;s++)if(!e.marks[s].isInSet(i))return new n(this.pos,e.marks[s]);return new n(this.pos,this.mark)}}return new Kt(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new n(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new n(e.pos,t.markFromJSON(e.mark))}};V.jsonID("addNodeMark",ie);var Kt=class n extends V{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return G.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return G.fromReplace(t,this.pos,this.pos+1,new b(w.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new ie(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new n(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new n(e.pos,t.markFromJSON(e.mark))}};V.jsonID("removeNodeMark",Kt);var tt=class n extends V{constructor(t,e,i,s=!1){super(),this.from=t,this.to=e,this.slice=i,this.structure=s}apply(t){return this.structure&&wn(t,this.from,this.to)?G.fail("Structure replace would overwrite content"):G.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new mt([this.from,this.to-this.from,this.slice.size])}invert(t){return new n(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deletedAcross&&i.deletedAcross?null:new n(e.pos,Math.max(e.pos,i.pos),this.slice,this.structure)}merge(t){if(!(t instanceof n)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?b.empty:new b(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new n(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?b.empty:new b(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new n(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new n(e.from,e.to,b.fromJSON(t,e.slice),!!e.structure)}};V.jsonID("replace",tt);var j=class n extends V{constructor(t,e,i,s,r,o,a=!1){super(),this.from=t,this.to=e,this.gapFrom=i,this.gapTo=s,this.slice=r,this.insert=o,this.structure=a}apply(t){if(this.structure&&(wn(t,this.from,this.gapFrom)||wn(t,this.gapTo,this.to)))return G.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return G.fail("Gap is not a flat range");let i=this.slice.insertAt(this.insert,e.content);return i?G.fromReplace(t,this.from,this.to,i):G.fail("Content does not fit in gap")}getMap(){return new mt([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new n(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1),s=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),r=this.to==this.gapTo?i.pos:t.map(this.gapTo,1);return e.deletedAcross&&i.deletedAcross||s<e.pos||r>i.pos?null:new n(e.pos,i.pos,s,r,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new n(e.from,e.to,e.gapFrom,e.gapTo,b.fromJSON(t,e.slice),e.insert,!!e.structure)}};V.jsonID("replaceAround",j);function wn(n,t,e){let i=n.resolve(t),s=e-t,r=i.depth;for(;s>0&&r>0&&i.indexAfter(r)==i.node(r).childCount;)r--,s--;if(s>0){let o=i.node(r).maybeChild(i.indexAfter(r));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function Fo(n,t,e,i){let s=[],r=[],o,a;n.doc.nodesBetween(t,e,(l,u,c)=>{if(!l.isInline)return;let h=l.marks;if(!i.isInSet(h)&&c.type.allowsMarkType(i.type)){let f=Math.max(u,t),p=Math.min(u+l.nodeSize,e),d=i.addToSet(h);for(let _=0;_<h.length;_++)h[_].isInSet(d)||(o&&o.to==f&&o.mark.eq(h[_])?o.to=p:s.push(o=new gt(f,p,h[_])));a&&a.to==f?a.to=p:r.push(a=new ne(f,p,i))}}),s.forEach(l=>n.step(l)),r.forEach(l=>n.step(l))}function Wo(n,t,e,i){let s=[],r=0;n.doc.nodesBetween(t,e,(o,a)=>{if(!o.isInline)return;r++;let l=null;if(i instanceof Qt){let u=o.marks,c;for(;c=i.isInSet(u);)(l||(l=[])).push(c),u=c.removeFromSet(u)}else i?i.isInSet(o.marks)&&(l=[i]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,e);for(let c=0;c<l.length;c++){let h=l[c],f;for(let p=0;p<s.length;p++){let d=s[p];d.step==r-1&&h.eq(s[p].style)&&(f=d)}f?(f.to=u,f.step=r):s.push({style:h,from:Math.max(a,t),to:u,step:r})}}}),s.forEach(o=>n.step(new gt(o.from,o.to,o.style)))}function xn(n,t,e,i=e.contentMatch,s=!0){let r=n.doc.nodeAt(t),o=[],a=t+1;for(let l=0;l<r.childCount;l++){let u=r.child(l),c=a+u.nodeSize,h=i.matchType(u.type);if(!h)o.push(new tt(a,c,b.empty));else{i=h;for(let f=0;f<u.marks.length;f++)e.allowsMarkType(u.marks[f].type)||n.step(new gt(a,c,u.marks[f]));if(s&&u.isText&&e.whitespace!="pre"){let f,p=/\r?\n|\r/g,d;for(;f=p.exec(u.text);)d||(d=new b(w.from(e.schema.text(" ",e.allowedMarks(u.marks))),0,0)),o.push(new tt(a+f.index,a+f.index+f[0].length,d))}}a=c}if(!i.validEnd){let l=i.fillBefore(w.empty,!0);n.replace(a,a,new b(l,0,0))}for(let l=o.length-1;l>=0;l--)n.step(o[l])}function $o(n,t,e){return(t==0||n.canReplace(t,n.childCount))&&(e==n.childCount||n.canReplace(0,e))}function yt(n){let e=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let i=n.depth,s=0,r=0;;--i){let o=n.$from.node(i),a=n.$from.index(i)+s,l=n.$to.indexAfter(i)-r;if(i<n.depth&&o.canReplace(a,l,e))return i;if(i==0||o.type.spec.isolating||!$o(o,a,l))break;a&&(s=1),l<o.childCount&&(r=1)}return null}function jo(n,t,e){let{$from:i,$to:s,depth:r}=t,o=i.before(r+1),a=s.after(r+1),l=o,u=a,c=w.empty,h=0;for(let d=r,_=!1;d>e;d--)_||i.index(d)>0?(_=!0,c=w.from(i.node(d).copy(c)),h++):l--;let f=w.empty,p=0;for(let d=r,_=!1;d>e;d--)_||s.after(d+1)<s.end(d)?(_=!0,f=w.from(s.node(d).copy(f)),p++):u++;n.step(new j(l,u,o,a,new b(c.append(f),h,p),c.size-h,!0))}function re(n,t,e=null,i=n){let s=Ko(n,t),r=s&&Uo(i,t);return r?s.map(Qi).concat({type:t,attrs:e}).concat(r.map(Qi)):null}function Qi(n){return{type:n,attrs:null}}function Ko(n,t){let{parent:e,startIndex:i,endIndex:s}=n,r=e.contentMatchAt(i).findWrapping(t);if(!r)return null;let o=r.length?r[0]:t;return e.canReplaceWith(i,s,o)?r:null}function Uo(n,t){let{parent:e,startIndex:i,endIndex:s}=n,r=e.child(i),o=t.contentMatch.findWrapping(r.type);if(!o)return null;let l=(o.length?o[o.length-1]:t).contentMatch;for(let u=i;l&&u<s;u++)l=l.matchType(e.child(u).type);return!l||!l.validEnd?null:o}function Vo(n,t,e){let i=w.empty;for(let o=e.length-1;o>=0;o--){if(i.size){let a=e[o].type.contentMatch.matchFragment(i);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=w.from(e[o].type.create(e[o].attrs,i))}let s=t.start,r=t.end;n.step(new j(s,r,s,r,new b(i,0,0),e.length,!0))}function Jo(n,t,e,i,s){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let r=n.steps.length;n.doc.nodesBetween(t,e,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(i,l)&&qo(n.doc,n.mapping.slice(r).map(a),i)){let u=null;if(i.schema.linebreakReplacement){let p=i.whitespace=="pre",d=!!i.contentMatch.matchType(i.schema.linebreakReplacement);p&&!d?u=!1:!p&&d&&(u=!0)}u===!1&&ss(n,o,a,r),xn(n,n.mapping.slice(r).map(a,1),i,void 0,u===null);let c=n.mapping.slice(r),h=c.map(a,1),f=c.map(a+o.nodeSize,1);return n.step(new j(h,f,h+1,f-1,new b(w.from(i.create(l,null,o.marks)),0,0),1,!0)),u===!0&&is(n,o,a,r),!1}})}function is(n,t,e,i){t.forEach((s,r)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=n.mapping.slice(i).map(e+1+r+o.index);n.replaceWith(l,l+1,t.type.schema.linebreakReplacement.create())}}})}function ss(n,t,e,i){t.forEach((s,r)=>{if(s.type==s.type.schema.linebreakReplacement){let o=n.mapping.slice(i).map(e+1+r);n.replaceWith(o,o+1,t.type.schema.text(`
`))}})}function qo(n,t,e){let i=n.resolve(t),s=i.index();return i.parent.canReplaceWith(s,s+1,e)}function Ho(n,t,e,i,s){let r=n.doc.nodeAt(t);if(!r)throw new RangeError("No node at given position");e||(e=r.type);let o=e.create(i,null,s||r.marks);if(r.isLeaf)return n.replaceWith(t,t+r.nodeSize,o);if(!e.validContent(r.content))throw new RangeError("Invalid content for node type "+e.name);n.step(new j(t,t+r.nodeSize,t+1,t+r.nodeSize-1,new b(w.from(o),0,0),1,!0))}function rt(n,t,e=1,i){let s=n.resolve(t),r=s.depth-e,o=i&&i[i.length-1]||s.parent;if(r<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let u=s.depth-1,c=e-2;u>r;u--,c--){let h=s.node(u),f=s.index(u);if(h.type.spec.isolating)return!1;let p=h.content.cutByIndex(f,h.childCount),d=i&&i[c+1];d&&(p=p.replaceChild(0,d.type.create(d.attrs)));let _=i&&i[c]||h;if(!h.canReplace(f+1,h.childCount)||!_.type.validContent(p))return!1}let a=s.indexAfter(r),l=i&&i[0];return s.node(r).canReplaceWith(a,a,l?l.type:s.node(r+1).type)}function Xo(n,t,e=1,i){let s=n.doc.resolve(t),r=w.empty,o=w.empty;for(let a=s.depth,l=s.depth-e,u=e-1;a>l;a--,u--){r=w.from(s.node(a).copy(r));let c=i&&i[u];o=w.from(c?c.type.create(c.attrs,o):s.node(a).copy(o))}n.step(new tt(t,t,new b(r.append(o),e,e),!0))}function ht(n,t){let e=n.resolve(t),i=e.index();return rs(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(i,i+1)}function Go(n,t){t.content.size||n.type.compatibleContent(t.type);let e=n.contentMatchAt(n.childCount),{linebreakReplacement:i}=n.type.schema;for(let s=0;s<t.childCount;s++){let r=t.child(s),o=r.type==i?n.type.schema.nodes.text:r.type;if(e=e.matchType(o),!e||!n.type.allowsMarks(r.marks))return!1}return e.validEnd}function rs(n,t){return!!(n&&t&&!n.isLeaf&&Go(n,t))}function zt(n,t,e=-1){let i=n.resolve(t);for(let s=i.depth;;s--){let r,o,a=i.index(s);if(s==i.depth?(r=i.nodeBefore,o=i.nodeAfter):e>0?(r=i.node(s+1),a++,o=i.node(s).maybeChild(a)):(r=i.node(s).maybeChild(a-1),o=i.node(s+1)),r&&!r.isTextblock&&rs(r,o)&&i.node(s).canReplace(a,a+1))return t;if(s==0)break;t=e<0?i.before(s):i.after(s)}}function Qo(n,t,e){let i=null,{linebreakReplacement:s}=n.doc.type.schema,r=n.doc.resolve(t-e),o=r.node().type;if(s&&o.inlineContent){let c=o.whitespace=="pre",h=!!o.contentMatch.matchType(s);c&&!h?i=!1:!c&&h&&(i=!0)}let a=n.steps.length;if(i===!1){let c=n.doc.resolve(t+e);ss(n,c.node(),c.before(),a)}o.inlineContent&&xn(n,t+e-1,o,r.node().contentMatchAt(r.index()),i==null);let l=n.mapping.slice(a),u=l.map(t-e);if(n.step(new tt(u,l.map(t+e,-1),b.empty,!0)),i===!0){let c=n.doc.resolve(u);is(n,c.node(),c.before(),n.steps.length)}return n}function Yo(n,t,e){let i=n.resolve(t);if(i.parent.canReplaceWith(i.index(),i.index(),e))return t;if(i.parentOffset==0)for(let s=i.depth-1;s>=0;s--){let r=i.index(s);if(i.node(s).canReplaceWith(r,r,e))return i.before(s+1);if(r>0)return null}if(i.parentOffset==i.parent.content.size)for(let s=i.depth-1;s>=0;s--){let r=i.indexAfter(s);if(i.node(s).canReplaceWith(r,r,e))return i.after(s+1);if(r<i.node(s).childCount)return null}return null}function oe(n,t,e=t,i=b.empty){if(t==e&&!i.size)return null;let s=n.resolve(t),r=n.resolve(e);return as(s,r,i)?new tt(t,e,i):new bn(s,r,i).fit()}function as(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}var bn=class{constructor(t,e,i){this.$from=t,this.$to=e,this.unplaced=i,this.frontier=[],this.placed=w.empty;for(let s=0;s<=t.depth;s++){let r=t.node(s);this.frontier.push({type:r.type,match:r.contentMatchAt(t.indexAfter(s))})}for(let s=t.depth;s>0;s--)this.placed=w.from(t.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,i=this.$from,s=this.close(t<0?this.$to:i.doc.resolve(t));if(!s)return null;let r=this.placed,o=i.depth,a=s.depth;for(;o&&a&&r.childCount==1;)r=r.firstChild.content,o--,a--;let l=new b(r,o,a);return t>-1?new j(i.pos,t,this.$to.pos,this.$to.end(),l,e):l.size||i.pos!=this.$to.pos?new tt(i.pos,s.pos,l):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,i=0,s=this.unplaced.openEnd;i<t;i++){let r=e.firstChild;if(e.childCount>1&&(s=0),r.type.spec.isolating&&s<=i){t=i;break}e=r.content}for(let e=1;e<=2;e++)for(let i=e==1?t:this.unplaced.openStart;i>=0;i--){let s,r=null;i?(r=mn(this.unplaced.content,i-1).firstChild,s=r.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],c,h=null;if(e==1&&(o?u.matchType(o.type)||(h=u.fillBefore(w.from(o),!1)):r&&l.compatibleContent(r.type)))return{sliceDepth:i,frontierDepth:a,parent:r,inject:h};if(e==2&&o&&(c=u.findWrapping(o.type)))return{sliceDepth:i,frontierDepth:a,parent:r,wrap:c};if(r&&u.matchType(r.type))break}}}openMore(){let{content:t,openStart:e,openEnd:i}=this.unplaced,s=mn(t,e);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new b(t,e+1,Math.max(i,s.size+e>=t.size-i?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:i}=this.unplaced,s=mn(t,e);if(s.childCount<=1&&e>0){let r=t.size-e<=e+s.size;this.unplaced=new b(Zt(t,e-1,1),e-1,r?e-1:i)}else this.unplaced=new b(Zt(t,e,1),e,i)}placeNodes({sliceDepth:t,frontierDepth:e,parent:i,inject:s,wrap:r}){for(;this.depth>e;)this.closeFrontierNode();if(r)for(let _=0;_<r.length;_++)this.openFrontierNode(r[_]);let o=this.unplaced,a=i?i.content:o.content,l=o.openStart-t,u=0,c=[],{match:h,type:f}=this.frontier[e];if(s){for(let _=0;_<s.childCount;_++)c.push(s.child(_));h=h.matchFragment(s)}let p=a.size+t-(o.content.size-o.openEnd);for(;u<a.childCount;){let _=a.child(u),m=h.matchType(_.type);if(!m)break;u++,(u>1||l==0||_.content.size)&&(h=m,c.push(ls(_.mark(f.allowedMarks(_.marks)),u==1?l:0,u==a.childCount?p:-1)))}let d=u==a.childCount;d||(p=-1),this.placed=te(this.placed,e,w.from(c)),this.frontier[e].match=h,d&&p<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let _=0,m=a;_<p;_++){let y=m.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),m=y.content}this.unplaced=d?t==0?b.empty:new b(Zt(o.content,t-1,1),t-1,p<0?o.openEnd:t-1):new b(Zt(o.content,t,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!gn(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:i}=this.$to,s=this.$to.after(i);for(;i>1&&s==this.$to.end(--i);)++s;return s}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:i,type:s}=this.frontier[e],r=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),o=gn(t,e,s,i,r);if(o){for(let a=e-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],c=gn(t,a,u,l,!0);if(!c||c.childCount)continue t}return{depth:e,fit:o,move:r?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=te(this.placed,e.depth,e.fit)),t=e.move;for(let i=e.depth+1;i<=t.depth;i++){let s=t.node(i),r=s.type.contentMatch.fillBefore(s.content,!0,t.index(i));this.openFrontierNode(s.type,s.attrs,r)}return t}openFrontierNode(t,e=null,i){let s=this.frontier[this.depth];s.match=s.match.matchType(t),this.placed=te(this.placed,this.depth,w.from(t.create(e,i))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(w.empty,!0);e.childCount&&(this.placed=te(this.placed,this.frontier.length,e))}};function Zt(n,t,e){return t==0?n.cutByIndex(e,n.childCount):n.replaceChild(0,n.firstChild.copy(Zt(n.firstChild.content,t-1,e)))}function te(n,t,e){return t==0?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(te(n.lastChild.content,t-1,e)))}function mn(n,t){for(let e=0;e<t;e++)n=n.firstChild.content;return n}function ls(n,t,e){if(t<=0)return n;let i=n.content;return t>1&&(i=i.replaceChild(0,ls(i.firstChild,t-1,i.childCount==1?e-1:0))),t>0&&(i=n.type.contentMatch.fillBefore(i).append(i),e<=0&&(i=i.append(n.type.contentMatch.matchFragment(i).fillBefore(w.empty,!0)))),n.copy(i)}function gn(n,t,e,i,s){let r=n.node(t),o=s?n.indexAfter(t):n.index(t);if(o==r.childCount&&!e.compatibleContent(r.type))return null;let a=i.fillBefore(r.content,!0,o);return a&&!Zo(e,r.content,o)?a:null}function Zo(n,t,e){for(let i=e;i<t.childCount;i++)if(!n.allowsMarks(t.child(i).marks))return!0;return!1}function ta(n){return n.spec.defining||n.spec.definingForContent}function ea(n,t,e,i){if(!i.size)return n.deleteRange(t,e);let s=n.doc.resolve(t),r=n.doc.resolve(e);if(as(s,r,i))return n.step(new tt(t,e,i));let o=cs(s,r);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let f=s.depth,p=s.pos-1;f>0;f--,p--){let d=s.node(f).type.spec;if(d.defining||d.definingAsContext||d.isolating)break;o.indexOf(f)>-1?a=f:s.before(f)==p&&o.splice(1,0,-f)}let l=o.indexOf(a),u=[],c=i.openStart;for(let f=i.content,p=0;;p++){let d=f.firstChild;if(u.push(d),p==i.openStart)break;f=d.content}for(let f=c-1;f>=0;f--){let p=u[f],d=ta(p.type);if(d&&!p.sameMarkup(s.node(Math.abs(a)-1)))c=f;else if(d||!p.type.isTextblock)break}for(let f=i.openStart;f>=0;f--){let p=(f+c+1)%(i.openStart+1),d=u[p];if(d)for(let _=0;_<o.length;_++){let m=o[(_+l)%o.length],y=!0;m<0&&(y=!1,m=-m);let x=s.node(m-1),E=s.index(m-1);if(x.canReplaceWith(E,E,d.type,d.marks))return n.replace(s.before(m),y?r.after(m):e,new b(us(i.content,0,i.openStart,p),p,i.openEnd))}}let h=n.steps.length;for(let f=o.length-1;f>=0&&(n.replace(t,e,i),!(n.steps.length>h));f--){let p=o[f];p<0||(t=s.before(p),e=r.after(p))}}function us(n,t,e,i,s){if(t<e){let r=n.firstChild;n=n.replaceChild(0,r.copy(us(r.content,t+1,e,i,r)))}if(t>i){let r=s.contentMatchAt(0),o=r.fillBefore(n).append(n);n=o.append(r.matchFragment(o).fillBefore(w.empty,!0))}return n}function na(n,t,e,i){if(!i.isInline&&t==e&&n.doc.resolve(t).parent.content.size){let s=Yo(n.doc,t,i.type);s!=null&&(t=e=s)}n.replaceRange(t,e,new b(w.from(i),0,0))}function ia(n,t,e){let i=n.doc.resolve(t),s=n.doc.resolve(e),r=cs(i,s);for(let o=0;o<r.length;o++){let a=r[o],l=o==r.length-1;if(l&&a==0||i.node(a).type.contentMatch.validEnd)return n.delete(i.start(a),s.end(a));if(a>0&&(l||i.node(a-1).canReplace(i.index(a-1),s.indexAfter(a-1))))return n.delete(i.before(a),s.after(a))}for(let o=1;o<=i.depth&&o<=s.depth;o++)if(t-i.start(o)==i.depth-o&&e>i.end(o)&&s.end(o)-e!=s.depth-o&&i.start(o-1)==s.start(o-1)&&i.node(o-1).canReplace(i.index(o-1),s.index(o-1)))return n.delete(i.before(o),e);n.delete(t,e)}function cs(n,t){let e=[],i=Math.min(n.depth,t.depth);for(let s=i;s>=0;s--){let r=n.start(s);if(r<n.pos-(n.depth-s)||t.end(s)>t.pos+(t.depth-s)||n.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(r==t.start(s)||s==n.depth&&s==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==r-1)&&e.push(s)}return e}var Ae=class n extends V{constructor(t,e,i){super(),this.pos=t,this.attr=e,this.value=i}apply(t){let e=t.nodeAt(this.pos);if(!e)return G.fail("No node at attribute step's position");let i=Object.create(null);for(let r in e.attrs)i[r]=e.attrs[r];i[this.attr]=this.value;let s=e.type.create(i,null,e.marks);return G.fromReplace(t,this.pos,this.pos+1,new b(w.from(s),0,e.isLeaf?0:1))}getMap(){return mt.empty}invert(t){return new n(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new n(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new n(e.pos,e.attr,e.value)}};V.jsonID("attr",Ae);var Ce=class n extends V{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let s in t.attrs)e[s]=t.attrs[s];e[this.attr]=this.value;let i=t.type.create(e,t.content,t.marks);return G.ok(i)}getMap(){return mt.empty}invert(t){return new n(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new n(e.attr,e.value)}};V.jsonID("docAttr",Ce);var Ut=class extends Error{};Ut=function n(t){let e=Error.call(this,t);return e.__proto__=n.prototype,e};Ut.prototype=Object.create(Error.prototype);Ut.prototype.constructor=Ut;Ut.prototype.name="TransformError";var se=class{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new yn}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new Ut(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}changedRange(){let t=1e9,e=-1e9;for(let i=0;i<this.mapping.maps.length;i++){let s=this.mapping.maps[i];i&&(t=s.map(t,1),e=s.map(e,-1)),s.forEach((r,o,a,l)=>{t=Math.min(t,a),e=Math.max(e,l)})}return t==1e9?null:{from:t,to:e}}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,i=b.empty){let s=oe(this.doc,t,e,i);return s&&this.step(s),this}replaceWith(t,e,i){return this.replace(t,e,new b(w.from(i),0,0))}delete(t,e){return this.replace(t,e,b.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,i){return ea(this,t,e,i),this}replaceRangeWith(t,e,i){return na(this,t,e,i),this}deleteRange(t,e){return ia(this,t,e),this}lift(t,e){return jo(this,t,e),this}join(t,e=1){return Qo(this,t,e),this}wrap(t,e){return Vo(this,t,e),this}setBlockType(t,e=t,i,s=null){return Jo(this,t,e,i,s),this}setNodeMarkup(t,e,i=null,s){return Ho(this,t,e,i,s),this}setNodeAttribute(t,e,i){return this.step(new Ae(t,e,i)),this}setDocAttribute(t,e){return this.step(new Ce(t,e)),this}addNodeMark(t,e){return this.step(new ie(t,e)),this}removeNodeMark(t,e){let i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at position "+t);if(e instanceof z)e.isInSet(i.marks)&&this.step(new Kt(t,e));else{let s=i.marks,r,o=[];for(;r=e.isInSet(s);)o.push(new Kt(t,r)),s=r.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(t,e=1,i){return Xo(this,t,e,i),this}addMark(t,e,i){return Fo(this,t,e,i),this}removeMark(t,e,i){return Wo(this,t,e,i),this}clearIncompatible(t,e,i){return xn(this,t,e,i),this}};var kn=Object.create(null),A=class{constructor(t,e,i){this.$anchor=t,this.$head=e,this.ranges=i||[new Re(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=b.empty){let i=e.content.lastChild,s=null;for(let a=0;a<e.openEnd;a++)s=i,i=i.lastChild;let r=t.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],c=t.mapping.slice(r);t.replaceRange(c.map(l.pos),c.map(u.pos),a?b.empty:e),a==0&&ps(t,r,(i?i.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(t,e){let i=t.steps.length,s=this.ranges;for(let r=0;r<s.length;r++){let{$from:o,$to:a}=s[r],l=t.mapping.slice(i),u=l.map(o.pos),c=l.map(a.pos);r?t.deleteRange(u,c):(t.replaceRangeWith(u,c,e),ps(t,i,e.isInline?-1:1))}}static findFrom(t,e,i=!1){let s=t.parent.inlineContent?new I(t):Vt(t.node(0),t.parent,t.pos,t.index(),e,i);if(s)return s;for(let r=t.depth-1;r>=0;r--){let o=e<0?Vt(t.node(0),t.node(r),t.before(r+1),t.index(r),e,i):Vt(t.node(0),t.node(r),t.after(r+1),t.index(r)+1,e,i);if(o)return o}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new ot(t.node(0))}static atStart(t){return Vt(t,t,0,0,1)||new ot(t)}static atEnd(t){return Vt(t,t,t.content.size,t.childCount,-1)||new ot(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let i=kn[e.type];if(!i)throw new RangeError(`No selection type ${e.type} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in kn)throw new RangeError("Duplicate use of selection JSON ID "+t);return kn[t]=e,e.prototype.jsonID=t,e}getBookmark(){return I.between(this.$anchor,this.$head).getBookmark()}};A.prototype.visible=!0;var Re=class{constructor(t,e){this.$from=t,this.$to=e}},hs=!1;function fs(n){!hs&&!n.parent.inlineContent&&(hs=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}var I=class n extends A{constructor(t,e=t){fs(t),fs(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let i=t.resolve(e.map(this.head));if(!i.parent.inlineContent)return A.near(i);let s=t.resolve(e.map(this.anchor));return new n(s.parent.inlineContent?s:i,i)}replace(t,e=b.empty){if(super.replace(t,e),e==b.empty){let i=this.$from.marksAcross(this.$to);i&&t.ensureMarks(i)}}eq(t){return t instanceof n&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new Ne(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new n(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,i=e){let s=t.resolve(e);return new this(s,i==e?s:t.resolve(i))}static between(t,e,i){let s=t.pos-e.pos;if((!i||s)&&(i=s>=0?1:-1),!e.parent.inlineContent){let r=A.findFrom(e,i,!0)||A.findFrom(e,-i,!0);if(r)e=r.$head;else return A.near(e,i)}return t.parent.inlineContent||(s==0?t=e:(t=(A.findFrom(t,-i,!0)||A.findFrom(t,i,!0)).$anchor,t.pos<e.pos!=s<0&&(t=e))),new n(t,e)}};A.jsonID("text",I);var Ne=class n{constructor(t,e){this.anchor=t,this.head=e}map(t){return new n(t.map(this.anchor),t.map(this.head))}resolve(t){return I.between(t.resolve(this.anchor),t.resolve(this.head))}},P=class n extends A{constructor(t){let e=t.nodeAfter,i=t.node(0).resolve(t.pos+e.nodeSize);super(t,i),this.node=e}map(t,e){let{deleted:i,pos:s}=e.mapResult(this.anchor),r=t.resolve(s);return i?A.near(r):new n(r)}content(){return new b(w.from(this.node),0,0)}eq(t){return t instanceof n&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new En(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new n(t.resolve(e.anchor))}static create(t,e){return new n(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}};P.prototype.visible=!1;A.jsonID("node",P);var En=class n{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:i}=t.mapResult(this.anchor);return e?new Ne(i,i):new n(i)}resolve(t){let e=t.resolve(this.anchor),i=e.nodeAfter;return i&&P.isSelectable(i)?new P(e):A.near(e)}},ot=class n extends A{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=b.empty){if(e==b.empty){t.delete(0,t.doc.content.size);let i=A.atStart(t.doc);i.eq(t.selection)||t.setSelection(i)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new n(t)}map(t){return new n(t)}eq(t){return t instanceof n}getBookmark(){return sa}};A.jsonID("all",ot);var sa={map(){return this},resolve(n){return new ot(n)}};function Vt(n,t,e,i,s,r=!1){if(t.inlineContent)return I.create(n,e);for(let o=i-(s>0?0:1);s>0?o<t.childCount:o>=0;o+=s){let a=t.child(o);if(a.isAtom){if(!r&&P.isSelectable(a))return P.create(n,e-(s<0?a.nodeSize:0))}else{let l=Vt(n,a,e+s,s<0?a.childCount:0,s,r);if(l)return l}e+=a.nodeSize*s}return null}function ps(n,t,e){let i=n.steps.length-1;if(i<t)return;let s=n.steps[i];if(!(s instanceof tt||s instanceof j))return;let r=n.mapping.maps[i],o;r.forEach((a,l,u,c)=>{o==null&&(o=c)}),n.setSelection(A.near(n.doc.resolve(o),e))}function ds(n,t){return!t||!n?n:n.bind(t)}var Jt=class{constructor(t,e,i){this.name=t,this.init=ds(e.init,i),this.apply=ds(e.apply,i)}},Jc=[new Jt("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new Jt("selection",{init(n,t){return n.selection||A.atStart(t.doc)},apply(n){return n.selection}}),new Jt("storedMarks",{init(n){return n.storedMarks||null},apply(n,t,e,i){return i.selection.$cursor?n.storedMarks:null}}),new Jt("scrollToSelection",{init(){return 0},apply(n,t){return n.scrolledIntoView?t+1:t}})];function _s(n,t,e){for(let i in n){let s=n[i];s instanceof Function?s=s.bind(t):i=="handleDOMEvents"&&(s=_s(s,t,{})),e[i]=s}return e}var B=class{constructor(t){this.spec=t,this.props={},t.props&&_s(t.props,this,this.props),this.key=t.key?t.key.key:ms("plugin")}getState(t){return t[this.key]}},Sn=Object.create(null);function ms(n){return n in Sn?n+"$"+ ++Sn[n]:(Sn[n]=0,n+"$")}var K=class{constructor(t="key"){this.key=ms(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}};var Ie=(n,t)=>n.selection.empty?!1:(t&&t(n.tr.deleteSelection().scrollIntoView()),!0);function ys(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("backward",n):e.parentOffset>0)?null:e}var Mn=(n,t,e)=>{let i=ys(n,e);if(!i)return!1;let s=An(i);if(!s){let o=i.blockRange(),a=o&&yt(o);return a==null?!1:(t&&t(n.tr.lift(o,a).scrollIntoView()),!0)}let r=s.nodeBefore;if(Ms(n,s,t,-1))return!0;if(i.parent.content.size==0&&(qt(r,"end")||P.isSelectable(r)))for(let o=i.depth;;o--){let a=oe(n.doc,i.before(o),i.after(o),b.empty);if(a&&a.slice.size<a.to-a.from){if(t){let l=n.tr.step(a);l.setSelection(qt(r,"end")?A.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):P.create(l.doc,s.pos-r.nodeSize)),t(l.scrollIntoView())}return!0}if(o==1||i.node(o-1).childCount>1)break}return r.isAtom&&s.depth==i.depth-1?(t&&t(n.tr.delete(s.pos-r.nodeSize,s.pos).scrollIntoView()),!0):!1},ws=(n,t,e)=>{let i=ys(n,e);if(!i)return!1;let s=An(i);return s?vs(n,s,t):!1},bs=(n,t,e)=>{let i=xs(n,e);if(!i)return!1;let s=Nn(i);return s?vs(n,s,t):!1};function vs(n,t,e){let i=t.nodeBefore,s=i,r=t.pos-1;for(;!s.isTextblock;r--){if(s.type.spec.isolating)return!1;let c=s.lastChild;if(!c)return!1;s=c}let o=t.nodeAfter,a=o,l=t.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let c=a.firstChild;if(!c)return!1;a=c}let u=oe(n.doc,r,l,b.empty);if(!u||u.from!=r||u instanceof tt&&u.slice.size>=l-r)return!1;if(e){let c=n.tr.step(u);c.setSelection(I.create(c.doc,r)),e(c.scrollIntoView())}return!0}function qt(n,t,e=!1){for(let i=n;i;i=t=="start"?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(e&&i.childCount!=1)return!1}return!1}var On=(n,t,e)=>{let{$head:i,empty:s}=n.selection,r=i;if(!s)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("backward",n):i.parentOffset>0)return!1;r=An(i)}let o=r&&r.nodeBefore;return!o||!P.isSelectable(o)?!1:(t&&t(n.tr.setSelection(P.create(n.doc,r.pos-o.nodeSize)).scrollIntoView()),!0)};function An(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){if(n.index(t)>0)return n.doc.resolve(n.before(t+1));if(n.node(t).type.spec.isolating)break}return null}function xs(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("forward",n):e.parentOffset<e.parent.content.size)?null:e}var Cn=(n,t,e)=>{let i=xs(n,e);if(!i)return!1;let s=Nn(i);if(!s)return!1;let r=s.nodeAfter;if(Ms(n,s,t,1))return!0;if(i.parent.content.size==0&&(qt(r,"start")||P.isSelectable(r))){let o=oe(n.doc,i.before(),i.after(),b.empty);if(o&&o.slice.size<o.to-o.from){if(t){let a=n.tr.step(o);a.setSelection(qt(r,"start")?A.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):P.create(a.doc,a.mapping.map(s.pos))),t(a.scrollIntoView())}return!0}}return r.isAtom&&s.depth==i.depth-1?(t&&t(n.tr.delete(s.pos,s.pos+r.nodeSize).scrollIntoView()),!0):!1},Rn=(n,t,e)=>{let{$head:i,empty:s}=n.selection,r=i;if(!s)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("forward",n):i.parentOffset<i.parent.content.size)return!1;r=Nn(i)}let o=r&&r.nodeAfter;return!o||!P.isSelectable(o)?!1:(t&&t(n.tr.setSelection(P.create(n.doc,r.pos)).scrollIntoView()),!0)};function Nn(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){let e=n.node(t);if(n.index(t)+1<e.childCount)return n.doc.resolve(n.after(t+1));if(e.type.spec.isolating)break}return null}var ks=(n,t)=>{let e=n.selection,i=e instanceof P,s;if(i){if(e.node.isTextblock||!ht(n.doc,e.from))return!1;s=e.from}else if(s=zt(n.doc,e.from,-1),s==null)return!1;if(t){let r=n.tr.join(s);i&&r.setSelection(P.create(r.doc,s-n.doc.resolve(s).nodeBefore.nodeSize)),t(r.scrollIntoView())}return!0},Ss=(n,t)=>{let e=n.selection,i;if(e instanceof P){if(e.node.isTextblock||!ht(n.doc,e.to))return!1;i=e.to}else if(i=zt(n.doc,e.to,1),i==null)return!1;return t&&t(n.tr.join(i).scrollIntoView()),!0},Es=(n,t)=>{let{$from:e,$to:i}=n.selection,s=e.blockRange(i),r=s&&yt(s);return r==null?!1:(t&&t(n.tr.lift(s,r).scrollIntoView()),!0)},In=(n,t)=>{let{$head:e,$anchor:i}=n.selection;return!e.parent.type.spec.code||!e.sameParent(i)?!1:(t&&t(n.tr.insertText(`
`).scrollIntoView()),!0)};function Pn(n){for(let t=0;t<n.edgeCount;t++){let{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}var zn=(n,t)=>{let{$head:e,$anchor:i}=n.selection;if(!e.parent.type.spec.code||!e.sameParent(i))return!1;let s=e.node(-1),r=e.indexAfter(-1),o=Pn(s.contentMatchAt(r));if(!o||!s.canReplaceWith(r,r,o))return!1;if(t){let a=e.after(),l=n.tr.replaceWith(a,a,o.createAndFill());l.setSelection(A.near(l.doc.resolve(a),1)),t(l.scrollIntoView())}return!0},Ln=(n,t)=>{let e=n.selection,{$from:i,$to:s}=e;if(e instanceof ot||i.parent.inlineContent||s.parent.inlineContent)return!1;let r=Pn(s.parent.contentMatchAt(s.indexAfter()));if(!r||!r.isTextblock)return!1;if(t){let o=(!i.parentOffset&&s.index()<s.parent.childCount?i:s).pos,a=n.tr.insert(o,r.createAndFill());a.setSelection(I.create(a.doc,o+1)),t(a.scrollIntoView())}return!0},Dn=(n,t)=>{let{$cursor:e}=n.selection;if(!e||e.parent.content.size)return!1;if(e.depth>1&&e.after()!=e.end(-1)){let r=e.before();if(rt(n.doc,r))return t&&t(n.tr.split(r).scrollIntoView()),!0}let i=e.blockRange(),s=i&&yt(i);return s==null?!1:(t&&t(n.tr.lift(i,s).scrollIntoView()),!0)};function ra(n){return(t,e)=>{let{$from:i,$to:s}=t.selection;if(t.selection instanceof P&&t.selection.node.isBlock)return!i.parentOffset||!rt(t.doc,i.pos)?!1:(e&&e(t.tr.split(i.pos).scrollIntoView()),!0);if(!i.depth)return!1;let r=[],o,a,l=!1,u=!1;for(let p=i.depth;;p--)if(i.node(p).isBlock){l=i.end(p)==i.pos+(i.depth-p),u=i.start(p)==i.pos-(i.depth-p),a=Pn(i.node(p-1).contentMatchAt(i.indexAfter(p-1)));let _=n&&n(s.parent,l,i);r.unshift(_||(l&&a?{type:a}:null)),o=p;break}else{if(p==1)return!1;r.unshift(null)}let c=t.tr;(t.selection instanceof I||t.selection instanceof ot)&&c.deleteSelection();let h=c.mapping.map(i.pos),f=rt(c.doc,h,r.length,r);if(f||(r[0]=a?{type:a}:null,f=rt(c.doc,h,r.length,r)),!f)return!1;if(c.split(h,r.length,r),!l&&u&&i.node(o).type!=a){let p=c.mapping.map(i.before(o)),d=c.doc.resolve(p);a&&i.node(o-1).canReplaceWith(d.index(),d.index()+1,a)&&c.setNodeMarkup(c.mapping.map(i.before(o)),a)}return e&&e(c.scrollIntoView()),!0}}var oa=ra();var Ts=(n,t)=>{let{$from:e,to:i}=n.selection,s,r=e.sharedDepth(i);return r==0?!1:(s=e.before(r),t&&t(n.tr.setSelection(P.create(n.doc,s))),!0)},aa=(n,t)=>(t&&t(n.tr.setSelection(new ot(n.doc))),!0);function la(n,t,e){let i=t.nodeBefore,s=t.nodeAfter,r=t.index();return!i||!s||!i.type.compatibleContent(s.type)?!1:!i.content.size&&t.parent.canReplace(r-1,r)?(e&&e(n.tr.delete(t.pos-i.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(r,r+1)||!(s.isTextblock||ht(n.doc,t.pos))?!1:(e&&e(n.tr.join(t.pos).scrollIntoView()),!0)}function Ms(n,t,e,i){let s=t.nodeBefore,r=t.nodeAfter,o,a,l=s.type.spec.isolating||r.type.spec.isolating;if(!l&&la(n,t,e))return!0;let u=!l&&t.parent.canReplace(t.index(),t.index()+1);if(u&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(r.type))&&a.matchType(o[0]||r.type).validEnd){if(e){let p=t.pos+r.nodeSize,d=w.empty;for(let y=o.length-1;y>=0;y--)d=w.from(o[y].create(null,d));d=w.from(s.copy(d));let _=n.tr.step(new j(t.pos-1,p,t.pos,p,new b(d,1,0),o.length,!0)),m=_.doc.resolve(p+2*o.length);m.nodeAfter&&m.nodeAfter.type==s.type&&ht(_.doc,m.pos)&&_.join(m.pos),e(_.scrollIntoView())}return!0}let c=r.type.spec.isolating||i>0&&l?null:A.findFrom(t,1),h=c&&c.$from.blockRange(c.$to),f=h&&yt(h);if(f!=null&&f>=t.depth)return e&&e(n.tr.lift(h,f).scrollIntoView()),!0;if(u&&qt(r,"start",!0)&&qt(s,"end")){let p=s,d=[];for(;d.push(p),!p.isTextblock;)p=p.lastChild;let _=r,m=1;for(;!_.isTextblock;_=_.firstChild)m++;if(p.canReplace(p.childCount,p.childCount,_.content)){if(e){let y=w.empty;for(let E=d.length-1;E>=0;E--)y=w.from(d[E].copy(y));let x=n.tr.step(new j(t.pos-d.length,t.pos+r.nodeSize,t.pos+m,t.pos+r.nodeSize-m,new b(y,d.length,0),0,!0));e(x.scrollIntoView())}return!0}}return!1}function Os(n){return function(t,e){let i=t.selection,s=n<0?i.$from:i.$to,r=s.depth;for(;s.node(r).isInline;){if(!r)return!1;r--}return s.node(r).isTextblock?(e&&e(t.tr.setSelection(I.create(t.doc,n<0?s.start(r):s.end(r)))),!0):!1}}var Bn=Os(-1),Fn=Os(1);function As(n,t=null){return function(e,i){let{$from:s,$to:r}=e.selection,o=s.blockRange(r),a=o&&re(o,n,t);return a?(i&&i(e.tr.wrap(o,a).scrollIntoView()),!0):!1}}function Wn(n,t=null){return function(e,i){let s=!1;for(let r=0;r<e.selection.ranges.length&&!s;r++){let{$from:{pos:o},$to:{pos:a}}=e.selection.ranges[r];e.doc.nodesBetween(o,a,(l,u)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(n,t)))if(l.type==n)s=!0;else{let c=e.doc.resolve(u),h=c.index();s=c.parent.canReplaceWith(h,h+1,n)}})}if(!s)return!1;if(i){let r=e.tr;for(let o=0;o<e.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=e.selection.ranges[o];r.setBlockType(a,l,n,t)}i(r.scrollIntoView())}return!0}}function $n(...n){return function(t,e,i){for(let s=0;s<n.length;s++)if(n[s](t,e,i))return!0;return!1}}var Tn=$n(Ie,Mn,On),gs=$n(Ie,Cn,Rn),St={Enter:$n(In,Ln,Dn,oa),"Mod-Enter":zn,Backspace:Tn,"Mod-Backspace":Tn,"Shift-Backspace":Tn,Delete:gs,"Mod-Delete":gs,"Mod-a":aa},ua={"Ctrl-h":St.Backspace,"Alt-Backspace":St["Mod-Backspace"],"Ctrl-d":St.Delete,"Ctrl-Alt-Backspace":St["Mod-Delete"],"Alt-Delete":St["Mod-Delete"],"Alt-d":St["Mod-Delete"],"Ctrl-a":Bn,"Ctrl-e":Fn};for(let n in St)ua[n]=St[n];var Qc=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1;function Cs(n,t=null){return function(e,i){let{$from:s,$to:r}=e.selection,o=s.blockRange(r);if(!o)return!1;let a=i?e.tr:null;return ca(a,o,n,t)?(i&&i(a.scrollIntoView()),!0):!1}}function ca(n,t,e,i=null){let s=!1,r=t,o=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(e)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let l=o.resolve(t.start-2);r=new Nt(l,l,t.depth),t.endIndex<t.parent.childCount&&(t=new Nt(t.$from,o.resolve(t.$to.end(t.depth)),t.depth)),s=!0}let a=re(r,e,i,t);return a?(n&&ha(n,t,a,s,e),!0):!1}function ha(n,t,e,i,s){let r=w.empty;for(let c=e.length-1;c>=0;c--)r=w.from(e[c].type.create(e[c].attrs,r));n.step(new j(t.start-(i?2:0),t.end,t.start,t.end,new b(r,0,0),e.length,!0));let o=0;for(let c=0;c<e.length;c++)e[c].type==s&&(o=c+1);let a=e.length-o,l=t.start+e.length-(i?2:0),u=t.parent;for(let c=t.startIndex,h=t.endIndex,f=!0;c<h;c++,f=!1)!f&&rt(n.doc,l,a)&&(n.split(l,a),l+=2*a),l+=u.child(c).nodeSize;return n}function Rs(n){return function(t,e){let{$from:i,$to:s}=t.selection,r=i.blockRange(s,o=>o.childCount>0&&o.firstChild.type==n);return r?e?i.node(r.depth-1).type==n?fa(t,e,n,r):pa(t,e,r):!0:!1}}function fa(n,t,e,i){let s=n.tr,r=i.end,o=i.$to.end(i.depth);r<o&&(s.step(new j(r-1,o,r,o,new b(w.from(e.create(null,i.parent.copy())),1,0),1,!0)),i=new Nt(s.doc.resolve(i.$from.pos),s.doc.resolve(o),i.depth));let a=yt(i);if(a==null)return!1;s.lift(i,a);let l=s.doc.resolve(s.mapping.map(r,-1)-1);return ht(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),t(s.scrollIntoView()),!0}function pa(n,t,e){let i=n.tr,s=e.parent;for(let p=e.end,d=e.endIndex-1,_=e.startIndex;d>_;d--)p-=s.child(d).nodeSize,i.delete(p-1,p+1);let r=i.doc.resolve(e.start),o=r.nodeAfter;if(i.mapping.map(e.end)!=e.start+r.nodeAfter.nodeSize)return!1;let a=e.startIndex==0,l=e.endIndex==s.childCount,u=r.node(-1),c=r.index(-1);if(!u.canReplace(c+(a?0:1),c+1,o.content.append(l?w.empty:w.from(s))))return!1;let h=r.pos,f=h+o.nodeSize;return i.step(new j(h-(a?1:0),f+(l?1:0),h+1,f-1,new b((a?w.empty:w.from(s.copy(w.empty))).append(l?w.empty:w.from(s.copy(w.empty))),a?0:1,l?0:1),a?0:1)),t(i.scrollIntoView()),!0}function Ns(n){return function(t,e){let{$from:i,$to:s}=t.selection,r=i.blockRange(s,u=>u.childCount>0&&u.firstChild.type==n);if(!r)return!1;let o=r.startIndex;if(o==0)return!1;let a=r.parent,l=a.child(o-1);if(l.type!=n)return!1;if(e){let u=l.lastChild&&l.lastChild.type==a.type,c=w.from(u?n.create():null),h=new b(w.from(n.create(null,w.from(a.type.create(null,c)))),u?3:1,0),f=r.start,p=r.end;e(t.tr.step(new j(f-(u?3:1),p,f,p,h,1,!0)).scrollIntoView())}return!0}}var wt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ze={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},da=typeof navigator<"u"&&/Mac/.test(navigator.platform),_a=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(U=0;U<10;U++)wt[48+U]=wt[96+U]=String(U);var U;for(U=1;U<=24;U++)wt[U+111]="F"+U;var U;for(U=65;U<=90;U++)wt[U]=String.fromCharCode(U+32),ze[U]=String.fromCharCode(U);var U;for(Pe in wt)ze.hasOwnProperty(Pe)||(ze[Pe]=wt[Pe]);var Pe;function Is(n){var t=da&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||_a&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",e=!t&&n.key||(n.shiftKey?ze:wt)[n.keyCode]||n.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}var ma=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),ga=typeof navigator<"u"&&/Win/.test(navigator.platform);function ya(n){let t=n.split(/-(?!$)/),e=t[t.length-1];e=="Space"&&(e=" ");let i,s,r,o;for(let a=0;a<t.length-1;a++){let l=t[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))i=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))ma?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return i&&(e="Alt-"+e),s&&(e="Ctrl-"+e),o&&(e="Meta-"+e),r&&(e="Shift-"+e),e}function wa(n){let t=Object.create(null);for(let e in n)t[ya(e)]=n[e];return t}function jn(n,t,e=!0){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),e&&t.shiftKey&&(n="Shift-"+n),n}function Ps(n){return new B({props:{handleKeyDown:ba(n)}})}function ba(n){let t=wa(n);return function(e,i){let s=Is(i),r,o=t[jn(s,i)];if(o&&o(e.state,e.dispatch,e))return!0;if(s.length==1&&s!=" "){if(i.shiftKey){let a=t[jn(s,i,!1)];if(a&&a(e.state,e.dispatch,e))return!0}if((i.altKey||i.metaKey||i.ctrlKey)&&!(ga&&i.ctrlKey&&i.altKey)&&(r=wt[i.keyCode])&&r!=s){let a=t[jn(r,i)];if(a&&a(e.state,e.dispatch,e))return!0}}return!1}}var va=Object.defineProperty,Vn=(n,t)=>{for(var e in t)va(n,e,{get:t[e],enumerable:!0})};function Je(n){let{state:t,transaction:e}=n,{selection:i}=e,{doc:s}=e,{storedMarks:r}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return r},get selection(){return i},get doc(){return s},get tr(){return i=e.selection,s=e.doc,r=e.storedMarks,e}}}var Jn=class{constructor(n){this.editor=n.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=n.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:n,editor:t,state:e}=this,{view:i}=t,{tr:s}=e,r=this.buildProps(s);return Object.fromEntries(Object.entries(n).map(([o,a])=>[o,(...u)=>{let c=a(...u)(r);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(n,t=!0){let{rawCommands:e,editor:i,state:s}=this,{view:r}=i,o=[],a=!!n,l=n||s.tr,u=()=>(!a&&t&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(l),o.every(h=>h===!0)),c={...Object.fromEntries(Object.entries(e).map(([h,f])=>[h,(...d)=>{let _=this.buildProps(l,t),m=f(...d)(_);return o.push(m),c}])),run:u};return c}createCan(n){let{rawCommands:t,state:e}=this,i=!1,s=n||e.tr,r=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([a,l])=>[a,(...u)=>l(...u)({...r,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(n,t=!0){let{rawCommands:e,editor:i,state:s}=this,{view:r}=i,o={tr:n,editor:i,view:r,state:Je({state:s,transaction:n}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(n,t),can:()=>this.createCan(n),get commands(){return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>l(...u)(o)]))}};return o}},Us={};Vn(Us,{blur:()=>xa,clearContent:()=>ka,clearNodes:()=>Sa,command:()=>Ea,createParagraphNear:()=>Ta,cut:()=>Ma,deleteCurrentNode:()=>Oa,deleteNode:()=>Aa,deleteRange:()=>Ca,deleteSelection:()=>Ra,enter:()=>Na,exitCode:()=>Ia,extendMarkRange:()=>Pa,first:()=>za,focus:()=>Ba,forEach:()=>Fa,insertContent:()=>Wa,insertContentAt:()=>Ka,joinBackward:()=>Ja,joinDown:()=>Va,joinForward:()=>qa,joinItemBackward:()=>Ha,joinItemForward:()=>Xa,joinTextblockBackward:()=>Ga,joinTextblockForward:()=>Qa,joinUp:()=>Ua,keyboardShortcut:()=>Za,lift:()=>tl,liftEmptyBlock:()=>el,liftListItem:()=>nl,newlineInCode:()=>il,resetAttributes:()=>sl,scrollIntoView:()=>rl,selectAll:()=>ol,selectNodeBackward:()=>al,selectNodeForward:()=>ll,selectParentNode:()=>ul,selectTextblockEnd:()=>cl,selectTextblockStart:()=>hl,setContent:()=>pl,setMark:()=>Nl,setMeta:()=>Il,setNode:()=>Pl,setNodeSelection:()=>zl,setTextDirection:()=>Ll,setTextSelection:()=>Dl,sinkListItem:()=>Bl,splitBlock:()=>Fl,splitListItem:()=>Wl,toggleList:()=>$l,toggleMark:()=>jl,toggleNode:()=>Kl,toggleWrap:()=>Ul,undoInputRule:()=>Vl,unsetAllMarks:()=>Jl,unsetMark:()=>ql,unsetTextDirection:()=>Hl,updateAttributes:()=>Xl,wrapIn:()=>Gl,wrapInList:()=>Ql});var xa=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window?.getSelection())==null||e.removeAllRanges())}),!0),ka=(n=!0)=>({commands:t})=>t.setContent("",{emitUpdate:n}),Sa=()=>({state:n,tr:t,dispatch:e})=>{let{selection:i}=t,{ranges:s}=i;return e&&s.forEach(({$from:r,$to:o})=>{n.doc.nodesBetween(r.pos,o.pos,(a,l)=>{if(a.type.isText)return;let{doc:u,mapping:c}=t,h=u.resolve(c.map(l)),f=u.resolve(c.map(l+a.nodeSize)),p=h.blockRange(f);if(!p)return;let d=yt(p);if(a.type.isTextblock){let{defaultType:_}=h.parent.contentMatchAt(h.index());t.setNodeMarkup(p.start,_)}(d||d===0)&&t.lift(p,d)})}),!0},Ea=n=>t=>n(t),Ta=()=>({state:n,dispatch:t})=>Ln(n,t),Ma=(n,t)=>({editor:e,tr:i})=>{let{state:s}=e,r=s.doc.slice(n.from,n.to);i.deleteRange(n.from,n.to);let o=i.mapping.map(t);return i.insert(o,r.content),i.setSelection(new I(i.doc.resolve(Math.max(o-1,0)))),!0},Oa=()=>({tr:n,dispatch:t})=>{let{selection:e}=n,i=e.$anchor.node();if(i.content.size>0)return!1;let s=n.selection.$anchor;for(let r=s.depth;r>0;r-=1)if(s.node(r).type===i.type){if(t){let a=s.before(r),l=s.after(r);n.delete(a,l).scrollIntoView()}return!0}return!1};function Q(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}var Aa=n=>({tr:t,state:e,dispatch:i})=>{let s=Q(n,e.schema),r=t.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===s){if(i){let l=r.before(o),u=r.after(o);t.delete(l,u).scrollIntoView()}return!0}return!1},Ca=n=>({tr:t,dispatch:e})=>{let{from:i,to:s}=n;return e&&t.delete(i,s),!0},Ra=()=>({state:n,dispatch:t})=>Ie(n,t),Na=()=>({commands:n})=>n.keyboardShortcut("Enter"),Ia=()=>({state:n,dispatch:t})=>zn(n,t);function qn(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function je(n,t,e={strict:!0}){let i=Object.keys(t);return i.length?i.every(s=>e.strict?t[s]===n[s]:qn(t[s])?t[s].test(n[s]):t[s]===n[s]):!0}function Vs(n,t,e={}){return n.find(i=>i.type===t&&je(Object.fromEntries(Object.keys(e).map(s=>[s,i.attrs[s]])),e))}function zs(n,t,e={}){return!!Vs(n,t,e)}function Js(n,t,e){var i;if(!n||!t)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(c=>c.type===t))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(c=>c.type===t)||(e=e||((i=s.node.marks[0])==null?void 0:i.attrs),!Vs([...s.node.marks],t,e)))return;let o=s.index,a=n.start()+s.offset,l=o+1,u=a+s.node.nodeSize;for(;o>0&&zs([...n.parent.child(o-1).marks],t,e);)o-=1,a-=n.parent.child(o).nodeSize;for(;l<n.parent.childCount&&zs([...n.parent.child(l).marks],t,e);)u+=n.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function bt(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}var Pa=(n,t={})=>({tr:e,state:i,dispatch:s})=>{let r=bt(n,i.schema),{doc:o,selection:a}=e,{$from:l,from:u,to:c}=a;if(s){let h=Js(l,r,t);if(h&&h.from<=u&&h.to>=c){let f=I.create(o,h.from,h.to);e.setSelection(f)}}return!0},za=n=>t=>{let e=typeof n=="function"?n(t):n;for(let i=0;i<e.length;i+=1)if(e[i](t))return!0;return!1};function qs(n){return n instanceof I}function Lt(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function La(n,t=null){if(!t)return null;let e=A.atStart(n),i=A.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return i;let s=e.from,r=i.to;return t==="all"?I.create(n,Lt(0,s,r),Lt(n.content.size,s,r)):I.create(n,Lt(t,s,r),Lt(t,s,r))}function Ls(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ke(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function Da(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var Ba=(n=null,t={})=>({editor:e,view:i,tr:s,dispatch:r})=>{t={scrollIntoView:!0,...t};let o=()=>{(Ke()||Ls())&&i.dom.focus(),Da()&&!Ke()&&!Ls()&&i.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{e.isDestroyed||(i.focus(),t?.scrollIntoView&&e.commands.scrollIntoView())})};try{if(i.hasFocus()&&n===null||n===!1)return!0}catch{return!1}if(r&&n===null&&!qs(e.state.selection))return o(),!0;let a=La(s.doc,n)||e.state.selection,l=e.state.selection.eq(a);return r&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},Fa=(n,t)=>e=>n.every((i,s)=>t(i,{...e,index:s})),Wa=(n,t)=>({tr:e,commands:i})=>i.insertContentAt({from:e.selection.from,to:e.selection.to},n,t),Hs=n=>{let t=n.childNodes;for(let e=t.length-1;e>=0;e-=1){let i=t[e];i.nodeType===3&&i.nodeValue&&/^(\n\s\s|\n)$/.test(i.nodeValue)?n.removeChild(i):i.nodeType===1&&Hs(i)}return n};function Le(n){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");let t=`<body>${n}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return Hs(e)}function ae(n,t,e){if(n instanceof st||n instanceof w)return n;e={slice:!0,parseOptions:{},...e};let i=typeof n=="object"&&n!==null,s=typeof n=="string";if(i)try{if(Array.isArray(n)&&n.length>0)return w.fromArray(n.map(a=>t.nodeFromJSON(a)));let o=t.nodeFromJSON(n);return e.errorOnInvalidContent&&o.check(),o}catch(r){if(e.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",r),ae("",t,e)}if(s){if(e.errorOnInvalidContent){let o=!1,a="",l=new jt({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(e.slice?Pt.fromSchema(l).parseSlice(Le(n),e.parseOptions):Pt.fromSchema(l).parse(Le(n),e.parseOptions),e.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}let r=Pt.fromSchema(t);return e.slice?r.parseSlice(Le(n),e.parseOptions).content:r.parse(Le(n),e.parseOptions)}return ae("",t,e)}function $a(n,t,e){let i=n.steps.length-1;if(i<t)return;let s=n.steps[i];if(!(s instanceof tt||s instanceof j))return;let r=n.mapping.maps[i],o=0;r.forEach((a,l,u,c)=>{o===0&&(o=c)}),n.setSelection(A.near(n.doc.resolve(o),e))}var ja=n=>!("type"in n),Ka=(n,t,e)=>({tr:i,dispatch:s,editor:r})=>{var o;if(s){e={parseOptions:r.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};let a,l=m=>{r.emit("contentError",{editor:r,error:m,disableCollaboration:()=>{"collaboration"in r.storage&&typeof r.storage.collaboration=="object"&&r.storage.collaboration&&(r.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...e.parseOptions};if(!e.errorOnInvalidContent&&!r.options.enableContentCheck&&r.options.emitContentError)try{ae(t,r.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(m){l(m)}try{a=ae(t,r.schema,{parseOptions:u,errorOnInvalidContent:(o=e.errorOnInvalidContent)!=null?o:r.options.enableContentCheck})}catch(m){return l(m),!1}let{from:c,to:h}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},f=!0,p=!0;if((ja(a)?a:[a]).forEach(m=>{m.check(),f=f?m.isText&&m.marks.length===0:!1,p=p?m.isBlock:!1}),c===h&&p){let{parent:m}=i.doc.resolve(c);m.isTextblock&&!m.type.spec.code&&!m.childCount&&(c-=1,h+=1)}let _;if(f){if(Array.isArray(t))_=t.map(m=>m.text||"").join("");else if(t instanceof w){let m="";t.forEach(y=>{y.text&&(m+=y.text)}),_=m}else typeof t=="object"&&t&&t.text?_=t.text:_=t;i.insertText(_,c,h)}else{_=a;let m=i.doc.resolve(c),y=m.node(),x=m.parentOffset===0,E=y.isText||y.isTextblock,O=y.content.size>0;x&&E&&O&&(c=Math.max(0,c-1)),i.replaceWith(c,h,_)}e.updateSelection&&$a(i,i.steps.length-1,-1),e.applyInputRules&&i.setMeta("applyInputRules",{from:c,text:_}),e.applyPasteRules&&i.setMeta("applyPasteRules",{from:c,text:_})}return!0},Ua=()=>({state:n,dispatch:t})=>ks(n,t),Va=()=>({state:n,dispatch:t})=>Ss(n,t),Ja=()=>({state:n,dispatch:t})=>Mn(n,t),qa=()=>({state:n,dispatch:t})=>Cn(n,t),Ha=()=>({state:n,dispatch:t,tr:e})=>{try{let i=zt(n.doc,n.selection.$from.pos,-1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},Xa=()=>({state:n,dispatch:t,tr:e})=>{try{let i=zt(n.doc,n.selection.$from.pos,1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},Ga=()=>({state:n,dispatch:t})=>ws(n,t),Qa=()=>({state:n,dispatch:t})=>bs(n,t);function Xs(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Ya(n){let t=n.split(/-(?!$)/),e=t[t.length-1];e==="Space"&&(e=" ");let i,s,r,o;for(let a=0;a<t.length-1;a+=1){let l=t[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))i=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))Ke()||Xs()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return i&&(e=`Alt-${e}`),s&&(e=`Ctrl-${e}`),o&&(e=`Meta-${e}`),r&&(e=`Shift-${e}`),e}var Za=n=>({editor:t,view:e,tr:i,dispatch:s})=>{let r=Ya(n).split(/-(?!$)/),o=r.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:r.includes("Alt"),ctrlKey:r.includes("Ctrl"),metaKey:r.includes("Meta"),shiftKey:r.includes("Shift"),bubbles:!0,cancelable:!0}),l=t.captureTransaction(()=>{e.someProp("handleKeyDown",u=>u(e,a))});return l?.steps.forEach(u=>{let c=u.map(i.mapping);c&&s&&i.maybeStep(c)}),!0};function Hn(n,t,e={}){let{from:i,to:s,empty:r}=n.selection,o=t?Q(t,n.schema):null,a=[];n.doc.nodesBetween(i,s,(h,f)=>{if(h.isText)return;let p=Math.max(i,f),d=Math.min(s,f+h.nodeSize);a.push({node:h,from:p,to:d})});let l=s-i,u=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>je(h.node.attrs,e,{strict:!1}));return r?!!u.length:u.reduce((h,f)=>h+f.to-f.from,0)>=l}var tl=(n,t={})=>({state:e,dispatch:i})=>{let s=Q(n,e.schema);return Hn(e,s,t)?Es(e,i):!1},el=()=>({state:n,dispatch:t})=>Dn(n,t),nl=n=>({state:t,dispatch:e})=>{let i=Q(n,t.schema);return Rs(i)(t,e)},il=()=>({state:n,dispatch:t})=>In(n,t);function Gs(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function Ds(n,t){let e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((i,s)=>(e.includes(s)||(i[s]=n[s]),i),{})}var sl=(n,t)=>({tr:e,state:i,dispatch:s})=>{let r=null,o=null,a=Gs(typeof n=="string"?n:n.name,i.schema);if(!a)return!1;a==="node"&&(r=Q(n,i.schema)),a==="mark"&&(o=bt(n,i.schema));let l=!1;return e.selection.ranges.forEach(u=>{i.doc.nodesBetween(u.$from.pos,u.$to.pos,(c,h)=>{r&&r===c.type&&(l=!0,s&&e.setNodeMarkup(h,void 0,Ds(c.attrs,t))),o&&c.marks.length&&c.marks.forEach(f=>{o===f.type&&(l=!0,s&&e.addMark(h,h+c.nodeSize,o.create(Ds(f.attrs,t))))})})}),l},rl=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),ol=()=>({tr:n,dispatch:t})=>{if(t){let e=new ot(n.doc);n.setSelection(e)}return!0},al=()=>({state:n,dispatch:t})=>On(n,t),ll=()=>({state:n,dispatch:t})=>Rn(n,t),ul=()=>({state:n,dispatch:t})=>Ts(n,t),cl=()=>({state:n,dispatch:t})=>Fn(n,t),hl=()=>({state:n,dispatch:t})=>Bn(n,t);function fl(n,t,e={},i={}){return ae(n,t,{slice:!1,parseOptions:e,errorOnInvalidContent:i.errorOnInvalidContent})}var pl=(n,{errorOnInvalidContent:t,emitUpdate:e=!0,parseOptions:i={}}={})=>({editor:s,tr:r,dispatch:o,commands:a})=>{let{doc:l}=r;if(i.preserveWhitespace!=="full"){let u=fl(n,s.schema,i,{errorOnInvalidContent:t??s.options.enableContentCheck});return o&&r.replaceWith(0,l.content.size,u).setMeta("preventUpdate",!e),!0}return o&&r.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:l.content.size},n,{parseOptions:i,errorOnInvalidContent:t??s.options.enableContentCheck})};function dl(n,t){let e=bt(t,n.schema),{from:i,to:s,empty:r}=n.selection,o=[];r?(n.storedMarks&&o.push(...n.storedMarks),o.push(...n.selection.$head.marks())):n.doc.nodesBetween(i,s,l=>{o.push(...l.marks)});let a=o.find(l=>l.type.name===e.name);return a?{...a.attrs}:{}}function _l(n,t){let e=new se(n);return t.forEach(i=>{i.steps.forEach(s=>{e.step(s)})}),e}function ml(n){for(let t=0;t<n.edgeCount;t+=1){let{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function gl(n,t){for(let e=n.depth;e>0;e-=1){let i=n.node(e);if(t(i))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:i}}}function Xn(n){return t=>gl(t.$from,n)}function v(n,t,e){return n.config[t]===void 0&&n.parent?v(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?v(n.parent,t,e):null}):n.config[t]}function Gn(n){return n.map(t=>{let e={name:t.name,options:t.options,storage:t.storage},i=v(t,"addExtensions",e);return i?[t,...Gn(i())]:t}).flat(10)}function Qs(n,t){let e=Me.fromSchema(t).serializeFragment(n),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(e),s.innerHTML}function yl(n){return typeof n=="function"}function W(n,t=void 0,...e){return yl(n)?t?n.bind(t)(...e):n(...e):n}function wl(n={}){return Object.keys(n).length===0&&n.constructor===Object}function Ht(n){let t=n.filter(s=>s.type==="extension"),e=n.filter(s=>s.type==="node"),i=n.filter(s=>s.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:i}}function Ys(n){let t=[],{nodeExtensions:e,markExtensions:i}=Ht(n),s=[...e,...i],r={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(o=>{let a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=v(o,"addGlobalAttributes",a);if(!l)return;l().forEach(c=>{c.types.forEach(h=>{Object.entries(c.attributes).forEach(([f,p])=>{t.push({type:h,name:f,attribute:{...r,...p}})})})})}),s.forEach(o=>{let a={name:o.name,options:o.options,storage:o.storage},l=v(o,"addAttributes",a);if(!l)return;let u=l();Object.entries(u).forEach(([c,h])=>{let f={...r,...h};typeof f?.default=="function"&&(f.default=f.default()),f?.isRequired&&f?.default===void 0&&delete f.default,t.push({type:o.name,name:c,attribute:f})})}),t}function bl(...n){return n.filter(t=>!!t).reduce((t,e)=>{let i={...t};return Object.entries(e).forEach(([s,r])=>{if(!i[s]){i[s]=r;return}if(s==="class"){let a=r?String(r).split(" "):[],l=i[s]?i[s].split(" "):[],u=a.filter(c=>!l.includes(c));i[s]=[...l,...u].join(" ")}else if(s==="style"){let a=r?r.split(";").map(c=>c.trim()).filter(Boolean):[],l=i[s]?i[s].split(";").map(c=>c.trim()).filter(Boolean):[],u=new Map;l.forEach(c=>{let[h,f]=c.split(":").map(p=>p.trim());u.set(h,f)}),a.forEach(c=>{let[h,f]=c.split(":").map(p=>p.trim());u.set(h,f)}),i[s]=Array.from(u.entries()).map(([c,h])=>`${c}: ${h}`).join("; ")}else i[s]=r}),i},{})}function Ue(n,t){return t.filter(e=>e.type===n.type.name).filter(e=>e.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(n.attrs)||{}:{[e.name]:n.attrs[e.name]}).reduce((e,i)=>bl(e,i),{})}function vl(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function Bs(n,t){return"style"in n?n:{...n,getAttrs:e=>{let i=n.getAttrs?n.getAttrs(e):n.attrs;if(i===!1)return!1;let s=t.reduce((r,o)=>{let a=o.attribute.parseHTML?o.attribute.parseHTML(e):vl(e.getAttribute(o.name));return a==null?r:{...r,[o.name]:a}},{});return{...i,...s}}}}function Fs(n){return Object.fromEntries(Object.entries(n).filter(([t,e])=>t==="attrs"&&wl(e)?!1:e!=null))}function Ws(n){var t,e;let i={};return!((t=n?.attribute)!=null&&t.isRequired)&&"default"in(n?.attribute||{})&&(i.default=n.attribute.default),((e=n?.attribute)==null?void 0:e.validate)!==void 0&&(i.validate=n.attribute.validate),[n.name,i]}function xl(n,t){var e;let i=Ys(n),{nodeExtensions:s,markExtensions:r}=Ht(n),o=(e=s.find(u=>v(u,"topNode")))==null?void 0:e.name,a=Object.fromEntries(s.map(u=>{let c=i.filter(y=>y.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:t},f=n.reduce((y,x)=>{let E=v(x,"extendNodeSchema",h);return{...y,...E?E(u):{}}},{}),p=Fs({...f,content:W(v(u,"content",h)),marks:W(v(u,"marks",h)),group:W(v(u,"group",h)),inline:W(v(u,"inline",h)),atom:W(v(u,"atom",h)),selectable:W(v(u,"selectable",h)),draggable:W(v(u,"draggable",h)),code:W(v(u,"code",h)),whitespace:W(v(u,"whitespace",h)),linebreakReplacement:W(v(u,"linebreakReplacement",h)),defining:W(v(u,"defining",h)),isolating:W(v(u,"isolating",h)),attrs:Object.fromEntries(c.map(Ws))}),d=W(v(u,"parseHTML",h));d&&(p.parseDOM=d.map(y=>Bs(y,c)));let _=v(u,"renderHTML",h);_&&(p.toDOM=y=>_({node:y,HTMLAttributes:Ue(y,c)}));let m=v(u,"renderText",h);return m&&(p.toText=m),[u.name,p]})),l=Object.fromEntries(r.map(u=>{let c=i.filter(m=>m.type===u.name),h={name:u.name,options:u.options,storage:u.storage,editor:t},f=n.reduce((m,y)=>{let x=v(y,"extendMarkSchema",h);return{...m,...x?x(u):{}}},{}),p=Fs({...f,inclusive:W(v(u,"inclusive",h)),excludes:W(v(u,"excludes",h)),group:W(v(u,"group",h)),spanning:W(v(u,"spanning",h)),code:W(v(u,"code",h)),attrs:Object.fromEntries(c.map(Ws))}),d=W(v(u,"parseHTML",h));d&&(p.parseDOM=d.map(m=>Bs(m,c)));let _=v(u,"renderHTML",h);return _&&(p.toDOM=m=>_({mark:m,HTMLAttributes:Ue(m,c)})),[u.name,p]}));return new jt({topNode:o,nodes:a,marks:l})}function kl(n){let t=n.filter((e,i)=>n.indexOf(e)!==i);return Array.from(new Set(t))}function Ve(n){return n.sort((e,i)=>{let s=v(e,"priority")||100,r=v(i,"priority")||100;return s>r?-1:s<r?1:0})}function Zs(n){let t=Ve(Gn(n)),e=kl(t.map(i=>i.name));return e.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${e.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),t}function Sl(n,t,e){let{from:i,to:s}=t,{blockSeparator:r=`

`,textSerializers:o={}}=e||{},a="";return n.nodesBetween(i,s,(l,u,c,h)=>{var f;l.isBlock&&u>i&&(a+=r);let p=o?.[l.type.name];if(p)return c&&(a+=p({node:l,pos:u,parent:c,index:h,range:t})),!1;l.isText&&(a+=(f=l?.text)==null?void 0:f.slice(Math.max(i,u)-u,s-u))}),a}function El(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}function Tl(n,t=JSON.stringify){let e={};return n.filter(i=>{let s=t(i);return Object.prototype.hasOwnProperty.call(e,s)?!1:e[s]=!0})}function Ml(n){let t=Tl(n);return t.length===1?t:t.filter((e,i)=>!t.filter((r,o)=>o!==i).some(r=>e.oldRange.from>=r.oldRange.from&&e.oldRange.to<=r.oldRange.to&&e.newRange.from>=r.newRange.from&&e.newRange.to<=r.newRange.to))}function Ol(n){let{mapping:t,steps:e}=n,i=[];return t.maps.forEach((s,r)=>{let o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{let{from:a,to:l}=e[r];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{let u=t.slice(r).map(a,-1),c=t.slice(r).map(l),h=t.invert().map(u,-1),f=t.invert().map(c);i.push({oldRange:{from:h,to:f},newRange:{from:u,to:c}})})}),Ml(i)}function De(n,t){return t.nodes[n]||t.marks[n]||null}function $e(n,t,e){return Object.fromEntries(Object.entries(e).filter(([i])=>{let s=n.find(r=>r.type===t&&r.name===i);return s?s.attribute.keepOnSplit:!1}))}var Al=(n,t=500)=>{let e="",i=n.parentOffset;return n.parent.nodesBetween(Math.max(0,i-t),i,(s,r,o,a)=>{var l,u;let c=((u=(l=s.type.spec).toText)==null?void 0:u.call(l,{node:s,pos:r,parent:o,index:a}))||s.textContent||"%leaf%";e+=s.isAtom&&!s.isText?c:c.slice(0,Math.max(0,i-r))}),e};function Cl(n,t,e={}){let{empty:i,ranges:s}=n.selection,r=t?bt(t,n.schema):null;if(i)return!!(n.storedMarks||n.selection.$from.marks()).filter(h=>r?r.name===h.type.name:!0).find(h=>je(h.attrs,e,{strict:!1}));let o=0,a=[];if(s.forEach(({$from:h,$to:f})=>{let p=h.pos,d=f.pos;n.doc.nodesBetween(p,d,(_,m)=>{if(!_.isText&&!_.marks.length)return;let y=Math.max(p,m),x=Math.min(d,m+_.nodeSize),E=x-y;o+=E,a.push(..._.marks.map(O=>({mark:O,from:y,to:x})))})}),o===0)return!1;let l=a.filter(h=>r?r.name===h.mark.type.name:!0).filter(h=>je(h.mark.attrs,e,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),u=a.filter(h=>r?h.mark.type!==r&&h.mark.type.excludes(r):!0).reduce((h,f)=>h+f.to-f.from,0);return(l>0?l+u:l)>=o}function $s(n,t){return Array.isArray(t)?t.some(e=>(typeof e=="string"?e:e.name)===n.name):t}function js(n,t){let{nodeExtensions:e}=Ht(t),i=e.find(o=>o.name===n);if(!i)return!1;let s={name:i.name,options:i.options,storage:i.storage},r=W(v(i,"group",s));return typeof r!="string"?!1:r.split(" ").includes("list")}function tr(n,{checkChildren:t=!0,ignoreWhitespace:e=!1}={}){var i;if(e){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((i=n.text)!=null?i:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(t){let s=!0;return n.content.forEach(r=>{s!==!1&&(tr(r,{ignoreWhitespace:e,checkChildren:t})||(s=!1))}),s}return!1}function Rl(n,t,e){var i;let{selection:s}=t,r=null;if(qs(s)&&(r=s.$cursor),r){let a=(i=n.storedMarks)!=null?i:r.marks();return r.parent.type.allowsMarkType(e)&&(!!e.isInSet(a)||!a.some(u=>u.type.excludes(e)))}let{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(a.pos,l.pos,(c,h,f)=>{if(u)return!1;if(c.isInline){let p=!f||f.type.allowsMarkType(e),d=!!e.isInSet(c.marks)||!c.marks.some(_=>_.type.excludes(e));u=p&&d}return!u}),u})}var Nl=(n,t={})=>({tr:e,state:i,dispatch:s})=>{let{selection:r}=e,{empty:o,ranges:a}=r,l=bt(n,i.schema);if(s)if(o){let u=dl(i,l);e.addStoredMark(l.create({...u,...t}))}else a.forEach(u=>{let c=u.$from.pos,h=u.$to.pos;i.doc.nodesBetween(c,h,(f,p)=>{let d=Math.max(p,c),_=Math.min(p+f.nodeSize,h);f.marks.find(y=>y.type===l)?f.marks.forEach(y=>{l===y.type&&e.addMark(d,_,l.create({...y.attrs,...t}))}):e.addMark(d,_,l.create(t))})});return Rl(i,e,l)},Il=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),Pl=(n,t={})=>({state:e,dispatch:i,chain:s})=>{let r=Q(n,e.schema),o;return e.selection.$anchor.sameParent(e.selection.$head)&&(o=e.selection.$anchor.parent.attrs),r.isTextblock?s().command(({commands:a})=>Wn(r,{...o,...t})(e)?!0:a.clearNodes()).command(({state:a})=>Wn(r,{...o,...t})(a,i)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},zl=n=>({tr:t,dispatch:e})=>{if(e){let{doc:i}=t,s=Lt(n,0,i.content.size),r=P.create(i,s);t.setSelection(r)}return!0},Ll=(n,t)=>({tr:e,state:i,dispatch:s})=>{let{selection:r}=i,o,a;return typeof t=="number"?(o=t,a=t):t&&"from"in t&&"to"in t?(o=t.from,a=t.to):(o=r.from,a=r.to),s&&e.doc.nodesBetween(o,a,(l,u)=>{l.isText||e.setNodeMarkup(u,void 0,{...l.attrs,dir:n})}),!0},Dl=n=>({tr:t,dispatch:e})=>{if(e){let{doc:i}=t,{from:s,to:r}=typeof n=="number"?{from:n,to:n}:n,o=I.atStart(i).from,a=I.atEnd(i).to,l=Lt(s,o,a),u=Lt(r,o,a),c=I.create(i,l,u);t.setSelection(c)}return!0},Bl=n=>({state:t,dispatch:e})=>{let i=Q(n,t.schema);return Ns(i)(t,e)};function Ks(n,t){let e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){let i=e.filter(s=>t?.includes(s.type.name));n.tr.ensureMarks(i)}}var Fl=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:i,editor:s})=>{let{selection:r,doc:o}=t,{$from:a,$to:l}=r,u=s.extensionManager.attributes,c=$e(u,a.node().type.name,a.node().attrs);if(r instanceof P&&r.node.isBlock)return!a.parentOffset||!rt(o,a.pos)?!1:(i&&(n&&Ks(e,s.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;let h=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:ml(a.node(-1).contentMatchAt(a.indexAfter(-1))),p=h&&f?[{type:f,attrs:c}]:void 0,d=rt(t.doc,t.mapping.map(a.pos),1,p);if(!p&&!d&&rt(t.doc,t.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(d=!0,p=f?[{type:f,attrs:c}]:void 0),i){if(d&&(r instanceof I&&t.deleteSelection(),t.split(t.mapping.map(a.pos),1,p),f&&!h&&!a.parentOffset&&a.parent.type!==f)){let _=t.mapping.map(a.before()),m=t.doc.resolve(_);a.node(-1).canReplaceWith(m.index(),m.index()+1,f)&&t.setNodeMarkup(t.mapping.map(a.before()),f)}n&&Ks(e,s.extensionManager.splittableMarks),t.scrollIntoView()}return d},Wl=(n,t={})=>({tr:e,state:i,dispatch:s,editor:r})=>{var o;let a=Q(n,i.schema),{$from:l,$to:u}=i.selection,c=i.selection.node;if(c&&c.isBlock||l.depth<2||!l.sameParent(u))return!1;let h=l.node(-1);if(h.type!==a)return!1;let f=r.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let y=w.empty,x=l.index(-1)?1:l.index(-2)?2:3;for(let et=l.depth-x;et>=l.depth-3;et-=1)y=w.from(l.node(et).copy(y));let E=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,O={...$e(f,l.node().type.name,l.node().attrs),...t},T=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(O))||void 0;y=y.append(w.from(a.createAndFill(null,T)||void 0));let L=l.before(l.depth-(x-1));e.replace(L,l.after(-E),new b(y,4-x,0));let $=-1;e.doc.nodesBetween(L,e.doc.content.size,(et,it)=>{if($>-1)return!1;et.isTextblock&&et.content.size===0&&($=it+1)}),$>-1&&e.setSelection(I.near(e.doc.resolve($))),e.scrollIntoView()}return!0}let p=u.pos===l.end()?h.contentMatchAt(0).defaultType:null,d={...$e(f,h.type.name,h.attrs),...t},_={...$e(f,l.node().type.name,l.node().attrs),...t};e.delete(l.pos,u.pos);let m=p?[{type:a,attrs:d},{type:p,attrs:_}]:[{type:a,attrs:d}];if(!rt(e.doc,l.pos,2))return!1;if(s){let{selection:y,storedMarks:x}=i,{splittableMarks:E}=r.extensionManager,O=x||y.$to.parentOffset&&y.$from.marks();if(e.split(l.pos,2,m).scrollIntoView(),!O||!s)return!0;let T=O.filter(L=>E.includes(L.type.name));e.ensureMarks(T)}return!0},Kn=(n,t)=>{let e=Xn(o=>o.type===t)(n.selection);if(!e)return!0;let i=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(i===void 0)return!0;let s=n.doc.nodeAt(i);return e.node.type===s?.type&&ht(n.doc,e.pos)&&n.join(e.pos),!0},Un=(n,t)=>{let e=Xn(o=>o.type===t)(n.selection);if(!e)return!0;let i=n.doc.resolve(e.start).after(e.depth);if(i===void 0)return!0;let s=n.doc.nodeAt(i);return e.node.type===s?.type&&ht(n.doc,i)&&n.join(i),!0},$l=(n,t,e,i={})=>({editor:s,tr:r,state:o,dispatch:a,chain:l,commands:u,can:c})=>{let{extensions:h,splittableMarks:f}=s.extensionManager,p=Q(n,o.schema),d=Q(t,o.schema),{selection:_,storedMarks:m}=o,{$from:y,$to:x}=_,E=y.blockRange(x),O=m||_.$to.parentOffset&&_.$from.marks();if(!E)return!1;let T=Xn(L=>js(L.type.name,h))(_);if(E.depth>=1&&T&&E.depth-T.depth<=1){if(T.node.type===p)return u.liftListItem(d);if(js(T.node.type.name,h)&&p.validContent(T.node.content)&&a)return l().command(()=>(r.setNodeMarkup(T.pos,p),!0)).command(()=>Kn(r,p)).command(()=>Un(r,p)).run()}return!e||!O||!a?l().command(()=>c().wrapInList(p,i)?!0:u.clearNodes()).wrapInList(p,i).command(()=>Kn(r,p)).command(()=>Un(r,p)).run():l().command(()=>{let L=c().wrapInList(p,i),$=O.filter(et=>f.includes(et.type.name));return r.ensureMarks($),L?!0:u.clearNodes()}).wrapInList(p,i).command(()=>Kn(r,p)).command(()=>Un(r,p)).run()},jl=(n,t={},e={})=>({state:i,commands:s})=>{let{extendEmptyMarkRange:r=!1}=e,o=bt(n,i.schema);return Cl(i,o,t)?s.unsetMark(o,{extendEmptyMarkRange:r}):s.setMark(o,t)},Kl=(n,t,e={})=>({state:i,commands:s})=>{let r=Q(n,i.schema),o=Q(t,i.schema),a=Hn(i,r,e),l;return i.selection.$anchor.sameParent(i.selection.$head)&&(l=i.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(r,{...l,...e})},Ul=(n,t={})=>({state:e,commands:i})=>{let s=Q(n,e.schema);return Hn(e,s,t)?i.lift(s):i.wrapIn(s,t)},Vl=()=>({state:n,dispatch:t})=>{let e=n.plugins;for(let i=0;i<e.length;i+=1){let s=e[i],r;if(s.spec.isInputRules&&(r=s.getState(n))){if(t){let o=n.tr,a=r.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(r.text){let l=o.doc.resolve(r.from).marks();o.replaceWith(r.from,r.to,n.schema.text(r.text,l))}else o.delete(r.from,r.to)}return!0}}return!1},Jl=()=>({tr:n,dispatch:t})=>{let{selection:e}=n,{empty:i,ranges:s}=e;return i||t&&s.forEach(r=>{n.removeMark(r.$from.pos,r.$to.pos)}),!0},ql=(n,t={})=>({tr:e,state:i,dispatch:s})=>{var r;let{extendEmptyMarkRange:o=!1}=t,{selection:a}=e,l=bt(n,i.schema),{$from:u,empty:c,ranges:h}=a;if(!s)return!0;if(c&&o){let{from:f,to:p}=a,d=(r=u.marks().find(m=>m.type===l))==null?void 0:r.attrs,_=Js(u,l,d);_&&(f=_.from,p=_.to),e.removeMark(f,p,l)}else h.forEach(f=>{e.removeMark(f.$from.pos,f.$to.pos,l)});return e.removeStoredMark(l),!0},Hl=n=>({tr:t,state:e,dispatch:i})=>{let{selection:s}=e,r,o;return typeof n=="number"?(r=n,o=n):n&&"from"in n&&"to"in n?(r=n.from,o=n.to):(r=s.from,o=s.to),i&&t.doc.nodesBetween(r,o,(a,l)=>{if(a.isText)return;let u={...a.attrs};delete u.dir,t.setNodeMarkup(l,void 0,u)}),!0},Xl=(n,t={})=>({tr:e,state:i,dispatch:s})=>{let r=null,o=null,a=Gs(typeof n=="string"?n:n.name,i.schema);if(!a)return!1;a==="node"&&(r=Q(n,i.schema)),a==="mark"&&(o=bt(n,i.schema));let l=!1;return e.selection.ranges.forEach(u=>{let c=u.$from.pos,h=u.$to.pos,f,p,d,_;e.selection.empty?i.doc.nodesBetween(c,h,(m,y)=>{r&&r===m.type&&(l=!0,d=Math.max(y,c),_=Math.min(y+m.nodeSize,h),f=y,p=m)}):i.doc.nodesBetween(c,h,(m,y)=>{y<c&&r&&r===m.type&&(l=!0,d=Math.max(y,c),_=Math.min(y+m.nodeSize,h),f=y,p=m),y>=c&&y<=h&&(r&&r===m.type&&(l=!0,s&&e.setNodeMarkup(y,void 0,{...m.attrs,...t})),o&&m.marks.length&&m.marks.forEach(x=>{if(o===x.type&&(l=!0,s)){let E=Math.max(y,c),O=Math.min(y+m.nodeSize,h);e.addMark(E,O,o.create({...x.attrs,...t}))}}))}),p&&(f!==void 0&&s&&e.setNodeMarkup(f,void 0,{...p.attrs,...t}),o&&p.marks.length&&p.marks.forEach(m=>{o===m.type&&s&&e.addMark(d,_,o.create({...m.attrs,...t}))}))}),l},Gl=(n,t={})=>({state:e,dispatch:i})=>{let s=Q(n,e.schema);return As(s,t)(e,i)},Ql=(n,t={})=>({state:e,dispatch:i})=>{let s=Q(n,e.schema);return Cs(s,t)(e,i)};var Yl=(n,t)=>{if(qn(t))return t.exec(n);let e=t(n);if(!e)return null;let i=[e.text];return i.index=e.index,i.input=n,i.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),i.push(e.replaceWith)),i};function Be(n){var t;let{editor:e,from:i,to:s,text:r,rules:o,plugin:a}=n,{view:l}=e;if(l.composing)return!1;let u=l.state.doc.resolve(i);if(u.parent.type.spec.code||(t=u.nodeBefore||u.nodeAfter)!=null&&t.marks.find(f=>f.type.spec.code))return!1;let c=!1,h=Al(u)+r;return o.forEach(f=>{if(c)return;let p=Yl(h,f.find);if(!p)return;let d=l.state.tr,_=Je({state:l.state,transaction:d}),m={from:i-(p[0].length-r.length),to:s},{commands:y,chain:x,can:E}=new Jn({editor:e,state:_});f.handler({state:_,range:m,match:p,commands:y,chain:x,can:E})===null||!d.steps.length||(f.undoable&&d.setMeta(a,{transform:d,from:i,to:s,text:r}),l.dispatch(d),c=!0)}),c}function Zl(n){let{editor:t,rules:e}=n,i=new B({state:{init(){return null},apply(s,r,o){let a=s.getMeta(i);if(a)return a;let l=s.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:c}=l;typeof c=="string"?c=c:c=Qs(w.from(c),o.schema);let{from:h}=l,f=h+c.length;Be({editor:t,from:h,to:f,text:c,rules:e,plugin:i})}),s.selectionSet||s.docChanged?null:r}},props:{handleTextInput(s,r,o,a){return Be({editor:t,from:r,to:o,text:a,rules:e,plugin:i})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{let{$cursor:r}=s.state.selection;r&&Be({editor:t,from:r.pos,to:r.pos,text:"",rules:e,plugin:i})}),!1)},handleKeyDown(s,r){if(r.key!=="Enter")return!1;let{$cursor:o}=s.state.selection;return o?Be({editor:t,from:o.pos,to:o.pos,text:`
`,rules:e,plugin:i}):!1}},isInputRules:!0});return i}function tu(n){return Object.prototype.toString.call(n).slice(8,-1)}function Fe(n){return tu(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function er(n,t){let e={...n};return Fe(n)&&Fe(t)&&Object.keys(t).forEach(i=>{Fe(t[i])&&Fe(n[i])?e[i]=er(n[i],t[i]):e[i]=t[i]}),e}var nr=class{constructor(n={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...n},this.name=this.config.name}get options(){return{...W(v(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...W(v(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(n={}){let t=this.extend({...this.config,addOptions:()=>er(this.options,n)});return t.name=this.name,t.parent=this.parent,t}extend(n={}){let t=new this.constructor({...this.config,...n});return t.parent=this,this.child=t,t.name="name"in n?n.name:t.parent.name,t}},eu=class ir extends nr{constructor(){super(...arguments),this.type="mark"}static create(t={}){let e=typeof t=="function"?t():t;return new ir(e)}static handleExit({editor:t,mark:e}){let{tr:i}=t.state,s=t.state.selection.$from;if(s.pos===s.end()){let o=s.marks();if(!!!o.find(u=>u?.type.name===e.name))return!1;let l=o.find(u=>u?.type.name===e.name);return l&&i.removeStoredMark(l),i.insertText(" ",s.pos),t.view.dispatch(i),!0}return!1}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}};function nu(n){return typeof n=="number"}var iu=(n,t,e)=>{if(qn(t))return[...n.matchAll(t)];let i=t(n,e);return i?i.map(s=>{let r=[s.text];return r.index=s.index,r.input=n,r.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),r.push(s.replaceWith)),r}):[]};function su(n){let{editor:t,state:e,from:i,to:s,rule:r,pasteEvent:o,dropEvent:a}=n,{commands:l,chain:u,can:c}=new Jn({editor:t,state:e}),h=[];return e.doc.nodesBetween(i,s,(p,d)=>{var _,m,y,x,E;if((m=(_=p.type)==null?void 0:_.spec)!=null&&m.code||!(p.isText||p.isTextblock||p.isInline))return;let O=(E=(x=(y=p.content)==null?void 0:y.size)!=null?x:p.nodeSize)!=null?E:0,T=Math.max(i,d),L=Math.min(s,d+O);if(T>=L)return;let $=p.isText?p.text||"":p.textBetween(T-d,L-d,void 0,"\uFFFC");iu($,r.find,o).forEach(it=>{if(it.index===void 0)return;let Ot=T+it.index+1,sn=Ot+it[0].length,we={from:e.tr.mapping.map(Ot),to:e.tr.mapping.map(sn)},rn=r.handler({state:e,range:we,match:it,commands:l,chain:u,can:c,pasteEvent:o,dropEvent:a});h.push(rn)})}),h.every(p=>p!==null)}var We=null,ru=n=>{var t;let e=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=e.clipboardData)==null||t.setData("text/html",n),e};function ou(n){let{editor:t,rules:e}=n,i=null,s=!1,r=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}let l=({state:c,from:h,to:f,rule:p,pasteEvt:d})=>{let _=c.tr,m=Je({state:c,transaction:_});if(!(!su({editor:t,state:m,from:Math.max(h-1,0),to:f.b-1,rule:p,pasteEvent:d,dropEvent:a})||!_.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,_}};return e.map(c=>new B({view(h){let f=d=>{var _;i=(_=h.dom.parentElement)!=null&&_.contains(d.target)?h.dom.parentElement:null,i&&(We=t)},p=()=>{We&&(We=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(r=i===h.dom.parentElement,a=f,!r){let p=We;p?.isEditable&&setTimeout(()=>{let d=p.state.selection;d&&p.commands.deleteRange({from:d.from,to:d.to})},10)}return!1},paste:(h,f)=>{var p;let d=(p=f.clipboardData)==null?void 0:p.getData("text/html");return o=f,s=!!d?.includes("data-pm-slice"),!1}}},appendTransaction:(h,f,p)=>{let d=h[0],_=d.getMeta("uiEvent")==="paste"&&!s,m=d.getMeta("uiEvent")==="drop"&&!r,y=d.getMeta("applyPasteRules"),x=!!y;if(!_&&!m&&!x)return;if(x){let{text:T}=y;typeof T=="string"?T=T:T=Qs(w.from(T),p.schema);let{from:L}=y,$=L+T.length,et=ru(T);return l({rule:c,state:p,from:L,to:{b:$},pasteEvt:et})}let E=f.doc.content.findDiffStart(p.doc.content),O=f.doc.content.findDiffEnd(p.doc.content);if(!(!nu(E)||!O||E===O.b))return l({rule:c,state:p,from:E,to:O,pasteEvt:o})}}))}var Qn=class{constructor(n,t){this.splittableMarks=[],this.editor=t,this.baseExtensions=n,this.extensions=Zs(n),this.schema=xl(this.extensions,t),this.setupExtensions()}get commands(){return this.extensions.reduce((n,t)=>{let e={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:De(t.name,this.schema)},i=v(t,"addCommands",e);return i?{...n,...i()}:n},{})}get plugins(){let{editor:n}=this;return Ve([...this.extensions].reverse()).flatMap(i=>{let s={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:n,type:De(i.name,this.schema)},r=[],o=v(i,"addKeyboardShortcuts",s),a={};if(i.type==="mark"&&v(i,"exitable",s)&&(a.ArrowRight=()=>eu.handleExit({editor:n,mark:i})),o){let f=Object.fromEntries(Object.entries(o()).map(([p,d])=>[p,()=>d({editor:n})]));a={...a,...f}}let l=Ps(a);r.push(l);let u=v(i,"addInputRules",s);if($s(i,n.options.enableInputRules)&&u){let f=u();if(f&&f.length){let p=Zl({editor:n,rules:f}),d=Array.isArray(p)?p:[p];r.push(...d)}}let c=v(i,"addPasteRules",s);if($s(i,n.options.enablePasteRules)&&c){let f=c();if(f&&f.length){let p=ou({editor:n,rules:f});r.push(...p)}}let h=v(i,"addProseMirrorPlugins",s);if(h){let f=h();r.push(...f)}return r})}get attributes(){return Ys(this.extensions)}get nodeViews(){let{editor:n}=this,{nodeExtensions:t}=Ht(this.extensions);return Object.fromEntries(t.filter(e=>!!v(e,"addNodeView")).map(e=>{let i=this.attributes.filter(l=>l.type===e.name),s={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:n,type:Q(e.name,this.schema)},r=v(e,"addNodeView",s);if(!r)return[];let o=r();if(!o)return[];let a=(l,u,c,h,f)=>{let p=Ue(l,i);return o({node:l,view:u,getPos:c,decorations:h,innerDecorations:f,editor:n,extension:e,HTMLAttributes:p})};return[e.name,a]}))}dispatchTransaction(n){let{editor:t}=this;return Ve([...this.extensions].reverse()).reduceRight((i,s)=>{let r={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:t,type:De(s.name,this.schema)},o=v(s,"dispatchTransaction",r);return o?a=>{o.call(r,{transaction:a,next:i})}:i},n)}get markViews(){let{editor:n}=this,{markExtensions:t}=Ht(this.extensions);return Object.fromEntries(t.filter(e=>!!v(e,"addMarkView")).map(e=>{let i=this.attributes.filter(a=>a.type===e.name),s={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:n,type:bt(e.name,this.schema)},r=v(e,"addMarkView",s);if(!r)return[];let o=(a,l,u)=>{let c=Ue(a,i);return r()({mark:a,view:l,inline:u,editor:n,extension:e,HTMLAttributes:c,updateAttributes:h=>{Tu(a,n,h)}})};return[e.name,o]}))}setupExtensions(){let n=this.extensions;this.editor.extensionStorage=Object.fromEntries(n.map(t=>[t.name,t.storage])),n.forEach(t=>{var e;let i={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:De(t.name,this.schema)};t.type==="mark"&&((e=W(v(t,"keepOnSplit",i)))==null||e)&&this.splittableMarks.push(t.name);let s=v(t,"onBeforeCreate",i),r=v(t,"onCreate",i),o=v(t,"onUpdate",i),a=v(t,"onSelectionUpdate",i),l=v(t,"onTransaction",i),u=v(t,"onFocus",i),c=v(t,"onBlur",i),h=v(t,"onDestroy",i);s&&this.editor.on("beforeCreate",s),r&&this.editor.on("create",r),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),c&&this.editor.on("blur",c),h&&this.editor.on("destroy",h)})}};Qn.resolve=Zs;Qn.sort=Ve;Qn.flatten=Gn;var au={};Vn(au,{ClipboardTextSerializer:()=>lu,Commands:()=>uu,Delete:()=>cu,Drop:()=>hu,Editable:()=>fu,FocusEvents:()=>pu,Keymap:()=>du,Paste:()=>_u,Tabindex:()=>mu,TextDirection:()=>gu,focusEventsPluginKey:()=>rr});var lt=class sr extends nr{constructor(){super(...arguments),this.type="extension"}static create(t={}){let e=typeof t=="function"?t():t;return new sr(e)}configure(t){return super.configure(t)}extend(t){let e=typeof t=="function"?t():t;return super.extend(e)}},lu=lt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new B({key:new K("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:n}=this,{state:t,schema:e}=n,{doc:i,selection:s}=t,{ranges:r}=s,o=Math.min(...r.map(c=>c.$from.pos)),a=Math.max(...r.map(c=>c.$to.pos)),l=El(e);return Sl(i,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),uu=lt.create({name:"commands",addCommands(){return{...Us}}}),cu=lt.create({name:"delete",onUpdate({transaction:n,appendedTransactions:t}){var e,i,s;let r=()=>{var o,a,l,u;if((u=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,n))!=null?u:n.getMeta("y-sync$"))return;let c=_l(n.before,[n,...t]);Ol(c).forEach(p=>{c.mapping.mapResult(p.oldRange.from).deletedAfter&&c.mapping.mapResult(p.oldRange.to).deletedBefore&&c.before.nodesBetween(p.oldRange.from,p.oldRange.to,(d,_)=>{let m=_+d.nodeSize-2,y=p.oldRange.from<=_&&m<=p.oldRange.to;this.editor.emit("delete",{type:"node",node:d,from:_,to:m,newFrom:c.mapping.map(_),newTo:c.mapping.map(m),deletedRange:p.oldRange,newRange:p.newRange,partial:!y,editor:this.editor,transaction:n,combinedTransform:c})})});let f=c.mapping;c.steps.forEach((p,d)=>{var _,m;if(p instanceof gt){let y=f.slice(d).map(p.from,-1),x=f.slice(d).map(p.to),E=f.invert().map(y,-1),O=f.invert().map(x),T=(_=c.doc.nodeAt(y-1))==null?void 0:_.marks.some($=>$.eq(p.mark)),L=(m=c.doc.nodeAt(x))==null?void 0:m.marks.some($=>$.eq(p.mark));this.editor.emit("delete",{type:"mark",mark:p.mark,from:p.from,to:p.to,deletedRange:{from:E,to:O},newRange:{from:y,to:x},partial:!!(L||T),editor:this.editor,transaction:n,combinedTransform:c})}})};(s=(i=(e=this.editor.options.coreExtensionOptions)==null?void 0:e.delete)==null?void 0:i.async)==null||s?setTimeout(r,0):r()}}),hu=lt.create({name:"drop",addProseMirrorPlugins(){return[new B({key:new K("tiptapDrop"),props:{handleDrop:(n,t,e,i)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:e,moved:i})}}})]}}),fu=lt.create({name:"editable",addProseMirrorPlugins(){return[new B({key:new K("editable"),props:{editable:()=>this.editor.options.editable}})]}}),rr=new K("focusEvents"),pu=lt.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:n}=this;return[new B({key:rr,props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;let i=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,e)=>{n.isFocused=!1;let i=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),du=lt.create({name:"keymap",addKeyboardShortcuts(){let n=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{let{selection:l,doc:u}=a,{empty:c,$anchor:h}=l,{pos:f,parent:p}=h,d=h.parent.isTextblock&&f>0?a.doc.resolve(f-1):h,_=d.parent.type.spec.isolating,m=h.pos-h.parentOffset,y=_&&d.parent.childCount===1?m===h.pos:A.atStart(u).from===f;return!c||!p.type.isTextblock||p.textContent.length||!y||y&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),i={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...i},r={...i,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ke()||Xs()?r:s},addProseMirrorPlugins(){return[new B({key:new K("clearDocument"),appendTransaction:(n,t,e)=>{if(n.some(_=>_.getMeta("composition")))return;let i=n.some(_=>_.docChanged)&&!t.doc.eq(e.doc),s=n.some(_=>_.getMeta("preventClearDocument"));if(!i||s)return;let{empty:r,from:o,to:a}=t.selection,l=A.atStart(t.doc).from,u=A.atEnd(t.doc).to;if(r||!(o===l&&a===u)||!tr(e.doc))return;let f=e.tr,p=Je({state:e,transaction:f}),{commands:d}=new Jn({editor:this.editor,state:p});if(d.clearNodes(),!!f.steps.length)return f}})]}}),_u=lt.create({name:"paste",addProseMirrorPlugins(){return[new B({key:new K("tiptapPaste"),props:{handlePaste:(n,t,e)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:e})}}})]}}),mu=lt.create({name:"tabindex",addProseMirrorPlugins(){return[new B({key:new K("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),gu=lt.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];let{nodeExtensions:n}=Ht(this.extensions);return[{types:n.filter(t=>t.name!=="text").map(t=>t.name),attributes:{dir:{default:this.options.direction,parseHTML:t=>{let e=t.getAttribute("dir");return e&&(e==="ltr"||e==="rtl"||e==="auto")?e:this.options.direction},renderHTML:t=>t.dir?{dir:t.dir}:{}}}}]},addProseMirrorPlugins(){return[new B({key:new K("textDirection"),props:{attributes:()=>{let n=this.options.direction;return n?{dir:n}:{}}}})]}});var yu={};Vn(yu,{createAtomBlockMarkdownSpec:()=>wu,createBlockMarkdownSpec:()=>bu,createInlineMarkdownSpec:()=>ku,parseAttributes:()=>Yn,parseIndentedBlocks:()=>Su,renderNestedMarkdownContent:()=>Eu,serializeAttributes:()=>Zn});function Yn(n){if(!n?.trim())return{};let t={},e=[],i=n.replace(/["']([^"']*)["']/g,u=>(e.push(u),`__QUOTED_${e.length-1}__`)),s=i.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(s){let u=s.map(c=>c.trim().slice(1));t.class=u.join(" ")}let r=i.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);r&&(t.id=r[1]);let o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(i.matchAll(o)).forEach(([,u,c])=>{var h;let f=parseInt(((h=c.match(/__QUOTED_(\d+)__/))==null?void 0:h[1])||"0",10),p=e[f];p&&(t[u]=p.slice(1,-1))});let l=i.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(c=>{c.match(/^[a-zA-Z][\w-]*$/)&&(t[c]=!0)}),t}function Zn(n){if(!n||Object.keys(n).length===0)return"";let t=[];return n.class&&String(n.class).split(/\s+/).filter(Boolean).forEach(i=>t.push(`.${i}`)),n.id&&t.push(`#${n.id}`),Object.entries(n).forEach(([e,i])=>{e==="class"||e==="id"||(i===!0?t.push(e):i!==!1&&i!=null&&t.push(`${e}="${String(i)}"`))}),t.join(" ")}function wu(n){let{nodeName:t,name:e,parseAttributes:i=Yn,serializeAttributes:s=Zn,defaultAttributes:r={},requiredAttributes:o=[],allowedAttributes:a}=n,l=e||t,u=c=>{if(!a)return c;let h={};return a.forEach(f=>{f in c&&(h[f]=c[f])}),h};return{parseMarkdown:(c,h)=>{let f={...r,...c.attributes};return h.createNode(t,f,[])},markdownTokenizer:{name:t,level:"block",start(c){var h;let f=new RegExp(`^:::${l}(?:\\s|$)`,"m"),p=(h=c.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(c,h,f){let p=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),d=c.match(p);if(!d)return;let _=d[1]||"",m=i(_);if(!o.find(x=>!(x in m)))return{type:t,raw:d[0],attributes:m}}},renderMarkdown:c=>{let h=u(c.attrs||{}),f=s(h),p=f?` {${f}}`:"";return`:::${l}${p} :::`}}}function bu(n){let{nodeName:t,name:e,getContent:i,parseAttributes:s=Yn,serializeAttributes:r=Zn,defaultAttributes:o={},content:a="block",allowedAttributes:l}=n,u=e||t,c=h=>{if(!l)return h;let f={};return l.forEach(p=>{p in h&&(f[p]=h[p])}),f};return{parseMarkdown:(h,f)=>{let p;if(i){let _=i(h);p=typeof _=="string"?[{type:"text",text:_}]:_}else a==="block"?p=f.parseChildren(h.tokens||[]):p=f.parseInline(h.tokens||[]);let d={...o,...h.attributes};return f.createNode(t,d,p)},markdownTokenizer:{name:t,level:"block",start(h){var f;let p=new RegExp(`^:::${u}`,"m"),d=(f=h.match(p))==null?void 0:f.index;return d!==void 0?d:-1},tokenize(h,f,p){var d;let _=new RegExp(`^:::${u}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),m=h.match(_);if(!m)return;let[y,x=""]=m,E=s(x),O=1,T=y.length,L="",$=/^:::([\w-]*)(\s.*)?/gm,et=h.slice(T);for($.lastIndex=0;;){let it=$.exec(et);if(it===null)break;let Ot=it.index,sn=it[1];if(!((d=it[2])!=null&&d.endsWith(":::"))){if(sn)O+=1;else if(O-=1,O===0){let we=et.slice(0,Ot);L=we.trim();let rn=h.slice(0,T+Ot+it[0].length),kt=[];if(L)if(a==="block")for(kt=p.blockTokens(we),kt.forEach(_t=>{_t.text&&(!_t.tokens||_t.tokens.length===0)&&(_t.tokens=p.inlineTokens(_t.text))});kt.length>0;){let _t=kt[kt.length-1];if(_t.type==="paragraph"&&(!_t.text||_t.text.trim()===""))kt.pop();else break}else kt=p.inlineTokens(L);return{type:t,raw:rn,attributes:E,content:L,tokens:kt}}}}}},renderMarkdown:(h,f)=>{let p=c(h.attrs||{}),d=r(p),_=d?` {${d}}`:"",m=f.renderChildren(h.content||[],`

`);return`:::${u}${_}

${m}

:::`}}}function vu(n){if(!n.trim())return{};let t={},e=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,i=e.exec(n);for(;i!==null;){let[,s,r,o]=i;t[s]=r||o,i=e.exec(n)}return t}function xu(n){return Object.entries(n).filter(([,t])=>t!=null).map(([t,e])=>`${t}="${e}"`).join(" ")}function ku(n){let{nodeName:t,name:e,getContent:i,parseAttributes:s=vu,serializeAttributes:r=xu,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=n,u=e||t,c=f=>{if(!l)return f;let p={};return l.forEach(d=>{let _=typeof d=="string"?d:d.name,m=typeof d=="string"?void 0:d.skipIfDefault;if(_ in f){let y=f[_];if(m!==void 0&&y===m)return;p[_]=y}}),p},h=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,p)=>{let d={...o,...f.attributes};if(a)return p.createNode(t,d);let _=i?i(f):f.content||"";return _?p.createNode(t,d,[p.createTextNode(_)]):p.createNode(t,d,[])},markdownTokenizer:{name:t,level:"inline",start(f){let p=a?new RegExp(`\\[${h}\\s*[^\\]]*\\]`):new RegExp(`\\[${h}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${h}\\]`),d=f.match(p),_=d?.index;return _!==void 0?_:-1},tokenize(f,p,d){let _=a?new RegExp(`^\\[${h}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${h}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${h}\\]`),m=f.match(_);if(!m)return;let y="",x="";if(a){let[,O]=m;x=O}else{let[,O,T]=m;x=O,y=T||""}let E=s(x.trim());return{type:t,raw:m[0],content:y.trim(),attributes:E}}},renderMarkdown:f=>{let p="";i?p=i(f):f.content&&f.content.length>0&&(p=f.content.filter(y=>y.type==="text").map(y=>y.text).join(""));let d=c(f.attrs||{}),_=r(d),m=_?` ${_}`:"";return a?`[${u}${m}]`:`[${u}${m}]${p}[/${u}]`}}}function Su(n,t,e){var i,s,r,o;let a=n.split(`
`),l=[],u="",c=0,h=t.baseIndentSize||2;for(;c<a.length;){let f=a[c],p=f.match(t.itemPattern);if(!p){if(l.length>0)break;if(f.trim()===""){c+=1,u=`${u}${f}
`;continue}else return}let d=t.extractItemData(p),{indentLevel:_,mainContent:m}=d;u=`${u}${f}
`;let y=[m];for(c+=1;c<a.length;){let T=a[c];if(T.trim()===""){let $=a.slice(c+1).findIndex(Ot=>Ot.trim()!=="");if($===-1)break;if((((s=(i=a[c+1+$].match(/^(\s*)/))==null?void 0:i[1])==null?void 0:s.length)||0)>_){y.push(T),u=`${u}${T}
`,c+=1;continue}else break}if((((o=(r=T.match(/^(\s*)/))==null?void 0:r[1])==null?void 0:o.length)||0)>_)y.push(T),u=`${u}${T}
`,c+=1;else break}let x,E=y.slice(1);if(E.length>0){let T=E.map(L=>L.slice(_+h)).join(`
`);T.trim()&&(t.customNestedParser?x=t.customNestedParser(T):x=e.blockTokens(T))}let O=t.createToken(d,x);l.push(O)}if(l.length!==0)return{items:l,raw:u}}function Eu(n,t,e,i){if(!n||!Array.isArray(n.content))return"";let s=typeof e=="function"?e(i):e,[r,...o]=n.content,a=t.renderChildren([r]),l=[`${s}${a}`];return o&&o.length>0&&o.forEach(u=>{let c=t.renderChildren([u]);if(c){let h=c.split(`
`).map(f=>f?t.indent(f):"").join(`
`);l.push(h)}}),l.join(`
`)}function Tu(n,t,e={}){let{state:i}=t,{doc:s,tr:r}=i,o=n;s.descendants((a,l)=>{let u=r.mapping.map(l),c=r.mapping.map(l)+a.nodeSize,h=null;if(a.marks.forEach(p=>{if(p!==o)return!1;h=p}),!h)return;let f=!1;if(Object.keys(e).forEach(p=>{e[p]!==h.attrs[p]&&(f=!0)}),f){let p=n.type.create({...n.attrs,...e});r.removeMark(u,c,n.type),r.addMark(u,c,p)}}),r.docChanged&&t.view.dispatch(r)}var ao=mo(oo(),1),Wt=new WeakMap,xi=new K("source-code");function ki(n){return n?.options?.element?.closest?.(".fi-fo-rich-editor")}function Cc(n){return n?.querySelector?.(".fi-fo-rich-editor-toolbar")}function Rc(n){return n?Array.from(n.querySelectorAll("button.fi-fo-rich-editor-tool")):[]}function Nc(n){return n?.querySelector?.('button[data-tiptap-menu-item-name="source-code"]')}function lo(n,t,e=null){if(n){if(n.disabled=t,t){n.setAttribute("aria-disabled","true"),n.setAttribute("tabindex","-1");return}n.removeAttribute("aria-disabled"),e===null?n.removeAttribute("tabindex"):n.setAttribute("tabindex",e)}}function Ic(n,t){let e=ki(n),i=Cc(e),s=Nc(i);if(!i)return;let r=Rc(i);t.toolbarButtonsSnapshot=new Map;for(let o of r)o!==s&&(t.toolbarButtonsSnapshot.set(o,{disabled:o.disabled,tabIndex:o.getAttribute("tabindex")}),lo(o,!0))}function Pc(n){if(n.toolbarButtonsSnapshot){for(let[t,e]of n.toolbarButtonsSnapshot.entries())lo(t,e.disabled,e.tabIndex);n.toolbarButtonsSnapshot=null}}window.formatHtml=function(n){try{return(0,ao.html)(n,{indent_size:2,indent_char:" ",max_preserve_newlines:1,preserve_newlines:!0,wrap_line_length:0,wrap_attributes:"auto",unformatted:["code","pre","em","strong","span"],content_unformatted:["pre","textarea"],indent_inner_html:!0,indent_body_inner_html:!0,indent_head_inner_html:!0,end_with_newline:!1,extra_liners:[]})}catch(t){return console.warn("Failed to format HTML:",t),n}};var lp=lt.create({name:"source-code",addStorage(){return{isSourceMode:!1}},addProseMirrorPlugins(){return[new B({key:xi,state:{init:()=>({isSourceMode:!1}),apply:(n,t)=>{let e=n.getMeta(xi);return e&&typeof e.isSourceMode=="boolean"?{isSourceMode:e.isSourceMode}:t}}})]},addCommands(){return{toggleSourceCode:(n=null)=>({editor:t})=>{let e=ki(t);if(!e)return!1;let i=Wt.get(t);if(!i)return!1;if(i.isSourceMode===n)return!0;if(i.isSourceMode=n!==null?n:!i.isSourceMode,t.storage[this.name].isSourceMode=i.isSourceMode,t.view.dispatch(t.state.tr.setMeta(xi,{isSourceMode:i.isSourceMode})),i.isSourceMode){let s=i.originalGetHTML(),r=formatHtml(s);i.sourceContent=r;let o=document.createElement("textarea");o.value=r,o.className="source-view-textarea",o.style.cssText="width: 100%; height: 100%; min-height: 310px; font-family: monospace; font-size: 13px; padding: 10px; border: none; outline: none; resize: vertical; background: transparent; color: inherit;",o.addEventListener("input",l=>{i.sourceContent=l.target.value,i.originalGetHTML()!==i.sourceContent&&t.commands.setContent(i.sourceContent,!1)});let a=e.querySelector(".tiptap.ProseMirror");a&&(a.style.display="none",a.insertAdjacentElement("afterend",o),i.textareaElement=o),e.classList.add("source-code"),Ic(t,i)}else{let s=i.sourceContent;i.textareaElement&&(i.textareaElement.remove(),i.textareaElement=null);let r=e.querySelector(".tiptap.ProseMirror");r&&(r.style.display=""),e.classList.remove("source-code"),Pc(i),t.commands.setContent(s),i.sourceContent=null}return!0},toggleSource:()=>({editor:n})=>n.commands.toggleSourceCode()}},onCreate(){let n={isSourceMode:!1,sourceContent:null,textareaElement:null,toolbarButtonsSnapshot:null};Wt.set(this.editor,n);let t=this.editor.getHTML.bind(this.editor);this.editor.getHTML=()=>{let i=Wt.get(this.editor);return i&&i.isSourceMode?(i.textareaElement&&(i.sourceContent=i.textareaElement.value),i.sourceContent||""):t()},n.originalGetHTML=t,n.exitSourceModeHandler=i=>{if(!i.detail?.statePath)return;let r=ki(this.editor),o=Wt.get(this.editor);o&&o.isSourceMode&&(this.editor.commands.toggleSourceCode(!1),!r?.classList?.contains("source-code")&&o.isSourceMode&&r?.classList?.add("source-code"))},window.addEventListener("exit-source-mode",n.exitSourceModeHandler);let e=this.editor.isActive.bind(this.editor);this.editor.isActive=(i,s={})=>i===this.name?!!this.editor.storage[this.name]?.isSourceMode:e(i,s),n.originalIsActive=e},addKeyboardShortcuts(){return{Escape:()=>{let n=Wt.get(this.editor);if(n&&n.isSourceMode)return this.editor.commands.toggleSourceCode(!1)},"Mod-Shift-l":()=>this.editor.commands.toggleSourceCode()}},onDestroy(){let n=Wt.get(this.editor);n?.exitSourceModeHandler&&window.removeEventListener("exit-source-mode",n.exitSourceModeHandler),n?.originalIsActive&&(this.editor.isActive=n.originalIsActive),Wt.delete(this.editor)}});export{lp as default};
